<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Prescrição Nutracêutica - Psiquiatria</title>
  
  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- jsPDF para gerar PDF bonito -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <style>
    body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    #root { width: 100%; min-height: 100vh; }
    #loading {
      position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex; align-items: center; justify-content: center;
      color: white; z-index: 9999;
    }
    .spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: white; border-radius: 50%;
      width: 60px; height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="loading">
    <div style="text-align: center;">
      <div class="spinner" style="margin: 0 auto 20px;"></div>
      <h2 style="font-size: 24px; margin-bottom: 10px;">Carregando Sistema...</h2>
      <p style="font-size: 14px; opacity: 0.9;">v2.0 - Copiar + PDF Bonito</p>
    </div>
  </div>
  
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const Search = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>);
    const Plus = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>);
    const Trash2 = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>);
    const FileText = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>);
    const Download = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);
    const Info = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);
    const AlertCircle = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>);
    const Filter = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>);
    const Copy = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>);
    const Eye = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>);
    const Settings = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.2-15.4l-4.2 4.2m-5.8 5.8L2.8 17.8m15.4 0l-4.2-4.2M7.2 7.2 2.8 2.8"/></svg>);
    


const App = () => {
  const [selectedCondition, setSelectedCondition] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('');
  const [searchTerm, setSearchTerm] = useState('');
  const [prescription, setPrescription] = useState([]);
  const [showInfo, setShowInfo] = useState(null);
  const [showAvailableList, setShowAvailableList] = useState(false); // Controla se lista está aberta
  const [availableSearchTerm, setAvailableSearchTerm] = useState(''); // Busca dentro da lista
  const [showDRI, setShowDRI] = useState(true);
  const [showPreview, setShowPreview] = useState(false);
  const [copiedFormula, setCopiedFormula] = useState(null);
  const [showPreFormulas, setShowPreFormulas] = useState(false);
  
  // Estados para prescritores
  const [prescritores, setPrescritores] = useState(() => {
    const saved = localStorage.getItem('prescritores');
    return saved ? JSON.parse(saved) : [];
  });
  const [selectedPrescritor, setSelectedPrescritor] = useState(() => {
    const saved = localStorage.getItem('selectedPrescritor');
    return saved ? JSON.parse(saved) : null;
  });
  const [showPrescritorManager, setShowPrescritorManager] = useState(false);
  const [showPrescritorForm, setShowPrescritorForm] = useState(false);
  const [editingPrescritor, setEditingPrescritor] = useState(null);
  const [prescritorForm, setPrescritorForm] = useState({
    nome: '',
    titulo: '', // Dr., Dra., Nutricionista, etc
    especialidade: '',
    crm: '',
    uf_crm: '',
    crn: '',
    cpf: '',
    telefone: '',
    email: '',
    endereco: '',
    cidade: '',
    uf: '',
    cep: '',
    mostrar: {
      titulo: true,
      especialidade: true,
      crm: true,
      crn: false,
      cpf: false,
      telefone: true,
      email: true,
      endereco: true
    }
  });
  const [selectedPreFormula, setSelectedPreFormula] = useState('');
  const [patientInfo, setPatientInfo] = useState({
    name: '',
    age: '',
    weight: '',
    gender: 'M'
  });
  
  // Estados para cadastro de substâncias personalizadas
  const [customSubstances, setCustomSubstances] = useState([]);
  const [showCustomForm, setShowCustomForm] = useState(false);
  const [customForm, setCustomForm] = useState({
    name: '',
    category: 'Personalizado',
    dosage: '',
    timing: 'Conforme orientação',
    mechanism: '',
    interactions: 'Nenhuma conhecida',
    contraindications: 'Nenhuma conhecida',
    notes: ''
  });
  
  // Estados para histórico de prescrições
  const [prescriptionHistory, setPrescriptionHistory] = useState(() => {
    const saved = localStorage.getItem('prescriptionHistory');
    return saved ? JSON.parse(saved) : [];
  });
  const [showHistory, setShowHistory] = useState(false);
  const [historySearchTerm, setHistorySearchTerm] = useState('');
  
  // Estados para backup
  const [showBackupMenu, setShowBackupMenu] = useState(false);
  const [backupMessage, setBackupMessage] = useState(null);
  
  // Estado para menu de exportação de prescrição
  const [showExportMenu, setShowExportMenu] = useState(false);
  
  // Estados para biblioteca de fórmulas clínicas
  const [showClinicalLibrary, setShowClinicalLibrary] = useState(false);
  const [selectedClinicalCategory, setSelectedClinicalCategory] = useState('');
  const [selectedClinicalFormula, setSelectedClinicalFormula] = useState(null);
  const [showClinicalFormulaForm, setShowClinicalFormulaForm] = useState(false);
  const [editingClinicalFormula, setEditingClinicalFormula] = useState(null);
  const [clinicalFormulaForm, setClinicalFormulaForm] = useState({
    nome: '',
    categoria: '',
    subcategoria: '',
    indicacao: '',
    via: 'oral',
    ativos: [],
    excipiente: 'celulose_microcristalina',
    qsp: '1_capsula',
    quantidade: 30,
    posologia: '',
    observacoes: ''
  });
  const [tempClinicalAtivo, setTempClinicalAtivo] = useState({
    substancia: '',
    ligante: '',
    dose: '',
    horario: ''
  });
  
  // Estados para fórmulas personalizadas do usuário
  const [customFormulas, setCustomFormulas] = useState(() => {
    const saved = localStorage.getItem('customFormulas');
    return saved ? JSON.parse(saved) : [];
  });
  const [showCustomFormulas, setShowCustomFormulas] = useState(false);
  const [showCustomFormulaForm, setShowCustomFormulaForm] = useState(false);
  const [editingCustomFormula, setEditingCustomFormula] = useState(null);
  const [customFormulaForm, setCustomFormulaForm] = useState({
    nome: '',
    categoria: '',
    indicacao: '',
    via: 'oral',
    ativos: [],
    excipiente: 'celulose_microcristalina',
    qsp: '1_capsula',
    quantidade: 30,
    posologia: '',
    observacoes: ''
  });
  const [customFormulaSearchTerm, setCustomFormulaSearchTerm] = useState('');
  
  // Estado temporário para adicionar ativo à fórmula personalizada
  const [tempAtivo, setTempAtivo] = useState({
    substancia: '',
    ligante: '',
    dose: '',
    horario: ''
  });
  
  // Estado para configurações magistrais
  const [magistralConfig, setMagistralConfig] = useState({
    groupFormulas: false, // false = fórmulas separadas, true = fórmula única
    via: 'oral',
    formaFarmaceutica: 'capsula',
    excipiente: 'criterio_farmacia',
    qsp: '1_capsula',
    quantidade: 30,
    posologia: 'Tomar 1 cápsula ao dia',
    observacoes: ''
  });

  // BASE DE DADOS COMPLETA - ILSI BRASIL + NUTRACÊUTICOS PSIQUIÁTRICOS
  const nutraceuticos = [
    // ============ VITAMINAS LIPOSSOLÚVEIS ============
    {
      id: 1,
      category: 'Vitaminas Lipossolúveis',
      name: 'Vitamina A',
      conditions: ['depressão', 'declínio cognitivo', 'ansiedade'],
      dosage: 'H: 900 µg RAE/d | M: 700 µg RAE/d',
      timing: 'Com refeições contendo gordura',
      evidence: 'Moderada - Neuroplasticidade',
      mechanism: 'Regulação gênica, diferenciação neural, antioxidante',
      interactions: 'Tetraciclinas, orlistat, retinoides',
      contraindications: 'Gestação (>3000 µg/d), hepatopatia',
      notes: 'Preferir betacaroteno. 1 µg RAE = 12 µg betacaroteno',
      dri: 'EAR: H 625 µg/d, M 500 µg/d | RDA: H 900 µg/d, M 700 µg/d | UL: 3000 µg/d'
,
      ligantes: {
        default: 'Retinol',
        alternatives: ["Betacaroteno"],
        justificativa: 'Retinol é forma ativa pré-formada'
      },
      excipiente: {
        default: 'Triglicerídeos de Cadeia Média (TCM)',
        alternatives: ["Azeite de oliva", "Óleo de coco", "Sistema lipossomal"],
        justificativa: 'TCM: melhor absorção, excelente estabilidade, alta tolerabilidade GI'
      }
    },
    {
      id: 2,
      category: 'Vitaminas Lipossolúveis',
      name: 'Vitamina D3',
      conditions: ['depressão', 'ansiedade', 'esquizofrenia', 'tdah', 'bipolar'],
      dosage: 'RDA: 600-800 UI/d | Psiquiátrico: 2000-5000 UI/d',
      timing: 'Pela manhã com gordura',
      evidence: 'Alta - Transtornos do humor',
      mechanism: 'Regulação gênica, neuroproteção, anti-inflamatório, modulação serotonina',
      interactions: 'Digoxina, tiazídicos, corticoides',
      contraindications: 'Hipercalcemia, sarcoidose',
      notes: 'Dosar 25-OH vitamina D. Alvo: 40-60 ng/mL. 40 UI = 1 µg',
      dri: 'RDA: 600 UI/d (19-70a), 800 UI/d (>70a) | UL: 4000 UI/d'
,
      ligantes: {
        default: 'Colecalciferol (D3)',
        alternatives: ["Ergocalciferol (D2)"],
        justificativa: 'D3 é mais eficaz em elevar 25-OH vitamina D'
      },
      excipiente: {
        default: 'Triglicerídeos de Cadeia Média (TCM)',
        alternatives: ["Azeite de oliva", "Óleo de coco", "Sistema lipossomal"],
        justificativa: 'TCM: veículo padrão para vitamina D em farmácias magistrais'
      }
    },
    {
      id: 3,
      category: 'Vitaminas Lipossolúveis',
      name: 'Vitamina E',
      conditions: ['declínio cognitivo', 'alzheimer', 'ansiedade'],
      dosage: 'RDA: 15 mg/d | Terapêutico: 400-800 UI/d',
      timing: 'Com refeições contendo gordura',
      evidence: 'Moderada - Neuroproteção',
      mechanism: 'Antioxidante potente, proteção membranas neuronais',
      interactions: 'Anticoagulantes, estatinas',
      contraindications: 'Distúrbios coagulação, cirurgia',
      notes: 'Preferir d-alfa-tocoferol (natural)',
      dri: 'RDA: 15 mg/d | UL: 1000 mg/d'
,
      ligantes: {
        default: 'd-alfa-tocoferol',
        alternatives: ["dl-alfa-tocoferol", "Tocotrienóis"],
        justificativa: 'Forma natural (d-alfa) tem maior atividade biológica'
      },
      excipiente: {
        default: 'Triglicerídeos de Cadeia Média (TCM)',
        alternatives: ["Azeite de oliva", "Óleo de coco", "Sistema lipossomal"],
        justificativa: 'TCM: otimiza biodisponibilidade de tocoferóis'
      }
    },
    {
      id: 4,
      category: 'Vitaminas Lipossolúveis',
      name: 'Vitamina K',
      conditions: ['declínio cognitivo', 'saúde cerebral'],
      dosage: 'AI: H 120 µg/d | M 90 µg/d',
      timing: 'Com refeições',
      evidence: 'Emergente - Saúde cerebral',
      mechanism: 'Síntese esfingolipídios cerebrais, proteção vascular',
      interactions: 'Varfarina (antagonismo)',
      contraindications: 'Anticoagulantes cumarínicos',
      notes: 'K2 (menaquinona) pode ter benefícios superiores',
      dri: 'AI: H 120 µg/d, M 90 µg/d'
,
      ligantes: {
        default: 'Menaquinona-7 (K2)',
        alternatives: ["Filoquinona (K1)"],
        justificativa: 'K2-MK7 tem meia-vida mais longa'
      },
      excipiente: {
        default: 'Triglicerídeos de Cadeia Média (TCM)',
        alternatives: ["Azeite de oliva", "Óleo de coco", "Sistema lipossomal"],
        justificativa: 'TCM: essencial para absorção de vitamina K lipossolúvel'
      }
    },
    {
      id: 5,
      category: 'Vitaminas Lipossolúveis',
      name: 'Vitamina K2 (MK-7)',
      conditions: ['depressão', 'ansiedade', 'declínio cognitivo', 'saúde cerebral', 'neuroproteção'],
      dosage: 'Terapêutico: 100-200 µg/dia',
      timing: 'Com refeições contendo gordura, idealmente junto com vitamina D',
      evidence: 'Emergente-Moderada - Saúde cerebral e neuroproteção',
      mechanism: 'Ativação de proteínas matriz Gla (MGP), proteção contra calcificação vascular cerebral, síntese de esfingolipídios cerebrais, neuroproteção via Gas6/Axl, modulação inflamatória cerebral',
      interactions: 'Varfarina e anticoagulantes cumarínicos (antagonismo direto). Antibióticos de amplo espectro (reduzem síntese intestinal). Sinergismo com vitamina D (devem ser suplementadas juntas)',
      contraindications: 'Uso de anticoagulantes cumarínicos (varfarina, marevan). Distúrbios de coagulação. Trombofilia sem acompanhamento',
      notes: 'MK-7 (menaquinona-7) tem meia-vida de 72h vs 1-2h da K1, permitindo dosagem única diária. Essencial para ativação de osteocalcina e MGP. Sinergismo com vitamina D para saúde óssea e vascular. Dosar vitamina K sérica se disponível (alvo >0.5 ng/mL). Forma trans preferível à cis. Pacientes em anticoagulantes: contraindicado ou usar doses mínimas com monitoramento INR rigoroso',
      dri: 'AI: H 120 µg/d, M 90 µg/d | Terapêutico: 100-200 µg/d | UL: não estabelecido'
,
      ligantes: {
        default: 'Menaquinona-7 (MK-7)',
        alternatives: ["All-trans MK-7", "MK-4 (Menatetrenona)"],
        justificativa: 'MK-7 possui meia-vida de ~72h (vs 1h da MK-4), permitindo níveis séricos estáveis com dose única diária. Forma all-trans é biologicamente ativa'
      },
      excipiente: {
        default: 'Triglicerídeos de Cadeia Média (TCM)',
        alternatives: ["Sistema lipossomal", "Azeite de oliva", "Óleo de coco"],
        justificativa: 'Vitamina K2 é lipossolúvel - TCM ou sistema lipossomal otimizam biodisponibilidade. Absorção aumenta 3-4x com gorduras'
      }
    },
    
    // ============ COMPLEXO B ============
    {
      id: 6,
      category: 'Complexo B',
      name: 'Vitamina B1',
      conditions: ['depressão', 'ansiedade', 'fadiga', 'declínio cognitivo'],
      dosage: 'RDA: H 1,2 mg/d | M 1,1 mg/d',
      timing: 'Qualquer horário',
      evidence: 'Moderada - Metabolismo energético cerebral',
      mechanism: 'Cofator metabolismo glicose e neurotransmissores',
      interactions: 'Álcool, diuréticos loop',
      contraindications: 'Hipersensibilidade (raro)',
      notes: 'Deficiência em alcoolismo. Benfotiamina = forma ativa',
      dri: 'RDA: H 1,2 mg/d, M 1,1 mg/d'
,
      ligantes: {
        default: 'Tiamina (cloridrato)',
        alternatives: ["Benfotiamina"],
        justificativa: 'Cloridrato é custo-efetivo'
      }
    },
    {
      id: 7,
      category: 'Complexo B',
      name: 'Vitamina B2',
      conditions: ['enxaqueca', 'fadiga', 'depressão'],
      dosage: 'RDA: H 1,3 mg/d | M 1,1 mg/d | Enxaqueca: 400 mg/d',
      timing: 'Com alimentos',
      evidence: 'Alta - Profilaxia enxaqueca (400mg)',
      mechanism: 'Cofator FAD/FMN, metabolismo mitocondrial',
      interactions: 'Tricíclicos, tetraciclinas',
      contraindications: 'Nenhuma conhecida',
      notes: 'Urina amarelo-fluorescente é normal',
      dri: 'RDA: H 1,3 mg/d, M 1,1 mg/d'
,
      ligantes: {
        default: 'Riboflavina',
        alternatives: ["Riboflavina-5-fosfato"],
        justificativa: 'Forma base é bem absorvida'
      }
    },
    {
      id: 8,
      category: 'Complexo B',
      name: 'Vitamina B3',
      conditions: ['depressão', 'ansiedade', 'esquizofrenia'],
      dosage: 'RDA: H 16 mg/d | M 14 mg/d | Psiquiátrico: 500-3000 mg/d',
      timing: 'Com refeições (evitar flush)',
      evidence: 'Moderada - Terapia ortomolecular',
      mechanism: 'Cofator NAD/NADP, síntese serotonina',
      interactions: 'Estatinas (risco rabdomiólise)',
      contraindications: 'Hepatopatia, úlcera, gota',
      notes: 'Niacinamida não causa flush. 1 mg niacina = 60 mg triptofano',
      dri: 'RDA: H 16 mg NE/d, M 14 mg NE/d | UL: 35 mg/d (ácido nicotínico)'
,
      ligantes: {
        default: 'Niacinamida',
        alternatives: ["Ácido nicotínico"],
        justificativa: 'Niacinamida não causa flush'
      }
    },
    {
      id: 9,
      category: 'Complexo B',
      name: 'Vitamina B5',
      conditions: ['fadiga', 'estresse', 'ansiedade'],
      dosage: 'AI: 5 mg/d',
      timing: 'Qualquer horário',
      evidence: 'Moderada - Suporte adrenal',
      mechanism: 'Cofator CoA, síntese hormônios e neurotransmissores',
      interactions: 'Nenhuma significativa',
      contraindications: 'Nenhuma conhecida',
      notes: 'Bem tolerado',
      dri: 'AI: 5 mg/d'
,
      ligantes: {
        default: 'Pantotenato de cálcio',
        alternatives: [],
        justificativa: 'Forma estável e bem absorvida'
      }
    },
    {
      id: 10,
      category: 'Complexo B',
      name: 'Vitamina B6',
      conditions: ['depressão', 'ansiedade', 'tpm', 'náusea'],
      dosage: 'RDA: 1,3-1,7 mg/d | Terapêutico: 50-100 mg/d',
      timing: 'Pela manhã ou dividido',
      evidence: 'Alta - Síntese neurotransmissores',
      mechanism: 'Cofator descarboxilases (serotonina, dopamina, GABA)',
      interactions: 'Levodopa (reduz eficácia)',
      contraindications: 'Neuropatia periférica',
      notes: 'Forma ativa: P5P (piridoxal-5-fosfato)',
      dri: 'RDA: H(19-50) 1,3 mg/d, M(19-50) 1,3 mg/d | UL: 100 mg/d'
,
      ligantes: {
        default: 'Piridoxal-5-fosfato (P5P)',
        alternatives: ["Piridoxina (cloridrato)"],
        justificativa: 'P5P é forma ativa, não requer conversão'
      }
    },
    {
      id: 11,
      category: 'Complexo B',
      name: 'Vitamina B7',
      conditions: ['depressão', 'fadiga'],
      dosage: 'AI: 30 µg/d',
      timing: 'Qualquer horário',
      evidence: 'Moderada - Metabolismo energético',
      mechanism: 'Cofator carboxilases',
      interactions: 'Anticonvulsivantes',
      contraindications: 'Nenhuma conhecida',
      notes: 'Interfere em exames (troponina, TSH)',
      dri: 'AI: 30 µg/d'
,
      ligantes: {
        default: 'Biotina',
        alternatives: [],
        justificativa: 'Forma única disponível'
      }
    },
    {
      id: 12,
      category: 'Complexo B',
      name: 'Vitamina B9',
      conditions: ['depressão', 'esquizofrenia', 'bipolar', 'declínio cognitivo'],
      dosage: 'RDA: 400 µg DFE/d | Psiquiátrico: 7,5-15 mg L-metilfolato',
      timing: 'Pela manhã',
      evidence: 'Alta - Depressão resistente, MTHFR',
      mechanism: 'Síntese monoaminas, metilação, síntese DNA',
      interactions: 'Metotrexato, anticonvulsivantes',
      contraindications: 'Epilepsia não controlada',
      notes: 'L-metilfolato é forma ativa. 1 µg DFE = 1 µg folato + 1,7 µg ác. fólico',
      dri: 'RDA: 400 µg DFE/d | UL: 1000 µg/d (sintético)'
,
      ligantes: {
        default: 'L-metilfolato (5-MTHF)',
        alternatives: ["Ácido fólico"],
        justificativa: 'Forma ativa, ultrapassa mutação MTHFR (40-60% população)'
      }
    },
    {
      id: 13,
      category: 'Complexo B',
      name: 'Vitamina B12',
      conditions: ['depressão', 'fadiga', 'declínio cognitivo', 'neuropatia'],
      dosage: 'RDA: 2,4 µg/d | Terapêutico: 1000-2000 µg/d',
      timing: 'Manhã sublingual ou IM',
      evidence: 'Alta - Função neurológica',
      mechanism: 'Metilação, síntese mielina, metabolismo homocisteína',
      interactions: 'Metformina, IBP, antiácidos',
      contraindications: 'Doença de Leber (cianocobalamina)',
      notes: 'Formas ativas: metil e adenosilcobalamina. Veganos necessitam suplementação',
      dri: 'RDA: 2,4 µg/d'
,
      ligantes: {
        default: 'Metilcobalamina',
        alternatives: ["Hidroxocobalamina", "Adenosilcobalamina", "Cianocobalamina"],
        justificativa: 'Forma ativa, melhor para neuroproteção'
      }
    },
    {
      id: 14,
      category: 'Vitamina C',
      name: 'Vitamina C',
      conditions: ['depressão', 'ansiedade', 'fadiga', 'estresse'],
      dosage: 'RDA: H 90 mg/d | M 75 mg/d (+35 mg tabagista)',
      timing: 'Dividido 2-3x/dia',
      evidence: 'Moderada - Síntese neurotransmissores',
      mechanism: 'Cofator dopamina-β-hidroxilase, antioxidante',
      interactions: 'Ferro (aumenta absorção)',
      contraindications: 'Hemocromatose, cálculos oxalato',
      notes: 'Tabagistas: +35 mg/d',
      dri: 'RDA: H 90 mg/d, M 75 mg/d | UL: 2000 mg/d'
,
      ligantes: {
        default: 'Ascorbato (cálcio ou magnésio)',
        alternatives: ["Ácido ascórbico", "Vitamina C lipossomal"],
        justificativa: 'Ascorbato tem pH neutro, melhor tolerância GI'
      }
    },
    {
      id: 15,
      category: 'Complexo B',
      name: 'Colina',
      conditions: ['declínio cognitivo', 'alzheimer', 'fígado gorduroso'],
      dosage: 'AI: H 550 mg/d | M 425 mg/d',
      timing: 'Com refeições',
      evidence: 'Moderada - Precursor acetilcolina',
      mechanism: 'Síntese acetilcolina, fosfolipídios, metabolismo lipídico',
      interactions: 'Nenhuma significativa',
      contraindications: 'Trimetilaminúria',
      notes: 'Veganos necessitam suplementação',
      dri: 'AI: H 550 mg/d, M 425 mg/d | UL: 3500 mg/d'
,
      ligantes: {
        default: 'Bitartrato de colina',
        alternatives: ["Citicolina (CDP-colina)"],
        justificativa: 'Bitartrato é custo-efetivo'
      }
    },
    
    // ============ MINERAIS ============
    {
      id: 16,
      category: 'Minerais',
      name: 'Cálcio',
      conditions: ['ansiedade', 'insônia', 'tpm'],
      dosage: 'RDA: 1000-1200 mg/d',
      timing: 'Dividido (<500mg/vez). Citrato: jejum | Carbonato: comida',
      evidence: 'Moderada - Modulação neural',
      mechanism: 'Neurotransmissão, segundo mensageiro',
      interactions: 'Ferro, zinco (competição)',
      contraindications: 'Hipercalcemia, cálculos',
      notes: 'Combinar com D e K2',
      dri: 'RDA: 1000 mg/d (19-50a), 1200 mg/d (>50a M, >70a H) | UL: 2500 mg/d'
,
      ligantes: {
        default: 'Citrato',
        alternatives: ["Carbonato", "Malato", "Quelato AA"],
        justificativa: 'Citrato: absorção independente de acidez gástrica'
      }
    },
    {
      id: 17,
      category: 'Minerais',
      name: 'Magnésio',
      conditions: ['ansiedade', 'insônia', 'depressão', 'enxaqueca', 'tpm'],
      dosage: 'RDA: H 400-420 mg | M 310-320 mg elementar',
      timing: 'Noite: insônia | Dividido: ansiedade',
      evidence: 'Alta - NMDA e GABA',
      mechanism: 'Cofator >300 enzimas, modulação NMDA, GABAérgico',
      interactions: 'Quinolonas, tetraciclinas, bifosfonatos',
      contraindications: 'Insuficiência renal, bloqueio cardíaco',
      notes: 'Treonato: atravessa BHE | Glicinato: melhor GI',
      dri: 'RDA: H 400-420 mg/d, M 310-320 mg/d | UL: 350 mg/d (suplementar)'
,
      ligantes: {
        default: 'Glicinato',
        alternatives: ["Citrato", "Malato", "Treonato", "Óxido"],
        justificativa: 'Glicinato: absorção ~80%, sem efeito laxativo'
      }
    },
    {
      id: 18,
      category: 'Minerais',
      name: 'Ferro',
      conditions: ['depressão', 'fadiga', 'tdah', 'síndrome pernas inquietas'],
      dosage: 'RDA: H 8 mg/d | M(19-50a) 18 mg/d',
      timing: 'Jejum + vitamina C ou com comida (menos GI)',
      evidence: 'Alta - Síntese dopamina',
      mechanism: 'Transporte O₂, cofator tirosina hidroxilase',
      interactions: 'Cálcio, zinco, café, chá',
      contraindications: 'Hemocromatose, talassemia',
      notes: 'Dosar ferritina. Bisglicinato melhor tolerado',
      dri: 'RDA: H 8 mg/d, M(19-50) 18 mg/d, M(>50) 8 mg/d | UL: 45 mg/d'
,
      ligantes: {
        default: 'Bisglicinato',
        alternatives: ["Fumarato", "Polimaltosado", "Lipossomal"],
        justificativa: 'Bisglicinato: tolerância GI superior, biodisponibilidade 23-25%'
      }
    },
    {
      id: 19,
      category: 'Minerais',
      name: 'Zinco',
      conditions: ['depressão', 'tdah', 'ansiedade', 'imunidade'],
      dosage: 'RDA: H 11 mg/d | M 8 mg/d elementar',
      timing: 'Com refeição',
      evidence: 'Moderada-Alta - Modulação neurotransmissores',
      mechanism: 'Cofator >200 enzimas, modulação NMDA, neurogênese',
      interactions: 'Cobre (antagonismo), antibióticos',
      contraindications: 'Doença de Wilson',
      notes: 'Dosar cobre também. Balanço zinco-cobre',
      dri: 'RDA: H 11 mg/d, M 8 mg/d | UL: 40 mg/d'
,
      ligantes: {
        default: 'Bisglicinato',
        alternatives: ["Picolinato", "Citrato", "Sulfato"],
        justificativa: 'Bisglicinato: absorção 43%, sem náusea'
      }
    },
    {
      id: 20,
      category: 'Minerais',
      name: 'Cobre',
      conditions: ['anemia', 'função imune', 'saúde cardiovascular'],
      dosage: 'RDA: 900 µg/d',
      timing: 'Com alimentos',
      evidence: 'Moderada - Cofator enzimático',
      mechanism: 'Citocromo oxidase, superóxido dismutase',
      interactions: 'Zinco (antagonismo), vitamina C',
      contraindications: 'Doença de Wilson',
      notes: 'Balanço com zinco importante',
      dri: 'RDA: 900 µg/d | UL: 10 mg/d'
,
      ligantes: {
        default: 'Quelato AA',
        alternatives: ["Gluconato"],
        justificativa: 'Quelato AA: melhor absorção, baixa toxicidade'
      }
    },
    {
      id: 21,
      category: 'Minerais',
      name: 'Selênio',
      conditions: ['depressão', 'ansiedade', 'tireoideopatias'],
      dosage: 'RDA: 55 µg/d',
      timing: 'Qualquer horário',
      evidence: 'Moderada - Antioxidante, tireoide',
      mechanism: 'Selenoproteínas, glutationa peroxidase, conversão T4→T3',
      interactions: 'Nenhuma em doses fisiológicas',
      contraindications: 'Hipersensibilidade',
      notes: 'Castanha-do-pará: ~96 µg/unidade',
      dri: 'RDA: 55 µg/d | UL: 400 µg/d'
,
      ligantes: {
        default: 'L-selenometionina',
        alternatives: ["Selenito de sódio"],
        justificativa: 'Selenometionina: biodisponibilidade 90%'
      }
    },
    {
      id: 22,
      category: 'Minerais',
      name: 'Iodo',
      conditions: ['hipotireoidismo', 'saúde tireoidiana'],
      dosage: 'RDA: 150 µg/d',
      timing: 'Pela manhã',
      evidence: 'Alta - Hormônios tireoidianos',
      mechanism: 'Síntese T3 e T4',
      interactions: 'Lítio, amiodarona',
      contraindications: 'Tireoidite autoimune, hipertireoidismo',
      notes: 'Não exceder sem orientação',
      dri: 'RDA: 150 µg/d | UL: 1100 µg/d'
,
      ligantes: {
        default: 'Iodeto de potássio',
        alternatives: [],
        justificativa: 'Forma padrão, estável e bem absorvida'
      }
    },
    {
      id: 23,
      category: 'Minerais',
      name: 'Cromo (Picolinato)',
      conditions: ['diabetes', 'resistência insulina', 'compulsão alimentar'],
      dosage: 'AI: H(19-50) 35 µg/d | M(19-50) 25 µg/d',
      timing: 'Com refeições',
      evidence: 'Moderada - Sensibilidade insulina',
      mechanism: 'Potencializa ação insulina',
      interactions: 'Antiácidos, corticoides',
      contraindications: 'Insuficiência renal',
      notes: 'Picolinato: melhor absorção',
      dri: 'AI: H(19-50) 35 µg/d, M(19-50) 25 µg/d'
    },
    {
      id: 24,
      category: 'Minerais',
      name: 'Manganês',
      conditions: ['metabolismo ósseo', 'antioxidante'],
      dosage: 'AI: H 2,3 mg/d | M 1,8 mg/d',
      timing: 'Com alimentos',
      evidence: 'Moderada - Cofator enzimático',
      mechanism: 'Superóxido dismutase, metabolismo carboidratos',
      interactions: 'Ferro, cálcio',
      contraindications: 'Doença hepática, parkinsonismo',
      notes: 'Excesso neurotóxico',
      dri: 'AI: H 2,3 mg/d, M 1,8 mg/d | UL: 11 mg/d'
,
      ligantes: {
        default: 'Quelato AA',
        alternatives: ["Sulfato"],
        justificativa: 'Quelato: melhor absorção que sais inorgânicos'
      }
    },
    {
      id: 25,
      category: 'Minerais',
      name: 'Molibdênio',
      conditions: ['detoxificação'],
      dosage: 'RDA: 45 µg/d',
      timing: 'Qualquer horário',
      evidence: 'Moderada - Cofator enzimático',
      mechanism: 'Sulfito oxidase, xantina oxidase',
      interactions: 'Cobre (alta dose)',
      contraindications: 'Nenhuma conhecida',
      notes: 'Deficiência rara',
      dri: 'RDA: 45 µg/d | UL: 2000 µg/d'
,
      ligantes: {
        default: 'Quelato',
        alternatives: [],
        justificativa: 'Forma quelada é padrão'
      }
    },
    {
      id: 26,
      category: 'Minerais',
      name: 'Fósforo',
      conditions: ['saúde óssea', 'energia celular'],
      dosage: 'RDA: 700 mg/d',
      timing: 'Com alimentos',
      evidence: 'Alta - ATP',
      mechanism: 'Componente ATP, fosfolipídios, ácidos nucleicos',
      interactions: 'Antiácidos alumínio',
      contraindications: 'Insuficiência renal',
      notes: 'Excesso na dieta moderna',
      dri: 'RDA: 700 mg/d | UL: 4000 mg/d (19-70a), 3000 mg/d (>70a)'
,
      ligantes: {
        default: 'Fosfato de cálcio',
        alternatives: [],
        justificativa: 'Forma mineral padrão'
      }
    },
    {
      id: 27,
      category: 'Minerais',
      name: 'Potássio',
      conditions: ['hipertensão', 'saúde cardiovascular'],
      dosage: 'AI: H 3400 mg/d | M 2600 mg/d',
      timing: 'Dividido ao longo do dia',
      evidence: 'Alta - Pressão arterial',
      mechanism: 'Balanço eletrolítico, potencial membrana',
      interactions: 'IECA, BRA, espironolactona',
      contraindications: 'Insuficiência renal, hipercalemia',
      notes: 'Preferir fontes alimentares',
      dri: 'AI: H 3400 mg/d, M 2600 mg/d'
,
      ligantes: {
        default: 'Citrato',
        alternatives: ["Cloreto"],
        justificativa: 'Citrato: alcalinizante, melhor para saúde óssea'
      }
    },
    {
      id: 28,
      category: 'Minerais',
      name: 'Sódio',
      conditions: ['hiponatremia'],
      dosage: 'AI: 1500 mg/d | CDRR: máx 2300 mg/d',
      timing: 'Ao longo do dia',
      evidence: 'Alta - Balanço hídrico',
      mechanism: 'Balanço eletrolítico, volume extracelular',
      interactions: 'Diuréticos, lítio',
      contraindications: 'HAS não controlada, IC',
      notes: 'CDRR: 2300 mg/d redução risco DCV',
      dri: 'AI: 1500 mg/d | CDRR: 2300 mg/d'
    },
    {
      id: 29,
      category: 'Minerais',
      name: 'Flúor',
      conditions: ['saúde dental'],
      dosage: 'AI: H 4 mg/d | M 3 mg/d',
      timing: 'Via água fluoretada',
      evidence: 'Alta - Prevenção cáries',
      mechanism: 'Remineralização esmalte',
      interactions: 'Cálcio (alta dose)',
      contraindications: 'Fluorose',
      notes: 'Principalmente via água',
      dri: 'AI: H 4 mg/d, M 3 mg/d | UL: 10 mg/d'
,
      ligantes: {
        default: 'Fluoreto de sódio',
        alternatives: [],
        justificativa: 'Forma padrão de fluoretação'
      }
    },
    
    // ============ NUTRACÊUTICOS ESPECÍFICOS PSIQUIATRIA ============
    {
      id: 30,
      category: 'Ácidos Graxos',
      name: 'Ômega-3 (EPA/DHA)',
      conditions: ['depressão', 'ansiedade', 'bipolar', 'tdah', 'esquizofrenia'],
      dosage: '1000-2000mg EPA + 500-1000mg DHA/dia',
      timing: 'Com refeições',
      evidence: 'Alta - Múltiplos RCTs',
      mechanism: 'Anti-inflamatório, modulação membranas neuronais, neuroplasticidade',
      interactions: 'Anticoagulantes (monitorar)',
      contraindications: 'Distúrbios coagulação, cirurgia programada',
      notes: 'EPA>DHA (2:1) para depressão. DHA para cognição',
      dri: 'AI ALA: H 1,6 g/d, M 1,1 g/d | AMDR: 0,6-1,2% energia'
    },
    {
      id: 31,
      category: 'Aminoácidos',
      name: 'SAMe (S-Adenosil-Metionina)',
      conditions: ['depressão', 'toc', 'fibromialgia'],
      dosage: '400-1600 mg/d',
      timing: 'Manhã em jejum',
      evidence: 'Moderada-Alta - Depressão leve-moderada',
      mechanism: 'Doador metil, síntese neurotransmissores',
      interactions: 'Antidepressivos (risco síndrome serotoninérgica)',
      contraindications: 'Bipolaridade (risco mania)',
      notes: 'Início rápido (7-14 dias)',
      dri: 'Não estabelecido (nutracêutico)'
    },
    {
      id: 32,
      category: 'Aminoácidos',
      name: 'N-Acetilcisteína (NAC)',
      conditions: ['toc', 'tricotilomania', 'bipolar', 'esquizofrenia', 'dependências'],
      dosage: '1200-2400 mg/d',
      timing: 'Dividido 2x/dia',
      evidence: 'Moderada - TOC, tricotilomania',
      mechanism: 'Precursor glutationa, modulação glutamatérgica',
      interactions: 'Nitroglicerina (potencialização)',
      contraindications: 'Asma grave (raro broncoespasmo)',
      notes: 'Reduz craving em dependências',
      dri: 'Não estabelecido (nutracêutico)'
    },
    {
      id: 33,
      category: 'Aminoácidos',
      name: 'L-Teanina',
      conditions: ['ansiedade', 'tdah', 'insônia', 'estresse'],
      dosage: '100-400 mg/d',
      timing: '2-3x/dia ou antes estresse',
      evidence: 'Moderada - Ansiolítico sem sedação',
      mechanism: 'Modulação GABA e dopamina, ondas alfa',
      interactions: 'Sedativos (potencialização)',
      contraindications: 'Hipotensão grave',
      notes: 'Sinergia com cafeína para foco',
      dri: 'Não estabelecido (nutracêutico)'
    },
    {
      id: 34,
      category: 'Fitoterápicos',
      name: 'Ashwagandha (KSM-66)',
      conditions: ['ansiedade', 'estresse', 'insônia', 'fadiga'],
      dosage: '300-600 mg extrato 2x/dia',
      timing: 'Com refeições',
      evidence: 'Moderada - RCTs em ansiedade',
      mechanism: 'Adaptógeno, modulação cortisol',
      interactions: 'Sedativos, imunossupressores, hormônios tireoidianos',
      contraindications: 'Gestação, autoimunes, hipertireoidismo',
      notes: 'Reduz cortisol 25-30%',
      dri: 'Não estabelecido (fitoterápico)'
    },
    {
      id: 35,
      category: 'Aminoácidos',
      name: 'Creatina Monohidratada',
      conditions: ['depressão', 'bipolar', 'declínio cognitivo', 'fadiga'],
      dosage: '5 g/d manutenção',
      timing: 'Qualquer horário consistente',
      evidence: 'Emergente - Depressão resistente',
      mechanism: 'Metabolismo energético cerebral, fosfocreatina',
      interactions: 'AINES (risco renal teórico)',
      contraindications: 'Doença renal',
      notes: 'Eficaz em mulheres com depressão',
      dri: 'Não estabelecido (nutracêutico)'
    },
    {
      id: 36,
      category: 'Carboidratos',
      name: 'Inositol (Mio-inositol)',
      conditions: ['toc', 'pânico', 'depressão', 'sop'],
      dosage: '12-18 g/d',
      timing: 'Dividido 2-3x/dia',
      evidence: 'Moderada - Pânico e TOC',
      mechanism: 'Segundo mensageiro intracelular',
      interactions: 'Lítio (pode reduzir eficácia)',
      contraindications: 'Bipolaridade (cautela - ciclagem)',
      notes: 'Doses altas necessárias, sabor doce',
      dri: 'Não estabelecido (nutracêutico)'
    },
    {
      id: 37,
      category: 'Fitoterápicos',
      name: 'Rhodiola rosea',
      conditions: ['fadiga', 'depressão', 'ansiedade', 'burnout'],
      dosage: '200-600 mg extrato/dia',
      timing: 'Manhã e meio-dia',
      evidence: 'Moderada - Fadiga, burnout',
      mechanism: 'Adaptógeno, modulação monoaminas',
      interactions: 'Antidepressivos, estimulantes',
      contraindications: 'Bipolaridade (ativação)',
      notes: 'Evitar à noite',
      dri: 'Não estabelecido (fitoterápico)'
    },
    {
      id: 38,
      category: 'Fitoterápicos',
      name: 'Curcumina (com Piperina)',
      conditions: ['depressão', 'ansiedade', 'declínio cognitivo', 'inflamação'],
      dosage: '500-1000 mg 2x/dia + piperina',
      timing: 'Com refeições',
      evidence: 'Moderada - Anti-inflamatório',
      mechanism: 'Anti-inflamatório, antioxidante, ↑BDNF',
      interactions: 'Anticoagulantes, anti-diabéticos',
      contraindications: 'Obstrução biliar, cálculos',
      notes: 'Piperina ↑biodisponibilidade 2000%',
      dri: 'Não estabelecido (fitoterápico)'
    },
    {
      id: 39,
      category: 'Probióticos',
      name: 'Probióticos Psicotrópicos',
      conditions: ['depressão', 'ansiedade', 'eixo intestino-cérebro'],
      dosage: 'Lactobacillus + Bifidobacterium 10⁹-10¹⁰ UFC/dia',
      timing: 'Com refeição ou jejum',
      evidence: 'Emergente - Eixo intestino-cérebro',
      mechanism: 'Modulação microbiota-intestino-cérebro',
      interactions: 'Imunossupressores (cautela)',
      contraindications: 'Imunodeficiência grave, cateter central',
      notes: 'Cepas: L. helveticus R0052, B. longum R0175',
      dri: 'Não estabelecido (probiótico)'
    },
    {
      id: 40,
      category: 'Adaptógeno / modulador do eixo HPA',
      name: 'Withania somnifera (Ashwagandha)',
      conditions: ['ansiedade', 'depressão', 'estresse', 'insônia'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de cortisol, modulação GABAérgica, ação anti-inflamatória - **Dose clínica:** 300–600 mg/dia - **Segurança:** Geralmente bem tolerada; cautela em hiper/hipotireoidismo - **CYP450:** Pode inibir CYP3A4 e CYP2D6 (leve) - **Evidência:** Ensai...',
      interactions: 'CYP450: Pode inibir CYP3A4 e CYP2D6 (leve)',
      contraindications: 'Geralmente bem tolerada; cautela em hiper/hipotireoidismo',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 41,
      category: 'Adaptógeno',
      name: 'Rhodiola rosea',
      conditions: ['depressão', 'estresse', 'tdah', 'fadiga'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação de monoaminas, redução do estresse oxidativo, modulação eixo HPA - **Dose clínica:** 200–400 mg/dia - **Segurança:** Pode causar leve ativação; evitar à noite - **CYP450:** Pode inibir CYP2C9 e CYP2D6 (leve) - **Evidência:** ECR e meta-a...',
      interactions: 'CYP450: Pode inibir CYP2C9 e CYP2D6 (leve)',
      contraindications: 'Pode causar leve ativação; evitar à noite',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 42,
      category: 'Fitoterápico sedativo / GABAérgico',
      name: 'Valeriana officinalis',
      conditions: ['ansiedade', 'estresse', 'insônia'],
      dosage: '400–600 mg à noite (extrato seco padronizado)',
      timing: '400–600 mg à noite (extrato seco padronizado)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação GABA-A, adenosina - **Dose clínica:** 400–600 mg à noite (extrato seco padronizado) - **Segurança:** Pode causar sonolência residual - **CYP450:** Pode inibir CYP3A4 (baixo impacto clínico) - **Evidência:** ECR moderados. Indicações: Ins...',
      interactions: 'CYP450: Pode inibir CYP3A4 (baixo impacto clínico)',
      contraindications: 'Pode causar sonolência residual',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 43,
      category: 'Ansiolítico fitoterápico / GABAérgico',
      name: 'Passiflora incarnata',
      conditions: ['ansiedade', 'insônia'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Flavonoides com ação GABAérgica - **Dose clínica:** 300–600 mg/dia - **Segurança:** Boa tolerabilidade - **CYP450:** Sem dados clínicos relevantes - **Evidência:** Estudos clínicos controlados. Indicações: Ansiedade, insônia',
      interactions: 'CYP450: Sem dados clínicos relevantes',
      contraindications: 'Boa tolerabilidade',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 44,
      category: 'Ansiolítico leve / cognitivo',
      name: 'Melissa officinalis',
      conditions: ['ansiedade', 'estresse'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibição GABA-transaminase, colinérgico leve - **Dose clínica:** 300–600 mg/dia - **Segurança:** Muito segura - **CYP450:** Pode inibir CYP2C19 (baixo impacto) - **Evidência:** ECR pequenos. Indicações: Ansiedade, estresse, melhora cognitiva leve',
      interactions: 'CYP450: Pode inibir CYP2C19 (baixo impacto)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 45,
      category: 'Ansiolítico fitoterápico não sedativo',
      name: 'Lavandula angustifolia (Silexan®)',
      conditions: ['ansiedade'],
      dosage: '80 mg/dia',
      timing: '80 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação canais de cálcio, serotonina - **Dose clínica:** 80 mg/dia - **Segurança:** Não sedativo, comparável a ISRS em TAG leve - **CYP450:** Sem interação relevante - **Evidência:** ECR robustos (nível alto/A). Indicações: Transtorno de ansieda...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Não sedativo, comparável a ISRS em TAG leve',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 46,
      category: 'Cognitivo / neurovascular',
      name: 'Ginkgo biloba',
      conditions: ['declínio cognitivo'],
      dosage: '120–240 mg/dia',
      timing: '120–240 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Melhora fluxo cerebral, antioxidante - **Dose clínica:** 120–240 mg/dia - **Segurança:** Cautela com anticoagulantes - **CYP450:** Indução leve CYP2C19 - **Evidência:** Meta-análises. Indicações: Cognição, atenção, sintomas depressivos associados',
      interactions: 'CYP450: Indução leve CYP2C19',
      contraindications: 'Cautela com anticoagulantes',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 47,
      category: 'Cognitivo / ansiolítico leve',
      name: 'Bacopa monnieri',
      conditions: ['ansiedade', 'declínio cognitivo'],
      dosage: '300 mg/dia',
      timing: '300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação colinérgica, antioxidante - **Dose clínica:** 300 mg/dia - **Segurança:** Pode causar desconforto GI - **CYP450:** Sem dados relevantes - **Evidência:** ECR. Indicações: Memória, ansiedade',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode causar desconforto GI',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 48,
      category: 'Antidepressivo adjuvante / anti-inflamatório',
      name: 'Curcuma longa',
      conditions: ['depressão'],
      dosage: '500–1000 mg/dia',
      timing: '500–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Anti-inflamatório, BDNF, NF-κB - **Dose clínica:** 500–1000 mg/dia - **Segurança:** Muito boa - **CYP450:** Pode inibir CYP3A4 e CYP2C9 (leve) - **Evidência:** Meta-análises. Indicações: Depressão, neuroinflamação',
      interactions: 'CYP450: Pode inibir CYP3A4 e CYP2C9 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Curcumina + Piperina',
        alternatives: ["Fitossoma", "Lipossomal"],
        justificativa: 'Piperina aumenta biodisponibilidade'
      }
    },
    {
      id: 49,
      category: 'Adaptógeno cognitivo',
      name: 'Panax ginseng',
      conditions: ['depressão', 'declínio cognitivo', 'insônia', 'fadiga'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação dopamina/noradrenalina, eixo HPA - **Dose clínica:** 200–400 mg/dia - **Segurança:** Pode causar ativação/insônia - **CYP450:** Pode induzir CYP3A4 - **Evidência:** ECR moderados e estudos clínicos. Indicações: Fadiga, cognição, depressã...',
      interactions: 'CYP450: Pode induzir CYP3A4',
      contraindications: 'Pode causar ativação/insônia',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 50,
      category: 'Cognitivo',
      name: 'Huperzia serrata',
      conditions: ['declínio cognitivo'],
      dosage: '50–200 mcg/dia',
      timing: '50–200 mcg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibidor acetilcolinesterase - **Dose clínica:** 50–200 mcg/dia - **Segurança:** Evitar associação com outros colinérgicos - **CYP450:** Sem dados relevantes - **Evidência:** Ensaios clínicos. Indicações: Memória, atenção',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Evitar associação com outros colinérgicos',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 51,
      category: 'Ansiolítico / cognitivo',
      name: 'Centella asiatica',
      conditions: ['ansiedade', 'declínio cognitivo'],
      dosage: '500–750 mg/dia',
      timing: '500–750 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação GABA, neuroplasticidade - **Dose clínica:** 500–750 mg/dia - **Segurança:** Boa - **CYP450:** Dados insuficientes - **Evidência:** Estudos clínicos. Indicações: Ansiedade, memória',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 52,
      category: 'Antidepressivo fitoterápico',
      name: 'Hypericum perforatum',
      conditions: ['depressão'],
      dosage: '600–900 mg/dia',
      timing: '600–900 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibição recaptação monoaminas - **Dose clínica:** 600–900 mg/dia - **Segurança:** Alto risco de interações medicamentosas - **CYP450:** Indutor potente CYP3A4, 2C9, 2C19 - **Evidência:** Alta (com ressalvas). Indicações: Depressão leve a moderada',
      interactions: 'CYP450: Indutor potente CYP3A4, 2C9, 2C19',
      contraindications: 'Alto risco de interações medicamentosas',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 53,
      category: 'Dopaminérgico natural',
      name: 'Mucuna pruriens',
      conditions: ['tdah', 'bipolar'],
      dosage: '100–300 mg de L-DOPA equivalente',
      timing: '100–300 mg de L-DOPA equivalente',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fonte de L-DOPA - **Dose clínica:** 100–300 mg de L-DOPA equivalente - **Segurança:** Cautela em transtornos bipolares - **CYP450:** Sem dados claros - **Evidência:** Ensaios clínicos. Indicações: Anedonia, TDAH (off-label)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Cautela em transtornos bipolares',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 54,
      category: 'Estimulante não adrenérgico / ansiolítico',
      name: 'Camellia sinensis (Teanina extraída)',
      conditions: ['ansiedade', 'fadiga'],
      dosage: '100–400 mg/dia',
      timing: '100–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Adenosina/dopamina, GABA, ondas alfa - **Dose clínica:** 100–400 mg/dia - **Segurança:** Sem efeito rebote, excelente - **CYP450:** Não inibe CYP1A2, CYP3A4 ou 2D6 - **Evidência:** Ensaios clínicos e meta-análises. Indicações: Atenção, fadiga ment...',
      interactions: 'CYP450: Não inibe CYP1A2, CYP3A4 ou 2D6',
      contraindications: 'Sem efeito rebote, excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 55,
      category: 'Adaptógeno clássico',
      name: 'Eleutherococcus senticosus (Ginseng siberiano)',
      conditions: ['estresse', 'fadiga'],
      dosage: '300–800 mg/dia',
      timing: '300–800 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Adaptógeno clássico HPA - **Dose clínica:** 300–800 mg/dia - **Segurança:** Boa - **CYP450:** Dados insuficientes - **Evidência:** Ensaios clínicos. Indicações: Estresse, fadiga crônica',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 56,
      category: 'Adaptógeno',
      name: 'Schisandra chinensis',
      conditions: ['estresse', 'declínio cognitivo', 'fadiga'],
      dosage: '500–1500 mg/dia',
      timing: '500–1500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Eixo HPA, antioxidante - **Dose clínica:** 500–1500 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP3A4 (moderado) - **Evidência:** Estudos humanos. Indicações: Estresse, cognição, fadiga',
      interactions: 'CYP450: Inibe CYP3A4 (moderado)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 57,
      category: 'Adaptógeno',
      name: 'Ocimum sanctum (Tulsi/Holy Basil)',
      conditions: ['ansiedade', 'estresse'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Cortisol e inflamação - **Dose clínica:** 300–600 mg/dia - **Segurança:** Boa - **CYP450:** Pode inibir CYP3A4 - **Evidência:** Ensaios clínicos. Indicações: Ansiedade, estresse',
      interactions: 'CYP450: Pode inibir CYP3A4',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 58,
      category: 'Modulador adrenal',
      name: 'Glycyrrhiza glabra (Alcaçuz DGL)',
      conditions: ['fadiga'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Prolonga ação do cortisol - **Dose clínica:** 200–400 mg/dia - **Segurança:** Evitar hipertensos - **CYP450:** Inibe CYP3A4 - **Evidência:** Estudos clínicos. Indicações: Fadiga adrenal selecionada',
      interactions: 'CYP450: Inibe CYP3A4',
      contraindications: 'Evitar hipertensos',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 59,
      category: 'Adaptógeno energético',
      name: 'Cordyceps sinensis / militaris',
      conditions: ['fadiga'],
      dosage: '1000–3000 mg/dia',
      timing: '1000–3000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'ATP mitocondrial, HPA - **Dose clínica:** 1000–3000 mg/dia - **Segurança:** Boa - **CYP450:** Dados insuficientes - **Evidência:** Estudos humanos. Indicações: Fadiga, energia mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 60,
      category: 'Adaptógeno calmante',
      name: 'Ganoderma lucidum (Reishi)',
      conditions: ['ansiedade', 'estresse', 'insônia'],
      dosage: '1000–3000 mg/dia',
      timing: '1000–3000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Imunomodulação e HPA - **Dose clínica:** 1000–3000 mg/dia - **Segurança:** Boa - **CYP450:** Dados insuficientes - **Evidência:** Ensaios clínicos. Indicações: Ansiedade, sono, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 61,
      category: 'Adaptógeno imuno-energético',
      name: 'Astragalus membranaceus',
      conditions: ['estresse', 'fadiga'],
      dosage: '500–1500 mg/dia',
      timing: '500–1500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'HPA e imunidade - **Dose clínica:** 500–1500 mg/dia - **Segurança:** Boa - **CYP450:** Dados limitados - **Evidência:** Estudos humanos. Indicações: Fadiga, estresse crônico',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 62,
      category: 'Adaptógeno',
      name: 'Lepidium meyenii (Maca)',
      conditions: ['fadiga'],
      dosage: '1500–3000 mg/dia',
      timing: '1500–3000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação HPA - **Dose clínica:** 1500–3000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Fadiga, humor',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 63,
      category: 'Ansiolítico modulador HPA',
      name: 'Magnolia officinalis',
      conditions: ['ansiedade', 'estresse', 'insônia'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'GABA, cortisol - **Dose clínica:** 200–400 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP1A2 e CYP2C9 - **Evidência:** Ensaios clínicos. Indicações: Ansiedade, insônia por estresse',
      interactions: 'CYP450: Inibe CYP1A2 e CYP2C9',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 64,
      category: 'Sedativo GABAérgico',
      name: 'Zizyphus jujuba (Suan Zao Ren)',
      conditions: ['insônia'],
      dosage: '250–500 mg/noite',
      timing: '250–500 mg/noite',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'GABA e HPA - **Dose clínica:** 250–500 mg/noite - **Segurança:** Boa - **CYP450:** Dados insuficientes - **Evidência:** Estudos humanos. Indicações: Insônia por hiperexcitação',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 65,
      category: 'Antidepressivo fitoterápico',
      name: 'Crocus sativus (Saffron/Açafrão)',
      conditions: ['depressão'],
      dosage: '30 mg/dia',
      timing: '30 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Serotonina + HPA - **Dose clínica:** 30 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** Meta-análises --- ## BIOATIVOS PATENTEADOS COM USO CLÍNICO EM PSIQUIATRIA {#bioativos-patenteados}. Indicações: Depressão leve a...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 66,
      category: 'Ansiolítico / modulador do humor patenteado',
      name: 'Zembrin® (Sceletium tortuosum)',
      conditions: ['ansiedade', 'estresse'],
      dosage: '25–50 mg/dia',
      timing: '25–50 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibidor PDE-4, modulador serotoninérgico - **Dose clínica:** 25–50 mg/dia - **Segurança:** Excelente; não sedativo - **CYP450:** Sem inibição relevante - **Evidência:** ECR placebo-controlados. Indicações: Ansiedade, estresse, humor deprimido',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Excelente; não sedativo',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 67,
      category: 'Modulador do eixo HPA patenteado / ansiolítico não sedativo',
      name: 'Serenzo® (Citrus sinensis)',
      conditions: ['ansiedade', 'estresse'],
      dosage: '250 mg/dia',
      timing: '250 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de cortisol salivar via flavonoides cítricos - **Dose clínica:** 250 mg/dia - **Segurança:** Muito alto perfil de segurança - **CYP450:** Não inibe CYP3A4 ou 2D6 - **Evidência:** Ensaios clínicos randomizados - **Observação:** Extrato de l...',
      interactions: 'CYP450: Não inibe CYP3A4 ou 2D6',
      contraindications: 'Muito alto perfil de segurança | Extrato de laranja doce padronizado',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 68,
      category: 'Ansiolítico adaptógeno patenteado',
      name: 'Relora® (Magnolia officinalis + Phellodendron amurense)',
      conditions: ['ansiedade', 'estresse'],
      dosage: '250–500 mg/dia',
      timing: '250–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução do cortisol, ação GABAérgica - **Dose clínica:** 250–500 mg/dia - **Segurança:** Pode causar sedação leve - **CYP450:** Magnolia: possível inibição CYP1A2 (teórica) - **Evidência:** Estudos clínicos humanos. Indicações: Ansiedade, compulsã...',
      interactions: 'CYP450: Magnolia: possível inibição CYP1A2 (teórica)',
      contraindications: 'Pode causar sedação leve',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 69,
      category: 'Ansiolítico não sedativo patenteado',
      name: 'Silexan® (Lavandula angustifolia)',
      conditions: ['ansiedade'],
      dosage: '80 mg/dia',
      timing: '80 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação canais de cálcio e serotonina - **Dose clínica:** 80 mg/dia - **Segurança:** Comparável a ISRS em TAG leve - **CYP450:** Sem interações relevantes - **Evidência:** ECR robustos (nível A). Indicações: TAG, ansiedade subclínica',
      interactions: 'CYP450: Sem interações relevantes',
      contraindications: 'Comparável a ISRS em TAG leve',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Extrato seco padronizado',
        alternatives: ["Extrato fluido", "Tintura"],
        justificativa: 'Extrato seco garante concentração e padronização dos ativos'
      }
    },
    {
      id: 70,
      category: 'Cognitivo / atenção patenteado',
      name: 'Neuravena® (Avena sativa verde)',
      conditions: ['declínio cognitivo', 'fadiga'],
      dosage: '800–1600 mg/dia',
      timing: '800–1600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação dopaminérgica e colinérgica - **Dose clínica:** 800–1600 mg/dia - **Segurança:** Muito segura - **CYP450:** Dados insuficientes - **Evidência:** Ensaios clínicos em humanos. Indicações: Atenção, memória de trabalho, fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 71,
      category: 'Estimulante cognitivo não adrenérgico patenteado',
      name: 'EnXtra® (Alpinia galanga)',
      conditions: ['tdah'],
      dosage: '300 mg/dia',
      timing: '300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Adenosina/dopamina (sem aumento de FC/PA) - **Dose clínica:** 300 mg/dia - **Segurança:** Sem efeito rebote - **CYP450:** Não inibe CYP1A2 - **Evidência:** Estudos clínicos controlados. Indicações: Atenção, energia mental, TDAH adulto',
      interactions: 'CYP450: Não inibe CYP1A2',
      contraindications: 'Sem efeito rebote',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 72,
      category: 'Estimulante cognitivo patenteado',
      name: 'TeaCrine® (Teacrine)',
      conditions: ['fadiga'],
      dosage: '100–200 mg/dia',
      timing: '100–200 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação dopaminérgica e adenosinérgica - **Dose clínica:** 100–200 mg/dia - **Segurança:** Não gera tolerância - **CYP450:** Sem inibição relevante - **Evidência:** ECR. Indicações: Atenção, motivação, fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Não gera tolerância',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 73,
      category: 'Energizante mitocondrial biodisponível / Biomassa marinha patenteada',
      name: 'Bio-Arct® (Exsymol)',
      conditions: ['declínio cognitivo', 'fadiga'],
      dosage: '100–1000 mg/dia',
      timing: '100–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '- Citrulil-arginina: ↑ síntese de NO endógeno, ↑ ATP mitocondrial - Taurina: Detoxificação, proteção DNA, antioxidante - Melhora fluxo sanguíneo cerebral e rejuvenescimento sistêmico - **Dose clínica:** 100–1000 mg/dia - **Segurança:** Excelente (...)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Excelente (produto endógeno, totalmente compatível com organismo) | Produto validado com tecnologia patenteada de extração',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 74,
      category: 'Modulador mitocondrial patenteado',
      name: 'Niagen® (Nicotinamide Riboside)',
      conditions: ['fadiga'],
      dosage: '250–300 mg/dia',
      timing: '250–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '↑ NAD+, função mitocondrial - **Dose clínica:** 250–300 mg/dia - **Segurança:** Excelente - **CYP450:** Sem inibição conhecida - **Evidência:** Ensaios clínicos humanos. Indicações: Fadiga mental, envelhecimento cerebral',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 75,
      category: 'Neuroprotetor mitocondrial',
      name: 'PQQ (Pirroloquinolina Quinona)',
      conditions: ['declínio cognitivo', 'fadiga'],
      dosage: '10–20 mg/dia (alguns estudos até 40 mg/dia)',
      timing: '10–20 mg/dia (alguns estudos até 40 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Biogênese mitocondrial, estimula PGC-1α, antioxidante redox - **Dose clínica:** 10–20 mg/dia (alguns estudos até 40 mg/dia) - **Segurança:** Muito boa - **CYP450:** Dados insuficientes - **Evidência:** Ensaios clínicos humanos (Nakano 2012, Harris...)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Prescrever como \"PQQ dissódico\"; pode não estar em estoque regular; considerar alternativa mitocondrial se indisponível | Disponibilidade: ⚠️ Limitada - **Verificar com farmácia antes de prescrever**',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 76,
      category: 'Antioxidante neuroprotetor patenteado',
      name: 'GliSODin®',
      conditions: ['estresse'],
      dosage: '250–500 mg/dia',
      timing: '250–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'SOD biodisponível - **Dose clínica:** 250–500 mg/dia - **Segurança:** Excelente - **CYP450:** Não descrito - **Evidência:** Estudos clínicos. Indicações: Estresse oxidativo cerebral',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 77,
      category: 'Fosfolipídio neuronal',
      name: 'Fosfatidilserina',
      conditions: ['estresse', 'tdah', 'declínio cognitivo'],
      dosage: '100–300 mg/dia (estudos clássicos: 300 mg/dia)',
      timing: '100–300 mg/dia (estudos clássicos: 300 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação eixo HPA (redução cortisol), sinalização sináptica, fluidez de membrana neuronal - **Dose clínica:** 100–300 mg/dia (estudos clássicos: 300 mg/dia) - **Segurança:** Muito segura - **CYP450:** Sem interação - **Evidência:** ECR robustos (...)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Prescrever pelo nome genérico \"Fosfatidilserina\"; marca Sharp-PS® tipicamente não disponível para manipulação',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    },
    {
      id: 78,
      category: 'Anti-fadiga / mitocondrial patenteado',
      name: 'Robuvit® (Quercus robur)',
      conditions: ['fadiga'],
      dosage: '300–500 mg/dia',
      timing: '300–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '↑ ATP mitocondrial - **Dose clínica:** 300–500 mg/dia - **Segurança:** Muito boa - **CYP450:** Sem dados relevantes - **Evidência:** Estudos clínicos humanos. Indicações: Fadiga mental, burnout',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 79,
      category: 'Compostos Bioativos',
      name: 'Curcumina Biodisponível - Opções para Prescrição',
      conditions: ['ansiedade', 'depressão'],
      dosage: 'Conforme orientação clínica',
      timing: 'Conforme orientação clínica',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '. Indicações: Depressão maior, ansiedade',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Solicitar ao farmacêutico forma com melhor biodisponibilidade disponível',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Curcumina + Piperina',
        alternatives: ["Fitossoma", "Lipossomal"],
        justificativa: 'Piperina aumenta biodisponibilidade'
      }
    },
    {
      id: 80,
      category: 'Curcumina biodisponível patenteada',
      name: 'Cureit® (Sovita)',
      conditions: ['depressão'],
      dosage: '25–500 mg/dia',
      timing: '25–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante (↑ SOD, catalase, glutationa), anti-inflamatório (bloqueio NF-κB, ↓ TNF-α) - **Dose clínica:** 25–500 mg/dia - **Biodisponibilidade:** 10x superior à curcumina padrão (95%) - **Segurança:** Excelente, meia-vida de 8 horas - **CYP450:*...',
      interactions: 'CYP450: Pode inibir CYP3A4 e CYP2C9 (leve)',
      contraindications: 'Excelente, meia-vida de 8 horas | Produto nacional validado, 100% natural',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 81,
      category: 'Curcuminoide hidrogenado hidrossolúvel patenteado',
      name: 'CuroWhite™ (Sovita)',
      conditions: ['depressão'],
      dosage: '200–500 mg/dia',
      timing: '200–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante (↑ enzimas antioxidantes), anti-inflamatório (bloqueio NF-κB, ↓ TNF-α) - **Dose clínica:** 200–500 mg/dia - **Biodisponibilidade:** 6x superior à curcumina padrão (melhor absorção sustentada) - **Segurança:** Excelente - **CYP450:** P...',
      interactions: 'CYP450: Potencial inibição leve CYP3A4',
      contraindications: 'Produto nacional validado, ideal para formulações diferenciadas (refresco, gomas, gel, sopa)',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 82,
      category: 'Imunomodulador neuroinflamatório patenteado',
      name: 'Betamune® SC 70',
      conditions: ['depressão'],
      dosage: '250–500 mg/dia',
      timing: '250–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Beta-glucanas → eixo imune-SNC, imunomodulação via receptores de complemento - **Dose clínica:** 250–500 mg/dia - **Segurança:** Muito boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos humanos - **Observação:** ⚠️ **Verificar dispo...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: '⚠️ **Verificar disponibilidade com fornecedores** (Galena, Lemma, Sovita, Infinity Pharma)',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 83,
      category: 'Silício biodisponível',
      name: 'Silício Orgânico (ch-OSA)',
      conditions: ['declínio cognitivo'],
      dosage: '5–10 mg de silício elementar/dia (equivalente a 100-200 mg do complexo ch-OSA)',
      timing: '5–10 mg de silício elementar/dia (equivalente a 100-200 mg do complexo ch-OSA)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Suporte estrutural neuronal, síntese de colágeno, antioxidante - **Dose clínica:** 5–10 mg de silício elementar/dia (equivalente a 100-200 mg do complexo ch-OSA) - **Segurança:** Alta/excelente - **CYP450:** Não relevante - **Evidência:** Estudos ...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Alta/excelente | Prescrever como \"Silício orgânico (ch-OSA)\" ou \"Ácido ortosilícico estabilizado com colina\"; marca Biosil® tipicamente não disponível para manipulação | Disponibilidade: ⚠️ Limitada - **Verificar com farmácia antes de prescrever**',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 84,
      category: 'Fitocomplexo ansiolítico patenteado',
      name: 'Seditol® (Melissa officinalis + Magnolia officinalis)',
      conditions: ['ansiedade', 'estresse'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Melissa (inibição GABA-transaminase) + Magnolia (honokiol/magnolol GABAérgico, redução cortisol) - **Dose clínica:** 300–600 mg/dia - **Segurança:** Muito boa - **CYP450:** Magnolia pode inibir CYP1A2 e CYP2C9 (teórico) - **Evidência:** Estudos cl...',
      interactions: 'CYP450: Magnolia pode inibir CYP1A2 e CYP2C9 (teórico)',
      contraindications: 'Combinação específica patenteada, não confundir com blends genéricos',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 85,
      category: 'Precursor serotoninérgico',
      name: 'L-Triptofano',
      conditions: ['ansiedade', 'depressão', 'insônia'],
      dosage: '500–2000 mg/dia (geralmente à noite)',
      timing: '500–2000 mg/dia (geralmente à noite)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Precursor de serotonina e melatonina - **Dose clínica:** 500–2000 mg/dia (geralmente à noite) - **Segurança:** Evitar associação com ISRS em doses altas - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos humanos. Indicações: Depressão l...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Evitar associação com ISRS em doses altas',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Triptofano',
        alternatives: ["Forma livre"],
        justificativa: 'L-Triptofano é a forma padrão de uso clínico'
      }
    },
    {
      id: 86,
      category: 'Modulador serotoninérgico direto',
      name: '5-HTP (5-hidroxitriptofano)',
      conditions: ['ansiedade', 'depressão', 'insônia'],
      dosage: '50–300 mg/dia',
      timing: '50–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Conversão direta em serotonina - **Dose clínica:** 50–300 mg/dia - **Segurança:** Risco teórico de síndrome serotoninérgica, cautela com ISRS - **CYP450:** Não relevante - **Evidência:** Estudos clínicos controlados e ensaios clínicos. Indicações:...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Risco teórico de síndrome serotoninérgica, cautela com ISRS',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 87,
      category: 'Precursor catecolaminérgico',
      name: 'L-Tirosina',
      conditions: ['ansiedade', 'estresse', 'tdah', 'fadiga'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Precursor de dopamina e noradrenalina - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Pode aumentar ansiedade em doses altas; boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos humanos. Indicações: TDAH, fadiga mental, estresse...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode aumentar ansiedade em doses altas; boa',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Tirosina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Tirosina é a forma padrão de uso clínico'
      }
    },
    {
      id: 88,
      category: 'Dopaminérgico funcional',
      name: 'Acetil-L-Tirosina',
      conditions: ['tdah', 'fadiga'],
      dosage: '300–1000 mg/dia',
      timing: '300–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Precursor catecolaminas com melhor biodisponibilidade - **Dose clínica:** 300–1000 mg/dia - **Segurança:** Similar à L-tirosina - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: TDAH, fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Similar à L-tirosina',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Acetil-L-Tirosina',
        alternatives: ["Forma livre"],
        justificativa: 'Acetil-L-Tirosina é a forma padrão de uso clínico'
      }
    },
    {
      id: 89,
      category: 'Dopaminérgico / modulador do humor',
      name: 'L-Fenilalanina (DLPA incluído)',
      conditions: ['depressão', 'bipolar'],
      dosage: '500–1500 mg/dia',
      timing: '500–1500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '↑ dopamina e endorfinas - **Dose clínica:** 500–1500 mg/dia - **Segurança:** Evitar em transtorno bipolar - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Depressão, anedonia, foco',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Evitar em transtorno bipolar',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Fenilalanina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Fenilalanina é a forma padrão de uso clínico'
      }
    },
    {
      id: 90,
      category: 'Modulador glutamatérgico / neurotransmissor inibitório',
      name: 'Glicina',
      conditions: ['ansiedade', 'insônia'],
      dosage: '3–10 g/dia (3-5 g/noite para sono)',
      timing: '3–10 g/dia (3-5 g/noite para sono)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Agonista NMDA (sítio glicina), receptor NMDA/glicina - **Dose clínica:** 3–10 g/dia (3-5 g/noite para sono) - **Segurança:** Muito segura/excelente - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Insônia, ansiedade, esqu...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Muito segura/excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 91,
      category: 'Neuroprotetor / ansiolítico / neurotransmissor inibitório',
      name: 'Taurina',
      conditions: ['ansiedade', 'estresse', 'insônia'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação GABA e glicina, GABA-like - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Alta/excelente - **CYP450:** Não relevante - **Evidência:** Estudos clínicos humanos. Indicações: Ansiedade, estresse, humor, sono',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Alta/excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 92,
      category: 'Neuroenergético / antidepressivo / transporte mitocondrial',
      name: 'Acetil-L-Carnitina (ALCAR)',
      conditions: ['depressão', 'tdah', 'declínio cognitivo', 'fadiga'],
      dosage: '500–2000 mg/dia (1000-2000 mg/dia)',
      timing: '500–2000 mg/dia (1000-2000 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Função mitocondrial, acetilcolina, metabolismo energético cerebral - **Dose clínica:** 500–2000 mg/dia (1000-2000 mg/dia) - **Segurança:** Pode causar ativação; excelente - **CYP450:** Não relevante - **Evidência:** Meta-análises em depressão. Ind...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode causar ativação; excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Acetil-L-Carnitina',
        alternatives: ["Forma livre"],
        justificativa: 'Acetil-L-Carnitina é a forma padrão de uso clínico'
      }
    },
    {
      id: 93,
      category: 'Energia cerebral',
      name: 'L-Carnitina',
      conditions: ['depressão', 'fadiga'],
      dosage: '1000–3000 mg/dia',
      timing: '1000–3000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Transporte mitocondrial de ácidos graxos - **Dose clínica:** 1000–3000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Fadiga mental, depressão',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Carnitina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Carnitina é a forma padrão de uso clínico'
      }
    },
    {
      id: 94,
      category: 'Modulador glutamatérgico / antioxidante / redox',
      name: 'N-Acetilcisteína (NAC)',
      conditions: ['depressão', 'bipolar'],
      dosage: '1200–3000 mg/dia (1200-2400 mg/dia)',
      timing: '1200–3000 mg/dia (1200-2400 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação do glutamato e glutationa - **Dose clínica:** 1200–3000 mg/dia (1200-2400 mg/dia) - **Segurança:** Excelente/boa - **CYP450:** Não relevante - **Evidência:** ECR e meta-análises. Indicações: Depressão, TOC, dependência, bipolar, adições',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Excelente/boa',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'N-Acetilcisteína',
        alternatives: ["Forma livre"],
        justificativa: 'N-Acetilcisteína é a forma padrão de uso clínico'
      }
    },
    {
      id: 95,
      category: 'Suporte neuroenergético',
      name: 'L-Glutamina',
      conditions: ['estresse', 'fadiga'],
      dosage: '5–15 g/dia',
      timing: '5–15 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Precursor glutamato/GABA - **Dose clínica:** 5–15 g/dia - **Segurança:** Evitar em epilepsia não controlada - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Estresse, fadiga, eixo intestino-cérebro',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Evitar em epilepsia não controlada',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Glutamina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Glutamina é a forma padrão de uso clínico'
      }
    },
    {
      id: 96,
      category: 'Modulador vascular / cognitivo',
      name: 'L-Arginina',
      conditions: ['depressão', 'declínio cognitivo', 'fadiga'],
      dosage: '2–6 g/dia',
      timing: '2–6 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Óxido nítrico cerebral - **Dose clínica:** 2–6 g/dia - **Segurança:** Pode causar desconforto GI - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, fadiga, depressão associada',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode causar desconforto GI',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Arginina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Arginina é a forma padrão de uso clínico'
      }
    },
    {
      id: 97,
      category: 'Neurovascular indireto',
      name: 'L-Citrulina',
      conditions: ['declínio cognitivo'],
      dosage: '1–3 g/dia',
      timing: '1–3 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '↑ arginina e NO - **Dose clínica:** 1–3 g/dia - **Segurança:** Muito boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Energia mental, cognição',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Citrulina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Citrulina é a forma padrão de uso clínico'
      }
    },
    {
      id: 98,
      category: 'Neuroenergético / bioenergético cerebral',
      name: 'Creatina Monohidratada',
      conditions: ['depressão', 'declínio cognitivo', 'fadiga'],
      dosage: '3–5 g/dia',
      timing: '3–5 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'ATP cerebral, neuroplasticidade, aumento de ATP cerebral - **Dose clínica:** 3–5 g/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR em depressão e meta-análises. Indicações: Depressão (especialmente feminina), cogniç...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 99,
      category: 'Buffer neurometabólico',
      name: 'Beta-Alanina',
      conditions: ['fadiga'],
      dosage: '2–4 g/dia',
      timing: '2–4 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: '↑ carnosina cerebral - **Dose clínica:** 2–4 g/dia - **Segurança:** Parestesia transitória - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Parestesia transitória',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 100,
      category: 'Anti-estresse',
      name: 'Ornitina',
      conditions: ['estresse', 'insônia'],
      dosage: '400–2000 mg/dia',
      timing: '400–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de amônia, cortisol - **Dose clínica:** 400–2000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Estresse, insônia',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 101,
      category: 'Ansiolítico / neurotransmissor funcional',
      name: 'GABA (fermentado)',
      conditions: ['ansiedade', 'insônia'],
      dosage: '100–750 mg/dia (100-300 mg/dia)',
      timing: '100–750 mg/dia (100-300 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Ação periférica/GABA entérico, GABA periférico - **Dose clínica:** 100–750 mg/dia (100-300 mg/dia) - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos humanos e estudos humanos. Indicações: Ansiedade, insônia',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 102,
      category: 'Antidepressivo nutracêutico / metilação',
      name: 'SAMe (S-Adenosil-Metionina)',
      conditions: ['depressão', 'declínio cognitivo'],
      dosage: '400–1600 mg/dia',
      timing: '400–1600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Metilação, monoaminas - **Dose clínica:** 400–1600 mg/dia - **Segurança:** Pode induzir hipomania; boa - **CYP450:** Não relevante - **Evidência:** Meta-análises robustas. Indicações: Depressão, cognição, depressão maior',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode induzir hipomania; boa',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'SAMe',
        alternatives: ["Forma livre"],
        justificativa: 'SAMe é a forma padrão de uso clínico'
      }
    },
    {
      id: 103,
      category: 'Neuroplasticidade',
      name: 'L-Serina',
      conditions: ['declínio cognitivo'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fosfolipídios - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos --- ## COMPOSTOS BIOATIVOS NATURAIS E FUNCIONAIS {#compostos-bioativos}. Indicações: Cognição, neuroproteção',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'L-Serina',
        alternatives: ["Forma livre"],
        justificativa: 'L-Serina é a forma padrão de uso clínico'
      }
    },
    {
      id: 104,
      category: 'Polifenol neuroprotetor',
      name: 'Resveratrol',
      conditions: ['depressão', 'declínio cognitivo'],
      dosage: '150–500 mg/dia',
      timing: '150–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Ativação SIRT1, BDNF, anti-inflamatório - **Dose clínica:** 150–500 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP3A4 e CYP2D6 (leve), CYP2C9 (leve) - **Evidência:** Ensaios clínicos humanos. Indicações: Depressão, cognição, neuroinflamação, ...',
      interactions: 'CYP450: Inibe CYP3A4 e CYP2D6 (leve), CYP2C9 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 105,
      category: 'Flavonoide neuroinflamatório / neuroprotetor',
      name: 'Quercetina',
      conditions: ['ansiedade', 'depressão'],
      dosage: '500–1000 mg/dia',
      timing: '500–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante, modulação microglial, microglia - **Dose clínica:** 500–1000 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP3A4 e 2C19 (moderado, teórico), CYP3A4 (leve) - **Evidência:** Estudos clínicos humanos. Indicações: Depressão, ansiedade...',
      interactions: 'CYP450: Inibe CYP3A4 e 2C19 (moderado, teórico), CYP3A4 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 106,
      category: 'Modulador mitocondrial',
      name: 'Coenzima Q10 (Ubiquinona/Ubiquinol)',
      conditions: ['depressão', 'declínio cognitivo', 'fadiga'],
      dosage: '100–300 mg/dia',
      timing: '100–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Cadeia respiratória mitocondrial, antioxidante - **Dose clínica:** 100–300 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR e meta-análises. Indicações: Depressão, fadiga mental, cognição, fadiga',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Ubiquinol',
        alternatives: ["Ubiquinona"],
        justificativa: 'Ubiquinol tem melhor biodisponibilidade'
      }
    },
    {
      id: 107,
      category: 'Antioxidante neuroativo / mitocondrial',
      name: 'Ácido Alfa-Lipóico',
      conditions: ['depressão', 'estresse', 'declínio cognitivo'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de estresse oxidativo, redox mitocondrial, NF-κB - **Dose clínica:** 300–600 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante, pode reduzir CYP2C9 (leve) - **Evidência:** Ensaios clínicos. Indicações: Cognição, depressão associada a...',
      interactions: 'CYP450: Não relevante, pode reduzir CYP2C9 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 108,
      category: 'Indutor de autofagia / autofagia neuronal',
      name: 'Spermidina',
      conditions: ['declínio cognitivo'],
      dosage: '1–6 mg/dia',
      timing: '1–6 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Autofagia, mitocôndria, indução de autofagia - **Dose clínica:** 1–6 mg/dia - **Segurança:** Alta/boa - **CYP450:** Não relevante, dados insuficientes - **Evidência:** Estudos humanos observacionais e clínicos. Indicações: Neuroproteção, envelheci...',
      interactions: 'CYP450: Não relevante, dados insuficientes',
      contraindications: 'Alta/boa',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 109,
      category: 'Ativador Nrf2',
      name: 'Sulforafano',
      conditions: ['depressão', 'tdah', 'declínio cognitivo'],
      dosage: '20–40 mg/dia (equivalente ativo)',
      timing: '20–40 mg/dia (equivalente ativo)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante, anti-inflamatório, antioxidante endógeno - **Dose clínica:** 20–40 mg/dia (equivalente ativo) - **Segurança:** Boa/excelente - **CYP450:** Pode induzir CYP1A2, indutor leve CYP1A2 - **Evidência:** ECR em psiquiatria e ensaios clínico...',
      interactions: 'CYP450: Pode induzir CYP1A2, indutor leve CYP1A2',
      contraindications: 'Boa/excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 110,
      category: 'Polifenol neuroativo',
      name: 'EGCG (epigalocatequina galato / chá-verde concentrado)',
      conditions: ['ansiedade', 'declínio cognitivo'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante, modulação dopamina, neuroproteção, GABA - **Dose clínica:** 200–400 mg/dia - **Segurança:** Cautela hepática em altas doses, evitar altas doses em jejum - **CYP450:** Inibe CYP3A4 (leve) - **Evidência:** Ensaios clínicos. Indicações:...',
      interactions: 'CYP450: Inibe CYP3A4 (leve)',
      contraindications: 'Cautela hepática em altas doses, evitar altas doses em jejum',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 111,
      category: 'Ansiolítico funcional',
      name: 'Ácido Rosmarínico',
      conditions: ['ansiedade', 'estresse'],
      dosage: '200–400 mg/dia',
      timing: '200–400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibição GABA-transaminase - **Dose clínica:** 200–400 mg/dia - **Segurança:** Muito boa - **CYP450:** Não descrito - **Evidência:** Estudos humanos. Indicações: Ansiedade, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 112,
      category: 'Antioxidante lipofílico cerebral / carotenoide neuroprotetor',
      name: 'Astaxantina',
      conditions: ['declínio cognitivo', 'fadiga'],
      dosage: '4–12 mg/dia (6-12 mg/dia)',
      timing: '4–12 mg/dia (6-12 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Proteção mitocondrial, antioxidante lipofílico - **Dose clínica:** 4–12 mg/dia (6-12 mg/dia) - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, fadiga mental, fadiga',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 113,
      category: 'Modulador neuroinflamatório / lipídio endocanabinoide-like',
      name: 'Palmitoiletanolamida (PEA)',
      conditions: ['depressão'],
      dosage: '600–1200 mg/dia',
      timing: '600–1200 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Ativação PPAR-α, PPAR-α, microglia - **Dose clínica:** 600–1200 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR e ensaios clínicos. Indicações: Dor crônica, depressão associada, depressão inflamatória, depressão',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 114,
      category: 'Modulador NAD+',
      name: 'Nicotinamida (vitamina B3 funcional, dose farmacológica)',
      conditions: ['ansiedade'],
      dosage: '500–1500 mg/dia',
      timing: '500–1500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'NAD+, GABA - **Dose clínica:** 500–1500 mg/dia - **Segurança:** Cautela hepática - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Ansiedade, neuroproteção',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Cautela hepática',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 115,
      category: 'Metilação / humor / metilação cerebral',
      name: 'Betaína (Trimethylglycine)',
      conditions: ['depressão', 'fadiga'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Metilação, homocisteína, ciclo da metilação - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos e humanos. Indicações: Depressão, fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 116,
      category: 'Modulador de sinalização celular',
      name: 'Inositol',
      conditions: ['ansiedade', 'depressão'],
      dosage: '2–12 g/dia',
      timing: '2–12 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Segundo mensageiro neuronal/serotoninérgico - **Dose clínica:** 2–12 g/dia - **Segurança:** Muito boa/excelente - **CYP450:** Não relevante - **Evidência:** ECR e ensaios clínicos. Indicações: Ansiedade, TOC, depressão',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Muito boa/excelente',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 117,
      category: 'Neurovascular funcional',
      name: 'Policosanol',
      conditions: ['declínio cognitivo'],
      dosage: '5–20 mg/dia',
      timing: '5–20 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fluxo cerebral - **Dose clínica:** 5–20 mg/dia - **Segurança:** Boa - **CYP450:** Pode interferir com estatinas - **Evidência:** Estudos clínicos. Indicações: Cognição vascular',
      interactions: 'CYP450: Pode interferir com estatinas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 118,
      category: 'Neuroinflamatório indireto',
      name: 'Beta-sitosterol',
      conditions: ['saúde cerebral'],
      dosage: '300–600 mg/dia',
      timing: '300–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação imune - **Dose clínica:** 300–600 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Neuroinflamação leve',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 119,
      category: 'Neurovascular / barreira',
      name: 'Ácido Hialurônico oral (baixo PM)',
      conditions: ['saúde cerebral'],
      dosage: '100–200 mg/dia',
      timing: '100–200 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação inflamatória - **Dose clínica:** 100–200 mg/dia - **Segurança:** Alta - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Neuroinflamação sistêmica',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 120,
      category: 'Cronobiótico neuroativo / neuroprotetor cronobiológico / cronobiologia',
      name: 'Melatonina',
      conditions: ['depressão', 'tdah', 'insônia'],
      dosage: '0,5–5 mg/noite',
      timing: '0,5–5 mg/noite',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Ritmo circadiano, antioxidante, antioxidante mitocondrial - **Dose clínica:** 0,5–5 mg/noite - **Segurança:** Excelente - **CYP450:** Metabolizada por CYP1A2 - **Evidência:** Meta-análises robustas. Indicações: Insônia, depressão, TDAH, sono, neur...',
      interactions: 'CYP450: Metabolizada por CYP1A2',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 121,
      category: 'Flavonoide anti-microglial',
      name: 'Luteolina',
      conditions: ['ansiedade'],
      dosage: '100–300 mg/dia',
      timing: '100–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Inibição microglial - **Dose clínica:** 100–300 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP3A4 (leve) - **Evidência:** Estudos humanos iniciais. Indicações: Neuroinflamação, ansiedade',
      interactions: 'CYP450: Inibe CYP3A4 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 122,
      category: 'Resveratrol-like',
      name: 'Polidatina',
      conditions: ['saúde cerebral'],
      dosage: '100–300 mg/dia',
      timing: '100–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'SIRT1, antioxidante - **Dose clínica:** 100–300 mg/dia - **Segurança:** Boa - **CYP450:** Inibe CYP3A4 (leve) - **Evidência:** Ensaios clínicos. Indicações: Neuroinflamação',
      interactions: 'CYP450: Inibe CYP3A4 (leve)',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 123,
      category: 'Mitofagia',
      name: 'Urolitina A',
      conditions: ['declínio cognitivo'],
      dosage: '250–500 mg/dia',
      timing: '250–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Mitofagia - **Dose clínica:** 250–500 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, envelhecimento cerebral',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 124,
      category: 'Redox mitocondrial',
      name: 'GlyNAC (Glicina + N-acetilcisteína)',
      conditions: ['fadiga'],
      dosage: '1200–2400 mg/dia',
      timing: '1200–2400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Glutationa - **Dose clínica:** 1200–2400 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Fadiga, envelhecimento',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'GlyNAC',
        alternatives: ["Forma livre"],
        justificativa: 'GlyNAC é a forma padrão de uso clínico'
      }
    },
    {
      id: 125,
      category: 'Energia celular',
      name: 'D-Ribose',
      conditions: ['fadiga'],
      dosage: '5–10 g/dia',
      timing: '5–10 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Síntese de ATP - **Dose clínica:** 5–10 g/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Fadiga crônica, burnout',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 126,
      category: 'Suporte aminoacídico cerebral',
      name: 'Whey Protein (isolado ou hidrolisado)',
      conditions: ['depressão', 'tdah'],
      dosage: '20–40 g/dia',
      timing: '20–40 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fornecimento de AA essenciais, BCAA - **Dose clínica:** 20–40 g/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** Estudos humanos --- ## PSICOBIÓTICOS E PROBIÓTICOS COM AÇÃO NO SNC {#psicobióticos}. Indicações: Depressão,...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 127,
      category: 'Psicobiótico ansiolítico',
      name: 'Lactobacillus rhamnosus JB-1',
      conditions: ['ansiedade', 'estresse'],
      dosage: '≥1×10⁹ UFC/dia',
      timing: '≥1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação GABA via nervo vago - **Dose clínica:** ≥1×10⁹ UFC/dia - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos humanos e pré-clínicos robustos. Indicações: Ansiedade, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 128,
      category: 'Psicobiótico combinado',
      name: 'Lactobacillus helveticus R0052 + Bifidobacterium longum R0175',
      conditions: ['ansiedade', 'depressão', 'estresse'],
      dosage: '3×10⁹ UFC/dia',
      timing: '3×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de cortisol, inflamação - **Dose clínica:** 3×10⁹ UFC/dia - **Segurança:** Muito alta - **CYP450:** Não aplicável - **Evidência:** ECR placebo-controlados. Indicações: Ansiedade, depressão leve, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 129,
      category: 'Psicobiótico ansiolítico',
      name: 'Bifidobacterium longum NCC3001',
      conditions: ['ansiedade'],
      dosage: '1×10⁹ UFC/dia',
      timing: '1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação límbica - **Dose clínica:** 1×10⁹ UFC/dia - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** ECR com neuroimagem. Indicações: Ansiedade associada a IBS',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 130,
      category: 'Psicobiótico cognitivo',
      name: 'Lactobacillus plantarum 299v',
      conditions: ['depressão', 'declínio cognitivo'],
      dosage: '1×10¹⁰ UFC/dia',
      timing: '1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução inflamação intestinal - **Dose clínica:** 1×10¹⁰ UFC/dia - **Segurança:** Alta - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos humanos. Indicações: Cognição, depressão leve',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 131,
      category: 'Psicobiótico do estresse',
      name: 'Lactobacillus casei Shirota',
      conditions: ['estresse'],
      dosage: '≥1×10¹⁰ UFC/dia',
      timing: '≥1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação eixo HPA - **Dose clínica:** ≥1×10¹⁰ UFC/dia - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** ECR. Indicações: Estresse ocupacional, humor',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 132,
      category: 'Psicobiótico anti-inflamatório',
      name: 'Bifidobacterium infantis 35624',
      conditions: ['depressão'],
      dosage: '1×10⁹ UFC/dia',
      timing: '1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução de citocinas pró-inflamatórias - **Dose clínica:** 1×10⁹ UFC/dia - **Segurança:** Muito boa - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Depressão inflamatória, IBS',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 133,
      category: 'Modulador social/emocional',
      name: 'Lactobacillus reuteri DSM 17938',
      conditions: ['ansiedade', 'tdah'],
      dosage: '1×10⁸–10⁹ UFC/dia',
      timing: '1×10⁸–10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Ocitocina, eixo vago - **Dose clínica:** 1×10⁸–10⁹ UFC/dia - **Segurança:** Alta - **CYP450:** Não aplicável - **Evidência:** Estudos clínicos iniciais. Indicações: Ansiedade social, TDAH (investigacional)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 134,
      category: 'Psicobiótico do sono',
      name: 'Lactobacillus gasseri CP2305',
      conditions: ['estresse', 'insônia'],
      dosage: '1×10¹⁰ UFC/dia',
      timing: '1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação autonômica - **Dose clínica:** 1×10¹⁰ UFC/dia - **Segurança:** Muito boa - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Insônia, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 135,
      category: 'Psicobiótico cognitivo',
      name: 'Bifidobacterium breve A-1',
      conditions: ['estresse', 'declínio cognitivo'],
      dosage: '1×10¹⁰ UFC/dia',
      timing: '1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação inflamatória - **Dose clínica:** 1×10¹⁰ UFC/dia - **Segurança:** Alta - **CYP450:** Não aplicável - **Evidência:** Estudos humanos. Indicações: Cognição, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 136,
      category: 'Neuroativo indireto',
      name: 'Lactobacillus acidophilus NCFM',
      conditions: ['ansiedade'],
      dosage: '≥1×10¹⁰ UFC/dia',
      timing: '≥1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação opioide intestinal - **Dose clínica:** ≥1×10¹⁰ UFC/dia - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Humor, ansiedade',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 137,
      category: 'Psicobiótico anti-estresse',
      name: 'Bifidobacterium lactis HN019',
      conditions: ['estresse'],
      dosage: '1×10⁹–10¹⁰ UFC/dia',
      timing: '1×10⁹–10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação imune e HPA - **Dose clínica:** 1×10⁹–10¹⁰ UFC/dia - **Segurança:** Alta - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Estresse, função cognitiva leve',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 138,
      category: 'Psicobiótico antioxidante',
      name: 'Lactobacillus fermentum ME-3',
      conditions: ['saúde cerebral'],
      dosage: '≥1×10⁹ UFC/dia',
      timing: '≥1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Glutationa - **Dose clínica:** ≥1×10⁹ UFC/dia - **Segurança:** Boa - **CYP450:** Não aplicável - **Evidência:** Estudos clínicos. Indicações: Neuroinflamação, humor',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 139,
      category: 'Suporte eixo intestino–cérebro',
      name: 'Bifidobacterium animalis subsp. lactis BB-12',
      conditions: ['ansiedade', 'estresse'],
      dosage: '1×10⁹–10¹⁰ UFC/dia',
      timing: '1×10⁹–10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Redução inflamação intestinal - **Dose clínica:** 1×10⁹–10¹⁰ UFC/dia - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Ansiedade leve, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 140,
      category: 'Psicobiótico ansiolítico',
      name: 'Lactobacillus paracasei LPC-37',
      conditions: ['ansiedade', 'estresse'],
      dosage: '1×10¹⁰ UFC/dia',
      timing: '1×10¹⁰ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação do eixo HPA - **Dose clínica:** 1×10¹⁰ UFC/dia - **Segurança:** Alta - **CYP450:** Não aplicável - **Evidência:** ECR. Indicações: Ansiedade, estresse',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 141,
      category: 'Psicobiótico GABAérgico',
      name: 'Lactobacillus brevis CECT7480',
      conditions: ['ansiedade', 'insônia'],
      dosage: '1×10⁹ UFC/dia',
      timing: '1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Produção de GABA - **Dose clínica:** 1×10⁹ UFC/dia - **Segurança:** Boa - **CYP450:** Não aplicável - **Evidência:** Estudos clínicos. Indicações: Ansiedade, insônia',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 142,
      category: 'Psicobiótico combinado patenteado',
      name: 'IBS Care® 8',
      conditions: ['ansiedade', 'depressão'],
      dosage: '1–2 cápsulas/dia (≥10⁹ UFC totais)',
      timing: '1–2 cápsulas/dia (≥10⁹ UFC totais)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação inflamatória e eixo vago - **Dose clínica:** 1–2 cápsulas/dia (≥10⁹ UFC totais) - **Segurança:** Muito boa - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: IBS com ansiedade/depressão associada',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 143,
      category: 'Psicobiótico não vivo',
      name: 'Heat-Killed Lactobacillus (paraprobiotics)',
      conditions: ['ansiedade', 'estresse'],
      dosage: 'Conforme formulação',
      timing: 'Conforme formulação',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação imune - **Dose clínica:** Conforme formulação - **Segurança:** Excelente - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos japoneses. Indicações: Estresse, ansiedade',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 144,
      category: 'Modulador eixo intestino–cérebro',
      name: 'Saccharomyces boulardii CNCM I-745',
      conditions: ['estresse'],
      dosage: '5–10 bilhões UFC/dia',
      timing: '5–10 bilhões UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Barreira intestinal, inflamação - **Dose clínica:** 5–10 bilhões UFC/dia - **Segurança:** Alta (exceto imunossuprimidos graves) - **CYP450:** Não aplicável - **Evidência:** Ensaios clínicos. Indicações: Estresse, inflamação intestinal',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Alta (exceto imunossuprimidos graves)',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 145,
      category: 'Psicobiótico metabólico',
      name: 'Bifidobacterium adolescentis',
      conditions: ['saúde cerebral'],
      dosage: '≥1×10⁹ UFC/dia',
      timing: '≥1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Produção de SCFAs - **Dose clínica:** ≥1×10⁹ UFC/dia - **Segurança:** Boa - **CYP450:** Não aplicável - **Evidência:** Estudos humanos. Indicações: Humor, inflamação',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 146,
      category: 'Psicobiótico imunomodulador',
      name: 'Lactobacillus salivarius LS01',
      conditions: ['saúde cerebral'],
      dosage: '≥1×10⁹ UFC/dia',
      timing: '≥1×10⁹ UFC/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação imune - **Dose clínica:** ≥1×10⁹ UFC/dia - **Segurança:** Muito boa - **CYP450:** Não aplicável - **Evidência:** Estudos clínicos --- ## ÁCIDOS GRAXOS, LIPÍDIOS FUNCIONAIS E COMPOSTOS DE MEMBRANA {#lipídios}. Indicações: Neuroinflamação ...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Cepa específica liofilizada',
        alternatives: ["Cultura viva"],
        justificativa: 'Liofilização mantém estabilidade e viabilidade da cepa'
      }
    },
    {
      id: 147,
      category: 'Ômega-3 antidepressivo',
      name: 'EPA (Ácido Eicosapentaenoico)',
      conditions: ['ansiedade', 'depressão', 'bipolar'],
      dosage: '1000–2000 mg/dia (EPA ≥60%)',
      timing: '1000–2000 mg/dia (EPA ≥60%)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Anti-inflamatório, modulação monoaminas - **Dose clínica:** 1000–2000 mg/dia (EPA ≥60%) - **Segurança:** Excelente; cautela com anticoagulantes - **CYP450:** Não relevante - **Evidência:** Meta-análises robustas. Indicações: Depressão maior, bipol...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Excelente; cautela com anticoagulantes',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Triglicerídeos (rTG)',
        alternatives: ["Ésteres etílicos", "Fosfolipídios"],
        justificativa: 'Triglicerídeos têm melhor absorção'
      }
    },
    {
      id: 148,
      category: 'Ômega-3 estrutural',
      name: 'DHA (Ácido Docosahexaenoico)',
      conditions: ['tdah', 'declínio cognitivo'],
      dosage: '500–1500 mg/dia',
      timing: '500–1500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fluidez de membrana sináptica - **Dose clínica:** 500–1500 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR e meta-análises. Indicações: Cognição, TDAH, neurodesenvolvimento',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Triglicerídeos (rTG)',
        alternatives: ["Ésteres etílicos", "Fosfolipídios"],
        justificativa: 'Triglicerídeos têm melhor absorção'
      }
    },
    {
      id: 149,
      category: 'Lipídio funcional combinado',
      name: 'Ômega-3 de alta concentração (EPA:DHA clínico)',
      conditions: ['ansiedade', 'depressão', 'tdah'],
      dosage: '1–3 g/dia de ômega-3 total',
      timing: '1–3 g/dia de ômega-3 total',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Neuroinflamação e neurotransmissão - **Dose clínica:** 1–3 g/dia de ômega-3 total - **Segurança:** Alta - **CYP450:** Não relevante - **Evidência:** Meta-análises. Indicações: Depressão, TDAH, ansiedade',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Triglicerídeos (rTG)',
        alternatives: ["Ésteres etílicos", "Fosfolipídios"],
        justificativa: 'Triglicerídeos têm melhor absorção'
      }
    },
    {
      id: 150,
      category: 'Composto de membrana neuronal / fosfolipídio neuronal',
      name: 'Fosfatidilserina (PS)',
      conditions: ['estresse', 'declínio cognitivo'],
      dosage: '100–300 mg/dia',
      timing: '100–300 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação eixo HPA, sinalização sináptica, fluidez sináptica, membrana neuronal, cortisol - **Dose clínica:** 100–300 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR e ensaios clínicos. Indicações: Estresse, memó...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    },
    {
      id: 151,
      category: 'Lipídio estrutural cerebral',
      name: 'Fosfatidilcolina',
      conditions: ['tdah', 'declínio cognitivo'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Acetilcolina, membranas - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Cognição, memória, TDAH',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    },
    {
      id: 152,
      category: 'Sinaptogênese / fosfolipídio sináptico',
      name: 'Uridina Monofosfato',
      conditions: ['depressão', 'declínio cognitivo'],
      dosage: '150–500 mg/dia',
      timing: '150–500 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Formação de fosfolipídios sinápticos - **Dose clínica:** 150–500 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos e estudos humanos. Indicações: Depressão, cognição',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    },
    {
      id: 153,
      category: 'Lipídio estrutural cerebral',
      name: 'Ácido Araquidônico (ARA)',
      conditions: ['declínio cognitivo'],
      dosage: '120–240 mg/dia',
      timing: '120–240 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Sinalização sináptica - **Dose clínica:** 120–240 mg/dia - **Segurança:** Uso cauteloso (inflamação) - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição (uso selecionado)',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Uso cauteloso (inflamação)',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 154,
      category: 'Mielina / condução neural',
      name: 'Esfingomielina',
      conditions: ['declínio cognitivo'],
      dosage: '300–1000 mg/dia',
      timing: '300–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Integridade da bainha de mielina - **Dose clínica:** 300–1000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Cognição, memória',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 155,
      category: 'Neuroplasticidade',
      name: 'Gangliosídeos',
      conditions: ['declínio cognitivo'],
      dosage: '20–100 mg/dia',
      timing: '20–100 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Sinalização sináptica - **Dose clínica:** 20–100 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, neurodesenvolvimento',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 156,
      category: 'Ômega-3 fosfolipídico',
      name: 'Óleo de Krill',
      conditions: ['depressão', 'declínio cognitivo'],
      dosage: '500–2000 mg/dia',
      timing: '500–2000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'EPA/DHA ligados a fosfolipídios - **Dose clínica:** 500–2000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Depressão, cognição',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Triglicerídeos (rTG)',
        alternatives: ["Ésteres etílicos", "Fosfolipídios"],
        justificativa: 'Triglicerídeos têm melhor absorção'
      }
    },
    {
      id: 157,
      category: 'Lipídio funcional',
      name: 'CLA (Ácido Linoleico Conjugado)',
      conditions: ['saúde cerebral'],
      dosage: '1000–3000 mg/dia',
      timing: '1000–3000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Modulação inflamatória - **Dose clínica:** 1000–3000 mg/dia - **Segurança:** Uso cauteloso metabólico - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Inflamação sistêmica associada ao humor',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Uso cauteloso metabólico',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 158,
      category: 'Ômega-3 intermediário',
      name: 'DPA (Ácido Docosapentaenoico)',
      conditions: ['depressão'],
      dosage: '200–600 mg/dia',
      timing: '200–600 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Anti-inflamatório - **Dose clínica:** 200–600 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Depressão, inflamação',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Triglicerídeos (rTG)',
        alternatives: ["Ésteres etílicos", "Fosfolipídios"],
        justificativa: 'Triglicerídeos têm melhor absorção'
      }
    },
    {
      id: 159,
      category: 'Membrana / mielina',
      name: 'Ceramidas',
      conditions: ['saúde cerebral'],
      dosage: 'Não padronizada amplamente (uso limitado)',
      timing: 'Não padronizada amplamente (uso limitado)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Estrutura de membrana - **Dose clínica:** Não padronizada amplamente (uso limitado) - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos humanos iniciais. Indicações: Neuroproteção',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 160,
      category: 'Neuroproteção de membrana',
      name: 'Plasmalógenos',
      conditions: ['declínio cognitivo'],
      dosage: '500–1000 mg/dia',
      timing: '500–1000 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Antioxidante lipídico - **Dose clínica:** 500–1000 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos iniciais. Indicações: Cognição, neurodegeneração',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 161,
      category: 'Substrato energético cerebral',
      name: 'MCT (Triglicerídeos de Cadeia Média)',
      conditions: ['declínio cognitivo', 'fadiga'],
      dosage: '5–20 g/dia',
      timing: '5–20 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Corpos cetônicos - **Dose clínica:** 5–20 g/dia - **Segurança:** Pode causar desconforto GI - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, fadiga mental',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Pode causar desconforto GI',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 162,
      category: 'Neuroprotetor',
      name: 'Ácido Oleico (Ômega-9 funcional)',
      conditions: ['declínio cognitivo'],
      dosage: 'Dietético/farmacológico',
      timing: 'Dietético/farmacológico',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Fluidez de membrana - **Dose clínica:** Dietético/farmacológico - **Segurança:** Alta - **CYP450:** Não relevante - **Evidência:** Estudos humanos. Indicações: Cognição, saúde cerebral',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 163,
      category: 'Fonte de fosfolipídios',
      name: 'Lecitina de Soja',
      conditions: ['declínio cognitivo'],
      dosage: '1200–2400 mg/dia',
      timing: '1200–2400 mg/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Acetilcolina, membranas - **Dose clínica:** 1200–2400 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Estudos clínicos. Indicações: Cognição, memória',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    },
    {
      id: 164,
      category: 'Lipídio energético cerebral',
      name: 'Ácido Caprílico (C8)',
      conditions: ['declínio cognitivo'],
      dosage: '5–15 g/dia',
      timing: '5–15 g/dia',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Cetogênese rápida - **Dose clínica:** 5–15 g/dia - **Segurança:** Boa (GI dose-dependente) - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos --- ## COLINA E DERIVADOS {#colina}. Indicações: Cognição, foco',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Boa (GI dose-dependente)',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'Não estabelecido',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 165,
      category: 'Neurotransmissão colinérgica / colinérgico cognitivo',
      name: 'Colina (Bitartrato)',
      conditions: ['tdah', 'declínio cognitivo'],
      dosage: '250–1000 mg/dia (250-500 mg/dia)',
      timing: '250–1000 mg/dia (250-500 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Acetilcolina, fosfolipídios - **Dose clínica:** 250–1000 mg/dia (250-500 mg/dia) - **DRI:** AI 425–550 mg/dia - **Segurança:** Boa - **CYP450:** Não relevante - **Evidência:** Ensaios clínicos. Indicações: Cognição, TDAH, memória',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'AI 425–550 mg/dia',
      ligantes: {
        default: 'Forma padrão',
        alternatives: ["Conforme disponibilidade"],
        justificativa: 'Forma padrão de uso clínico'
      }
    },
    {
      id: 166,
      category: 'Fosfolipídio funcional / neuroregeneração',
      name: 'CDP-Colina (Citicolina)',
      conditions: ['depressão', 'tdah', 'declínio cognitivo'],
      dosage: '250–1000 mg/dia (250-500 mg/dia)',
      timing: '250–1000 mg/dia (250-500 mg/dia)',
      evidence: 'Clínica - Curadoria psiquiatria nutricional (atualizada)',
      mechanism: 'Dopamina, acetilcolina, membranas, fosfatidilcolina - **Dose clínica:** 250–1000 mg/dia (250-500 mg/dia) - **DRI:** AI 425–550 mg/dia - **Segurança:** Excelente - **CYP450:** Não relevante - **Evidência:** ECR e ensaios clínicos --- ## NOTAS DE IM...',
      interactions: 'Sem interações significativas conhecidas',
      contraindications: 'Consultar profissional',
      notes: 'Baseado em curadoria clínica atualizada para psiquiatria nutricional',
      dri: 'AI 425–550 mg/dia',
      ligantes: {
        default: 'Purificado de soja',
        alternatives: ["Purificado de girassol"],
        justificativa: 'Fonte vegetal purificada é padrão clínico'
      }
    }
  ];


  // ============ BIBLIOTECA DE FÓRMULAS CLÍNICAS ============
  // Biblioteca clínica DEFAULT (estrutura original)
  const defaultClinicalLibrary = {
    'saude-mental': {
      nome: 'Saúde Mental',
      categorias: {
        'ansiedade-estresse': {
          nome: 'Ansiedade e Estresse',
          formulas: [
            {
              id: 'ansiedade-gad-manha',
              nome: 'Ansiedade GAD - MANHÃ',
              indicacao: 'Transtorno de Ansiedade Generalizada',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'L-Teanina', ligante: '-', dose: '100 mg', horario: 'Manhã' },
                { substancia: 'Vitamina B6', ligante: 'Piridoxal-5-fosfato (P5P)', dose: '10 mg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula pela manhã',
              observacoes: 'Cápsula SECA. Uso diurno para controle ansioso sem sedação.'
            },
            {
              id: 'ansiedade-gad-noite',
              nome: 'Ansiedade GAD - NOITE',
              indicacao: 'Transtorno de Ansiedade Generalizada',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Magnésio', ligante: 'Bisglicinato', dose: '200 mg', horario: 'Noite' },
                { substancia: 'L-Teanina', ligante: '-', dose: '100 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula à noite',
              observacoes: 'Cápsula SECA. Uso noturno para relaxamento e melhora do sono.'
            },
            {
              id: 'ansiedade-gad-inositol',
              nome: 'Ansiedade GAD - Inositol (Adjuvante)',
              indicacao: 'Transtorno de Ansiedade Generalizada',
              via: 'oral',
              formaFarmaceutica: 'po_sache',
              ativos: [
                { substancia: 'Inositol', ligante: '-', dose: '2000 mg', horario: 'Manhã e Noite' }
              ],
              excipiente: 'nenhum',
              qsp: 'sache',
              quantidade: 120,
              posologia: 'Tomar 1 sachê 2x ao dia',
              observacoes: 'Pó ou sachê. Pode diluir em água ou suco.'
            },
            {
              id: 'estresse-cronico-manha',
              nome: 'Estresse Crônico - MANHÃ',
              indicacao: 'Estresse crônico, adaptação ao estresse',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Rhodiola rosea', ligante: 'Extrato padronizado', dose: '200 mg', horario: 'Manhã' },
                { substancia: 'Vitamina C', ligante: 'Ácido ascórbico', dose: '500 mg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula pela manhã',
              observacoes: 'Cápsula SECA. Rhodiola tem efeito adaptogênico e energizante.'
            },
            {
              id: 'estresse-cronico-noite',
              nome: 'Estresse Crônico - NOITE',
              indicacao: 'Estresse crônico, redução de cortisol',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Ashwagandha', ligante: 'KSM-66', dose: '300 mg', horario: 'Noite' },
                { substancia: 'Magnésio', ligante: 'Bisglicinato', dose: '200 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula à noite',
              observacoes: 'Cápsula SECA. Ashwagandha reduz cortisol noturno e melhora sono.'
            }
          ]
        },
        'humor': {
          nome: 'Humor',
          formulas: [
            {
              id: 'humor-oleosa',
              nome: 'Humor Baixo - OLEOSA (Almoço ou Jantar)',
              indicacao: 'Depressão leve, humor baixo',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '1000 UI', horario: 'Após almoço ou jantar' },
                { substancia: 'Ômega-3', ligante: 'EPA 60% / DHA 40%', dose: '1000 mg', horario: 'Após almoço ou jantar' }
              ],
              excipiente: 'tcm',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula após almoço ou jantar',
              observacoes: 'Cápsula OLEOSA. Vitamina D lipossolúvel + Ômega-3 após refeição para melhor absorção.'
            },
            {
              id: 'humor-noite',
              nome: 'Humor Baixo - NOITE',
              indicacao: 'Depressão leve, humor baixo',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Magnésio', ligante: 'Bisglicinato', dose: '200 mg', horario: 'Noite' },
                { substancia: 'Zinco', ligante: 'Bisglicinato', dose: '15 mg', horario: 'Noite' },
                { substancia: 'Vitamina B12', ligante: 'Metilcobalamina', dose: '500 µg', horario: 'Noite' },
                { substancia: 'L-Metilfolato', ligante: '5-MTHF', dose: '400 µg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula à noite',
              observacoes: 'Cápsula SECA. B12 + Folato + minerais para suporte metabólico noturno.'
            }
          ]
        },
        'sono': {
          nome: 'Sono',
          formulas: [
            {
              id: 'sono-noite',
              nome: 'Sono - NOITE',
              indicacao: 'Insônia, dificuldade para dormir',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Melatonina', ligante: '-', dose: '1 mg', horario: '30-60 min antes de dormir' },
                { substancia: 'Magnésio', ligante: 'Bisglicinato', dose: '200 mg', horario: '30-60 min antes de dormir' },
                { substancia: 'L-Teanina', ligante: '-', dose: '200 mg', horario: '30-60 min antes de dormir' },
                { substancia: 'Glicina', ligante: '-', dose: '1000 mg', horario: '30-60 min antes de dormir' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula 30-60 minutos antes de dormir',
              observacoes: 'Cápsula SECA. Melatonina 1mg (dose inicial conservadora). Evitar telas 1h antes.'
            }
          ]
        },
        'funcao-cognitiva': {
          nome: 'Função Cognitiva',
          formulas: [
            {
              id: 'cognitiva-manha',
              nome: 'Função Cognitiva - MANHÃ',
              indicacao: 'Melhora cognitiva, memória',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Citicolina', ligante: 'CDP-Colina', dose: '250 mg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula pela manhã',
              observacoes: 'Cápsula SECA. Precursor colinérgico para acetilcolina.'
            },
            {
              id: 'cognitiva-noite',
              nome: 'Função Cognitiva - NOITE',
              indicacao: 'Melhora cognitiva, memória',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Bacopa monnieri', ligante: 'Extrato padronizado', dose: '300 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula à noite',
              observacoes: 'Cápsula SECA. Bacopa: cronobiologia noturna para consolidação de memória.'
            },
            {
              id: 'cognitiva-oleosa',
              nome: 'Função Cognitiva - OLEOSA (Almoço/Jantar)',
              indicacao: 'Melhora cognitiva, neuroproteção',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Ômega-3', ligante: 'DHA predominante 60-70%', dose: '1000 mg', horario: 'Após refeição principal' }
              ],
              excipiente: 'tcm',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 cápsula após almoço ou jantar',
              observacoes: 'Cápsula OLEOSA. DHA predominante para estrutura cerebral.'
            }
          ]
        },
        'foco-concentracao': {
          nome: 'Foco e Concentração',
          formulas: [
            {
              id: 'foco-manha',
              nome: 'Foco e Concentração - MANHÃ',
              indicacao: 'Melhora de foco e concentração',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'L-Tirosina', ligante: '-', dose: '500 mg', horario: 'Manhã' },
                { substancia: 'Vitamina B6', ligante: 'P5P', dose: '10 mg', horario: 'Manhã' },
                { substancia: 'Citicolina', ligante: 'CDP-Colina', dose: '250 mg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose pela manhã',
              observacoes: 'Cápsula SECA. Precursores dopaminérgicos e colinérgicos.'
            },
            {
              id: 'foco-noite',
              nome: 'Foco e Concentração - NOITE',
              indicacao: 'Suporte mineral noturno',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Magnésio', ligante: 'Bisglicinato', dose: '200 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose à noite',
              observacoes: 'Cápsula SECA. Magnésio para relaxamento e recuperação.'
            },
            {
              id: 'foco-oleosa',
              nome: 'Foco e Concentração - OLEOSA',
              indicacao: 'Suporte lipídico cerebral',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Ômega-3', ligante: 'DHA predominante 60-70%', dose: '1000 mg', horario: 'Após almoço ou jantar' }
              ],
              excipiente: 'tcm',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose após refeição principal',
              observacoes: 'Cápsula OLEOSA. DHA predominante para função cerebral.'
            }
          ]
        },
        'motivacao-energia': {
          nome: 'Motivação e Energia',
          formulas: [
            {
              id: 'energia-manha-seca',
              nome: 'Energia/Motivação - MANHÃ (SECA)',
              indicacao: 'Fadiga, baixa energia',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Acetil-L-Carnitina', ligante: '-', dose: '500 mg', horario: 'Manhã' },
                { substancia: 'Vitamina B12', ligante: 'Metilcobalamina', dose: '1000 µg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose pela manhã',
              observacoes: 'Cápsula SECA. Suporte energético mitocondrial.'
            },
            {
              id: 'energia-manha-oleosa',
              nome: 'Energia/Motivação - MANHÃ (OLEOSA)',
              indicacao: 'Suporte mitocondrial',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Coenzima Q10', ligante: 'Ubiquinona ou Ubiquinol', dose: '100 mg', horario: 'Manhã com refeição' }
              ],
              excipiente: 'tcm',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose pela manhã, com refeição',
              observacoes: 'Cápsula OLEOSA. CoQ10 lipossolúvel para absorção ótima.'
            },
            {
              id: 'energia-noite',
              nome: 'Energia/Motivação - NOITE',
              indicacao: 'Recuperação energética noturna',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Magnésio', ligante: 'Malato', dose: '200 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose à noite',
              observacoes: 'Cápsula SECA. Magnésio malato específico para produção energética.'
            }
          ]
        },
        'funcao-mitocondrial': {
          nome: 'Função Mitocondrial',
          formulas: [
            {
              id: 'mitocondrial-manha-oleosa',
              nome: 'Função Mitocondrial - MANHÃ (OLEOSA)',
              indicacao: 'Suporte mitocondrial',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Coenzima Q10', ligante: 'Ubiquinol', dose: '200 mg', horario: 'Manhã com refeição' },
                { substancia: 'PQQ', ligante: 'Pirroloquinolina quinona', dose: '10 mg', horario: 'Manhã com refeição' }
              ],
              excipiente: 'tcm',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose pela manhã, com refeição',
              observacoes: 'Cápsula OLEOSA. PQQ estimula biogênese mitocondrial.'
            },
            {
              id: 'mitocondrial-manha-seca',
              nome: 'Função Mitocondrial - MANHÃ (SECA)',
              indicacao: 'Suporte energético celular',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Acetil-L-Carnitina', ligante: '-', dose: '1000 mg', horario: 'Manhã' },
                { substancia: 'Ácido Alfa-Lipóico', ligante: 'R-ALA', dose: '300 mg', horario: 'Manhã' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose pela manhã',
              observacoes: 'Cápsula SECA. Transporte de ácidos graxos e antioxidante mitocondrial.'
            },
            {
              id: 'mitocondrial-noite',
              nome: 'Função Mitocondrial - NOITE',
              indicacao: 'Recuperação mitocondrial noturna',
              via: 'oral',
              formaFarmaceutica: 'capsula',
              ativos: [
                { substancia: 'Magnésio', ligante: 'Malato', dose: '200 mg', horario: 'Noite' }
              ],
              excipiente: 'celulose_microcristalina',
              qsp: '1_capsula',
              quantidade: 60,
              posologia: 'Tomar 1 dose à noite',
              observacoes: 'Cápsula SECA. Magnésio malato essencial para ciclo de Krebs.'
            }
          ]
        }
      }
    }
  };

  // Estado editável da biblioteca clínica (com localStorage)
  const [clinicalLibrary, setClinicalLibrary] = useState(() => {
    const saved = localStorage.getItem('clinicalLibrary');
    return saved ? JSON.parse(saved) : defaultClinicalLibrary;
  });

  // Função para resetar biblioteca ao padrão
  const resetClinicalLibrary = () => {
    if (confirm('Resetar biblioteca clínica ao padrão? Todas as modificações serão perdidas.')) {
      setClinicalLibrary(defaultClinicalLibrary);
      localStorage.setItem('clinicalLibrary', JSON.stringify(defaultClinicalLibrary));
      alert('Biblioteca resetada ao padrão!');
    }
  };



  // BANCO DE FÓRMULAS PRÉ-ELABORADAS POR CONDIÇÃO (LEGADO - MANTER)
  const formulasPreElaboradas = {
    'depressao': {
      nome: 'Protocolo Depressão',
      substancias: [
        { nome: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '5000 UI/dia' },
        { nome: 'Vitamina B9', ligante: 'L-metilfolato (5-MTHF)', dose: '15 mg/dia' },
        { nome: 'Vitamina B12', ligante: 'Metilcobalamina', dose: '1000 µg/dia' },
        { nome: 'Ômega-3 EPA/DHA', ligante: '-', dose: '2000 mg/dia (60% EPA)' },
        { nome: 'Magnésio', ligante: 'Glicinato', dose: '400 mg/dia' },
        { nome: 'Zinco', ligante: 'Bisglicinato', dose: '30 mg/dia' }
      ],
      observacoes: 'Dosar vitamina D e metilação (homocisteína, B12, folato). Avaliar MTHFR.'
    },
    'ansiedade': {
      nome: 'Protocolo Ansiedade',
      substancias: [
        { nome: 'Magnésio', ligante: 'Glicinato', dose: '400-600 mg/dia' },
        { nome: 'L-Teanina', ligante: '-', dose: '200 mg 2-3x/dia' },
        { nome: 'Vitamina B6', ligante: 'Piridoxal-5-fosfato (P5P)', dose: '50 mg/dia' },
        { nome: 'Inositol', ligante: '-', dose: '12-18 g/dia' },
        { nome: 'Taurina', ligante: '-', dose: '1000-3000 mg/dia' },
        { nome: 'Ashwagandha', ligante: '-', dose: '300-600 mg/dia' }
      ],
      observacoes: 'Iniciar gradualmente. Magnésio à noite. L-Teanina conforme necessário.'
    },
    'insonia': {
      nome: 'Protocolo Insônia',
      substancias: [
        { nome: 'Magnésio', ligante: 'Glicinato', dose: '400 mg/dia (noite)' },
        { nome: 'L-Triptofano', ligante: '-', dose: '1000-2000 mg/dia (noite)' },
        { nome: 'Glicina', ligante: '-', dose: '3000 mg/dia (noite)' },
        { nome: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '2000-5000 UI/dia (manhã)' },
        { nome: 'Vitamina B6', ligante: 'Piridoxal-5-fosfato (P5P)', dose: '50 mg/dia' },
        { nome: 'Melatonina', ligante: '-', dose: '0,5-5 mg/dia (noite)' }
      ],
      observacoes: 'Melatonina iniciar com dose baixa. Tomar 30-60min antes de dormir.'
    },
    'fadiga': {
      nome: 'Protocolo Fadiga Crônica',
      substancias: [
        { nome: 'Ferro', ligante: 'Bisglicinato', dose: '30-60 mg/dia' },
        { nome: 'Vitamina B12', ligante: 'Metilcobalamina', dose: '1000-2000 µg/dia' },
        { nome: 'Magnésio', ligante: 'Malato', dose: '400 mg/dia' },
        { nome: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '5000 UI/dia' },
        { nome: 'CoQ10', ligante: '-', dose: '100-300 mg/dia' },
        { nome: 'Vitaminas do Complexo B', ligante: '-', dose: 'Conforme RDA' }
      ],
      observacoes: 'Dosar ferritina, B12, vitamina D. Magnésio malato para energia.'
    },
    'declinio_cognitivo': {
      nome: 'Protocolo Neuroproteção',
      substancias: [
        { nome: 'Ômega-3 EPA/DHA', ligante: '-', dose: '2000-4000 mg/dia (DHA>50%)' },
        { nome: 'Vitamina B9', ligante: 'L-metilfolato (5-MTHF)', dose: '800 µg/dia' },
        { nome: 'Vitamina B12', ligante: 'Metilcobalamina', dose: '1000 µg/dia' },
        { nome: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '5000 UI/dia' },
        { nome: 'Magnésio', ligante: 'Treonato', dose: '1500-2000 mg/dia' },
        { nome: 'Citicolina', ligante: '-', dose: '250-500 mg/dia' }
      ],
      observacoes: 'Magnésio treonato atravessa BHE. Dosar homocisteína.'
    },
    'tdah': {
      nome: 'Protocolo TDAH',
      substancias: [
        { nome: 'Ferro', ligante: 'Bisglicinato', dose: '30-80 mg/dia' },
        { nome: 'Zinco', ligante: 'Bisglicinato', dose: '30-40 mg/dia' },
        { nome: 'Magnésio', ligante: 'Glicinato', dose: '400 mg/dia' },
        { nome: 'Ômega-3 EPA/DHA', ligante: '-', dose: '1000-2000 mg/dia' },
        { nome: 'Vitamina D3', ligante: 'Colecalciferol (D3)', dose: '2000-5000 UI/dia' },
        { nome: 'L-Teanina', ligante: '-', dose: '200 mg 2x/dia' }
      ],
      observacoes: 'Dosar ferritina (alvo >50 ng/mL) e zinco. Resposta em 8-12 semanas.'
    }
  };

  const gerarTextoFormulaPreElaborada = (formulaKey) => {
    const formula = formulasPreElaboradas[formulaKey];
    if (!formula) return '';
    
    let texto = `═══════════════════════════════════════════════════════\n`;
    texto += `  ${formula.nome.toUpperCase()}\n`;
    texto += `═══════════════════════════════════════════════════════\n\n`;
    
    texto += `COMPOSIÇÃO:\n\n`;
    formula.substancias.forEach((sub, idx) => {
      texto += `${idx + 1}. ${sub.nome}`;
      if (sub.ligante && sub.ligante !== '-') {
        texto += ` (${sub.ligante})`;
      }
      texto += `\n`;
      texto += `   ${sub.dose}\n\n`;
    });
    
    texto += `─────────────────────────────────────────────────────\n`;
    texto += `OBSERVAÇÕES:\n`;
    texto += `${formula.observacoes}\n\n`;
    
    texto += `POSOLOGIA:\n`;
    texto += `Conforme orientação profissional\n\n`;
    
    texto += `═══════════════════════════════════════════════════════\n`;
    
    return texto;
  };

    const conditions = [
    { value: 'depressão', label: 'Depressão' },
    { value: 'ansiedade', label: 'Ansiedade' },
    { value: 'bipolar', label: 'Transtorno Bipolar' },
    { value: 'toc', label: 'TOC' },
    { value: 'tdah', label: 'TDAH' },
    { value: 'insônia', label: 'Insônia' },
    { value: 'esquizofrenia', label: 'Esquizofrenia' },
    { value: 'pânico', label: 'Síndrome do Pânico' },
    { value: 'estresse', label: 'Estresse Crônico' },
    { value: 'fadiga', label: 'Fadiga' },
    { value: 'declínio cognitivo', label: 'Declínio Cognitivo' },
    { value: 'enxaqueca', label: 'Enxaqueca' },
    { value: 'tpm', label: 'TPM' },
    { value: 'alzheimer', label: 'Alzheimer' }
  ];

  const categories = [
    { value: '', label: 'Todas as Categorias' },
    { value: 'Vitaminas Lipossolúveis', label: 'Vitaminas Lipossolúveis' },
    { value: 'Complexo B', label: 'Complexo B' },
    { value: 'Minerais', label: 'Minerais' },
    { value: 'Ácidos Graxos', label: 'Ácidos Graxos' },
    { value: 'Aminoácidos', label: 'Aminoácidos' },
    { value: 'Aminoácidos e Precursores', label: 'Aminoácidos e Precursores' },
    { value: 'Fitoterápicos', label: 'Fitoterápicos' },
    { value: 'Adaptógenos', label: 'Adaptógenos' },
    { value: 'Bioativos Patenteados', label: 'Bioativos Patenteados' },
    { value: 'Compostos Bioativos', label: 'Compostos Bioativos' },
    { value: 'Lipídios Funcionais', label: 'Lipídios Funcionais' },
    { value: 'Colina e Derivados', label: 'Colina e Derivados' },
    { value: 'Psicobióticos', label: 'Psicobióticos' },
    { value: 'Probióticos', label: 'Probióticos' },
    { value: 'Carboidratos', label: 'Carboidratos' }
  ];
  
  // Opções de formulação magistral baseadas em literatura
  const viasUso = [
    { value: 'oral', label: 'Uso Oral' },
    { value: 'sublingual', label: 'Uso Sublingual' },
    { value: 'topico', label: 'Uso Tópico' },
    { value: 'transdermico', label: 'Uso Transdérmico' }
  ];
  
  const formasFarmaceuticas = [
    { value: 'capsula', label: 'Cápsula' },
    { value: 'comprimido', label: 'Comprimido' },
    { value: 'comprimido_orodispersivel', label: 'Comprimido Orodispersível' },
    { value: 'comprimido_sublingual', label: 'Comprimido Sublingual' },
    { value: 'filme_orodispersivel', label: 'Filme Orodispersível' },
    { value: 'solucao_oral', label: 'Solução Oral (gotas)' },
    { value: 'suspensao_oral', label: 'Suspensão Oral' },
    { value: 'po', label: 'Pó' },
    { value: 'gel', label: 'Gel Transdérmico' },
    { value: 'creme', label: 'Creme' },
    { value: 'spray_nasal', label: 'Spray Nasal' },
    { value: 'spray_sublingual', label: 'Spray Sublingual' }
  ];
  
  const excipientes = [
    { value: 'criterio_farmacia', label: 'A critério da farmácia' },
    { value: 'tcm', label: 'Triglicerídeos de Cadeia Média (TCM / MCT oil)' },
    { value: 'lipossomal', label: 'Sistema Lipossomal' },
    { value: 'celulose_microcristalina', label: 'Celulose Microcristalina (Avicel)' },
    { value: 'lactose', label: 'Lactose Monohidratada' },
    { value: 'amido', label: 'Amido de Milho' },
    { value: 'estearato_magnesio', label: 'Estearato de Magnésio' },
    { value: 'dioxido_silicio', label: 'Dióxido de Silício Coloidal' },
    { value: 'gelatina', label: 'Gelatina (cápsulas)' },
    { value: 'manitol', label: 'Manitol' },
    { value: 'sorbitol', label: 'Sorbitol' },
    { value: 'sacarose', label: 'Sacarose' },
    { value: 'agua_purificada', label: 'Água Purificada' },
    { value: 'propilenoglicol', label: 'Propilenoglicol' },
    { value: 'glicerina', label: 'Glicerina' },
    { value: 'carbopol', label: 'Carbopol (gel)' },
    { value: 'natrosol', label: 'Natrosol (gel)' },
    { value: 'lanette', label: 'Lanette (creme)' },
    { value: 'outro', label: 'Outro (especificar)' }
  ];
  
  const qspOpcoes = [
    { value: '1_capsula', label: '1 cápsula' },
    { value: '1_comprimido', label: '1 comprimido' },
    { value: '1_dose', label: '1 dose' },
    { value: '1ml', label: '1 mL (gotas)' },
    { value: '5ml', label: '5 mL' },
    { value: '1_pump', label: '1 pump (spray)' },
    { value: '1g_gel', label: '1 g (gel/creme)' },
    { value: '1_filme', label: '1 filme' },
    { value: 'outro', label: 'Outro (especificar)' }
  ];

  // Mesclar substâncias ILSI com customizadas
  const allSubstances = [...nutraceuticos, ...customSubstances];

  const filteredNutraceuticos = allSubstances.filter(n => {
    const matchesCondition = !selectedCondition || (n.conditions && n.conditions.includes(selectedCondition));
    
    // Filtro de categoria inteligente - suporta match exato e parcial
    const matchesCategory = !selectedCategory || (() => {
      // Match exato (para categorias antigas)
      if (n.category === selectedCategory) return true;
      
      // Match parcial - categoria selecionada está contida na categoria da substância
      if (n.category && n.category.toLowerCase().includes(selectedCategory.toLowerCase())) return true;
      
      // Casos especiais de agrupamento
      const catLower = n.category ? n.category.toLowerCase() : '';
      const selLower = selectedCategory.toLowerCase();
      
      // Aminoácidos e Precursores captura ambos
      if (selLower === 'aminoácidos e precursores' && 
          (catLower.includes('aminoácido') || catLower.includes('precursor') || 
           catLower.includes('neurotransmissor') || catLower.includes('dopaminérgico funcional') ||
           catLower.includes('modulador glutamatérgico'))) {
        return true;
      }
      
      // Psicobióticos
      if (selLower === 'psicobióticos' && catLower.includes('psicobiótico')) {
        return true;
      }
      
      // Bioativos Patenteados
      if (selLower === 'bioativos patenteados' && 
          (catLower.includes('patenteado') || n.category.includes('®') || n.category.includes('™'))) {
        return true;
      }
      
      // Lipídios Funcionais
      if (selLower === 'lipídios funcionais' && 
          (catLower.includes('ômega') || catLower.includes('lipídio') || 
           catLower.includes('fosfolipídio') || catLower.includes('membrana') || 
           catLower.includes('mielina'))) {
        return true;
      }
      
      // Colina e Derivados
      if (selLower === 'colina e derivados' &&
          (catLower.includes('colina') || catLower.includes('colinérgico') ||
           catLower.includes('fosfolipídio funcional / neuroregeneração'))) {
        return true;
      }
      
      // Compostos Bioativos
      if (selLower === 'compostos bioativos' && 
          (catLower.includes('polifenol') || catLower.includes('flavonoide') || 
           catLower.includes('mitocondrial') || catLower.includes('neuroprotetor') || 
           catLower.includes('antioxidante') || catLower.includes('neuroinflamatório') ||
           catLower.includes('cronobiótico') || catLower.includes('metilação') ||
           catLower.includes('cognitivo') || catLower.includes('ansiolítico leve') ||
           catLower.includes('modulador') || catLower.includes('composto de membrana'))) {
        return true;
      }
      
      // Fitoterápicos
      if (selLower === 'fitoterápicos' &&
          (catLower.includes('fitoterápico') || catLower.includes('sedativo gaba'))) {
        return true;
      }
      
      // Adaptógenos
      if (selLower === 'adaptógenos' && catLower.includes('adaptógeno')) {
        return true;
      }
      
      return false;
    })();
    
    // Pesquisa aprimorada - busca em múltiplos campos
    const matchesSearch = !searchTerm || (() => {
      const search = searchTerm.toLowerCase();
      
      // Buscar no nome
      if (n.name.toLowerCase().includes(search)) return true;
      
      // Buscar na categoria
      if (n.category && n.category.toLowerCase().includes(search)) return true;
      
      // Buscar no mecanismo
      if (n.mechanism && n.mechanism.toLowerCase().includes(search)) return true;
      
      // Buscar nas condições
      if (n.conditions && n.conditions.some(c => c.toLowerCase().includes(search))) return true;
      
      // Buscar nas interações
      if (n.interactions && n.interactions.toLowerCase().includes(search)) return true;
      
      // Buscar nas contraindicações
      if (n.contraindications && n.contraindications.toLowerCase().includes(search)) return true;
      
      // Buscar nas notas
      if (n.notes && n.notes.toLowerCase().includes(search)) return true;
      
      // Buscar no timing/dosagem
      if (n.timing && n.timing.toLowerCase().includes(search)) return true;
      
      return false;
    })();
    
    return matchesCondition && matchesCategory && matchesSearch;
  });

  const addToPrescription = (nutr) => {
    if (!prescription.find(p => p.id === nutr.id)) {
      // Adicionar com ligante default se existir
      const selectedLigante = nutr.ligantes ? nutr.ligantes.default : null;
      // Adicionar excipiente default se for vitamina lipossolúvel
      const selectedExcipiente = nutr.excipiente ? nutr.excipiente.default : null;
      setPrescription([...prescription, { 
        ...nutr, 
        customDosage: nutr.dosage,
        selectedLigante: selectedLigante,
        selectedExcipiente: selectedExcipiente
      }]);
    }
  };

  const removeFromPrescription = (id) => {
    setPrescription(prescription.filter(p => p.id !== id));
  };

  const updateCustomDosage = (id, dosage) => {
    setPrescription(prescription.map(p => 
      p.id === id ? { ...p, customDosage: dosage } : p
    ));
  };
  const updateSelectedLigante = (id, ligante) => {
    setPrescription(prescription.map(p => 
      p.id === id ? { ...p, selectedLigante: ligante } : p
    ));
  };
  const updateSelectedExcipiente = (id, excipiente) => {
    setPrescription(prescription.map(p => 
      p.id === id ? { ...p, selectedExcipiente: excipiente } : p
    ));
  };

  // Funções para cadastro de substâncias personalizadas
  const addCustomSubstance = () => {
    if (!customForm.name || !customForm.dosage) {
      alert('Preencha pelo menos o nome e a dosagem');
      return;
    }
    
    const newSubstance = {
      id: Date.now(),
      ...customForm,
      conditions: [],
      evidence: 'Personalizado',
      dri: 'Não estabelecido (personalizado)'
    };
    
    setCustomSubstances([...customSubstances, newSubstance]);
    setCustomForm({
      name: '',
      category: 'Personalizado',
      dosage: '',
      timing: 'Conforme orientação',
      mechanism: '',
      interactions: 'Nenhuma conhecida',
      contraindications: 'Nenhuma conhecida',
      notes: ''
    });
    setShowCustomForm(false);
    alert('Substância "' + newSubstance.name + '" adicionada com sucesso!');
  };
  
  const removeCustomSubstance = (id) => {
    if (confirm('Remover esta substância personalizada?')) {
      setCustomSubstances(customSubstances.filter(s => s.id !== id));
    }
  };

  // Funções para histórico de prescrições
  const savePrescriptionToHistory = () => {
    if (prescription.length === 0) {
      alert('Adicione pelo menos uma substância à prescrição antes de salvar');
      return;
    }
    
    if (!patientInfo.name) {
      alert('Preencha o nome do paciente antes de salvar');
      return;
    }
    
    const newEntry = {
      id: Date.now(),
      date: new Date().toISOString(),
      patientInfo: {...patientInfo},
      prescription: [...prescription],
      magistralConfig: {...magistralConfig},
      prescriptionText: generatePrescriptionText()
    };
    
    const updatedHistory = [newEntry, ...prescriptionHistory];
    setPrescriptionHistory(updatedHistory);
    localStorage.setItem('prescriptionHistory', JSON.stringify(updatedHistory));
    
    alert('Prescrição salva no histórico com sucesso!');
  };
  
  const loadPrescriptionFromHistory = (entry) => {
    if (confirm('Carregar esta prescrição? A prescrição atual será substituída.')) {
      setPatientInfo(entry.patientInfo);
      setPrescription(entry.prescription);
      setMagistralConfig(entry.magistralConfig);
      setShowHistory(false);
      alert('Prescrição carregada com sucesso!');
    }
  };
  
  const deletePrescriptionFromHistory = (id) => {
    if (confirm('Deletar esta prescrição do histórico?')) {
      const updatedHistory = prescriptionHistory.filter(entry => entry.id !== id);
      setPrescriptionHistory(updatedHistory);
      localStorage.setItem('prescriptionHistory', JSON.stringify(updatedHistory));
    }
  };
  
  const clearHistory = () => {
    if (confirm('Limpar todo o histórico? Esta ação não pode ser desfeita.')) {
      setPrescriptionHistory([]);
      localStorage.removeItem('prescriptionHistory');
      alert('Histórico limpo com sucesso!');
    }
  };
  
  const exportHistory = () => {
    const dataStr = JSON.stringify(prescriptionHistory, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'historico-prescricoes-' + new Date().toISOString().split('T')[0] + '.json';
    
    // Adicionar ao DOM temporariamente
    document.body.appendChild(link);
    link.click();
    
    // Limpar após download
    setTimeout(() => {
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }, 100);
  };
  
  const importHistory = (event) => {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const imported = JSON.parse(e.target.result);
        if (confirm('Importar ' + imported.length + ' prescrições? Isso irá SUBSTITUIR o histórico atual.')) {
          setPrescriptionHistory(imported);
          localStorage.setItem('prescriptionHistory', JSON.stringify(imported));
          alert('Histórico importado com sucesso!');
        }
      } catch (error) {
        alert('Erro ao importar arquivo. Verifique se é um arquivo JSON válido.');
      }
    };
    reader.readAsText(file);
  };

  // ============ FUNÇÕES PARA FÓRMULAS PERSONALIZADAS ============
  
  // Adicionar ativo à fórmula personalizada em construção
  const addAtivoToCustomFormula = () => {
    if (!tempAtivo.substancia || !tempAtivo.dose) {
      alert('Preencha pelo menos substância e dose');
      return;
    }
    
    setCustomFormulaForm({
      ...customFormulaForm,
      ativos: [...customFormulaForm.ativos, {...tempAtivo}]
    });
    
    setTempAtivo({
      substancia: '',
      ligante: '',
      dose: '',
      horario: ''
    });
  };
  
  // Remover ativo da fórmula em construção
  const removeAtivoFromCustomFormula = (index) => {
    setCustomFormulaForm({
      ...customFormulaForm,
      ativos: customFormulaForm.ativos.filter((_, i) => i !== index)
    });
  };
  
  // Salvar fórmula personalizada
  const saveCustomFormula = () => {
    if (!customFormulaForm.nome) {
      alert('Preencha o nome da fórmula');
      return;
    }
    
    if (customFormulaForm.ativos.length === 0) {
      alert('Adicione pelo menos um ativo à fórmula');
      return;
    }
    
    const newFormula = {
      id: editingCustomFormula ? editingCustomFormula.id : Date.now(),
      ...customFormulaForm,
      createdAt: editingCustomFormula ? editingCustomFormula.createdAt : new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    
    let updatedFormulas;
    if (editingCustomFormula) {
      updatedFormulas = customFormulas.map(f => f.id === editingCustomFormula.id ? newFormula : f);
      alert('Fórmula atualizada com sucesso!');
    } else {
      updatedFormulas = [...customFormulas, newFormula];
      alert('Fórmula cadastrada com sucesso!');
    }
    
    setCustomFormulas(updatedFormulas);
    localStorage.setItem('customFormulas', JSON.stringify(updatedFormulas));
    
    // Reset form
    setCustomFormulaForm({
      nome: '',
      categoria: '',
      indicacao: '',
      via: 'oral',
      ativos: [],
      excipiente: 'celulose_microcristalina',
      qsp: '1_capsula',
      quantidade: 30,
      posologia: '',
      observacoes: ''
    });
    setEditingCustomFormula(null);
    setShowCustomFormulaForm(false);
  };
  
  // Editar fórmula personalizada
  const editCustomFormula = (formula) => {
    setCustomFormulaForm(formula);
    setEditingCustomFormula(formula);
    setShowCustomFormulaForm(true);
  };
  
  // Deletar fórmula personalizada
  const deleteCustomFormula = (id) => {
    if (!confirm('Deletar esta fórmula personalizada?')) {
      return;
    }
    
    const updatedFormulas = customFormulas.filter(f => f.id !== id);
    setCustomFormulas(updatedFormulas);
    localStorage.setItem('customFormulas', JSON.stringify(updatedFormulas));
  };
  
  // Importar fórmula personalizada para prescrição
  const importCustomFormula = (formula) => {
    importClinicalFormula(formula); // Usa a mesma lógica
  };
  
  // Exportar fórmulas personalizadas
  const exportCustomFormulas = () => {
    if (customFormulas.length === 0) {
      alert('Nenhuma fórmula personalizada para exportar');
      return;
    }
    
    const dataStr = JSON.stringify(customFormulas, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'minhas-formulas-' + new Date().toISOString().split('T')[0] + '.json';
    
    // Adicionar ao DOM temporariamente
    document.body.appendChild(link);
    link.click();
    
    // Limpar após download
    setTimeout(() => {
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }, 100);
  };
  
  // Importar fórmulas personalizadas
  const importCustomFormulas = (event) => {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const imported = JSON.parse(e.target.result);
        if (confirm('Importar ' + imported.length + ' fórmulas? Isso irá ADICIONAR às suas fórmulas existentes.')) {
          const merged = [...customFormulas, ...imported];
          setCustomFormulas(merged);
          localStorage.setItem('customFormulas', JSON.stringify(merged));
          alert('Fórmulas importadas com sucesso!');
        }
      } catch (error) {
        alert('Erro ao importar arquivo. Verifique se é um arquivo JSON válido.');
      }
    };
    reader.readAsText(file);
  };
  
  // Limpar todas as fórmulas personalizadas
  const clearCustomFormulas = () => {
    if (confirm('Limpar todas as fórmulas personalizadas? Esta ação não pode ser desfeita.')) {
      setCustomFormulas([]);
      localStorage.removeItem('customFormulas');
      alert('Fórmulas personalizadas limpas com sucesso!');
    }
  };

  // ============ FUNÇÕES PARA PRESCRITORES ============
  
  // Salvar prescritor
  const savePrescritor = () => {
    if (!prescritorForm.nome) {
      alert('Preencha o nome do prescritor');
      return;
    }
    
    const newPrescritor = {
      id: editingPrescritor ? editingPrescritor.id : Date.now(),
      ...prescritorForm,
      createdAt: editingPrescritor ? editingPrescritor.createdAt : new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    
    let updatedPrescritores;
    if (editingPrescritor) {
      updatedPrescritores = prescritores.map(p => p.id === editingPrescritor.id ? newPrescritor : p);
      alert('Prescritor atualizado!');
    } else {
      updatedPrescritores = [...prescritores, newPrescritor];
      alert('Prescritor cadastrado!');
      
      // Se é o primeiro, selecionar automaticamente
      if (updatedPrescritores.length === 1) {
        setSelectedPrescritor(newPrescritor);
        localStorage.setItem('selectedPrescritor', JSON.stringify(newPrescritor));
      }
    }
    
    setPrescritores(updatedPrescritores);
    localStorage.setItem('prescritores', JSON.stringify(updatedPrescritores));
    
    // Reset form
    setPrescritorForm({
      nome: '',
      titulo: '',
      especialidade: '',
      crm: '',
      uf_crm: '',
      crn: '',
      cpf: '',
      telefone: '',
      email: '',
      endereco: '',
      cidade: '',
      uf: '',
      cep: '',
      mostrar: {
        titulo: true,
        especialidade: true,
        crm: true,
        crn: false,
        cpf: false,
        telefone: true,
        email: true,
        endereco: true
      }
    });
    setEditingPrescritor(null);
    setShowPrescritorForm(false);
  };
  
  // Editar prescritor
  const editPrescritor = (prescritor) => {
    setPrescritorForm(prescritor);
    setEditingPrescritor(prescritor);
    setShowPrescritorForm(true);
  };
  
  // Deletar prescritor
  const deletePrescritor = (id) => {
    if (!confirm('Deletar este prescritor?')) {
      return;
    }
    
    const updatedPrescritores = prescritores.filter(p => p.id !== id);
    setPrescritores(updatedPrescritores);
    localStorage.setItem('prescritores', JSON.stringify(updatedPrescritores));
    
    // Se deletou o selecionado, desselecionar
    if (selectedPrescritor && selectedPrescritor.id === id) {
      setSelectedPrescritor(null);
      localStorage.removeItem('selectedPrescritor');
    }
    
    alert('Prescritor deletado!');
  };
  
  // Selecionar prescritor ativo
  const selectPrescritor = (prescritor) => {
    setSelectedPrescritor(prescritor);
    localStorage.setItem('selectedPrescritor', JSON.stringify(prescritor));
  };
  
  // Formatar dados do prescritor para exibição
  const formatPrescritorInfo = () => {
    if (!selectedPrescritor) return '';
    
    const p = selectedPrescritor;
    let info = '';
    
    // Nome e título
    if (p.mostrar.titulo && p.titulo) {
      info += `${p.titulo} ${p.nome}\n`;
    } else {
      info += `${p.nome}\n`;
    }
    
    // Especialidade
    if (p.mostrar.especialidade && p.especialidade) {
      info += `${p.especialidade}\n`;
    }
    
    // CRM
    if (p.mostrar.crm && p.crm) {
      info += `CRM: ${p.crm}`;
      if (p.uf_crm) info += `/${p.uf_crm}`;
      info += '\n';
    }
    
    // CRN
    if (p.mostrar.crn && p.crn) {
      info += `CRN: ${p.crn}\n`;
    }
    
    // CPF
    if (p.mostrar.cpf && p.cpf) {
      info += `CPF: ${p.cpf}\n`;
    }
    
    // Telefone
    if (p.mostrar.telefone && p.telefone) {
      info += `Tel: ${p.telefone}\n`;
    }
    
    // Email
    if (p.mostrar.email && p.email) {
      info += `Email: ${p.email}\n`;
    }
    
    // Endereço
    if (p.mostrar.endereco && p.endereco) {
      info += `${p.endereco}`;
      if (p.cidade) info += `, ${p.cidade}`;
      if (p.uf) info += `/${p.uf}`;
      if (p.cep) info += ` - CEP: ${p.cep}`;
      info += '\n';
    }
    
    return info;
  };

  // ============ FUNÇÕES PARA GERENCIAR BIBLIOTECA CLÍNICA ============
  
  // Adicionar ativo à fórmula clínica em construção
  const addAtivoToClinicalFormula = () => {
    if (!tempClinicalAtivo.substancia || !tempClinicalAtivo.dose) {
      alert('Preencha pelo menos substância e dose');
      return;
    }
    
    setClinicalFormulaForm({
      ...clinicalFormulaForm,
      ativos: [...clinicalFormulaForm.ativos, {...tempClinicalAtivo}]
    });
    
    setTempClinicalAtivo({
      substancia: '',
      ligante: '',
      dose: '',
      horario: ''
    });
  };
  
  // Remover ativo da fórmula clínica em construção
  const removeAtivoFromClinicalFormula = (index) => {
    setClinicalFormulaForm({
      ...clinicalFormulaForm,
      ativos: clinicalFormulaForm.ativos.filter((_, i) => i !== index)
    });
  };
  
  // Salvar fórmula clínica na biblioteca
  const saveClinicalFormula = () => {
    if (!clinicalFormulaForm.nome || !clinicalFormulaForm.categoria || !clinicalFormulaForm.subcategoria) {
      alert('Preencha nome, categoria e subcategoria');
      return;
    }
    
    if (clinicalFormulaForm.ativos.length === 0) {
      alert('Adicione pelo menos um ativo à fórmula');
      return;
    }
    
    const newFormula = {
      id: editingClinicalFormula ? editingClinicalFormula.id : 'custom-' + Date.now(),
      nome: clinicalFormulaForm.nome,
      indicacao: clinicalFormulaForm.indicacao,
      via: clinicalFormulaForm.via,
      ativos: clinicalFormulaForm.ativos,
      excipiente: clinicalFormulaForm.excipiente,
      qsp: clinicalFormulaForm.qsp,
      quantidade: clinicalFormulaForm.quantidade,
      posologia: clinicalFormulaForm.posologia,
      observacoes: clinicalFormulaForm.observacoes
    };
    
    // Copiar biblioteca
    const updatedLibrary = JSON.parse(JSON.stringify(clinicalLibrary));
    
    // Garantir que categoria e subcategoria existam
    const catKey = clinicalFormulaForm.categoria;
    const subcatKey = clinicalFormulaForm.subcategoria;
    
    if (!updatedLibrary[catKey]) {
      updatedLibrary[catKey] = {
        nome: catKey,
        categorias: {}
      };
    }
    
    if (!updatedLibrary[catKey].categorias[subcatKey]) {
      updatedLibrary[catKey].categorias[subcatKey] = {
        nome: subcatKey,
        formulas: []
      };
    }
    
    if (editingClinicalFormula) {
      // Editar existente
      const formulas = updatedLibrary[catKey].categorias[subcatKey].formulas;
      const index = formulas.findIndex(f => f.id === editingClinicalFormula.id);
      if (index !== -1) {
        formulas[index] = newFormula;
      }
      alert('Fórmula atualizada na biblioteca clínica!');
    } else {
      // Adicionar nova
      updatedLibrary[catKey].categorias[subcatKey].formulas.push(newFormula);
      alert('Fórmula adicionada à biblioteca clínica!');
    }
    
    setClinicalLibrary(updatedLibrary);
    localStorage.setItem('clinicalLibrary', JSON.stringify(updatedLibrary));
    
    // Reset form
    setClinicalFormulaForm({
      nome: '',
      categoria: '',
      subcategoria: '',
      indicacao: '',
      via: 'oral',
      ativos: [],
      excipiente: 'celulose_microcristalina',
      qsp: '1_capsula',
      quantidade: 30,
      posologia: '',
      observacoes: ''
    });
    setEditingClinicalFormula(null);
    setShowClinicalFormulaForm(false);
  };
  
  // Editar fórmula clínica
  const editClinicalFormula = (formula, categoria, subcategoria) => {
    setClinicalFormulaForm({
      ...formula,
      categoria,
      subcategoria
    });
    setEditingClinicalFormula(formula);
    setShowClinicalFormulaForm(true);
  };
  
  // Deletar fórmula clínica
  const deleteClinicalFormula = (formulaId, categoria, subcategoria) => {
    if (!confirm('Deletar esta fórmula da biblioteca clínica?')) {
      return;
    }
    
    const updatedLibrary = JSON.parse(JSON.stringify(clinicalLibrary));
    const formulas = updatedLibrary[categoria].categorias[subcategoria].formulas;
    updatedLibrary[categoria].categorias[subcategoria].formulas = formulas.filter(f => f.id !== formulaId);
    
    setClinicalLibrary(updatedLibrary);
    localStorage.setItem('clinicalLibrary', JSON.stringify(updatedLibrary));
    alert('Fórmula removida da biblioteca clínica!');
  };

  // Função para importar fórmula clínica da biblioteca
  const importClinicalFormula = (formula) => {
    if (prescription.length > 0) {
      if (!confirm('Importar esta fórmula clínica? A prescrição atual será substituída.')) {
        return;
      }
    }
    
    // Mapear ativos da fórmula para substâncias do sistema
    const importedItems = [];
    
    formula.ativos.forEach((ativo) => {
      // Buscar substância correspondente no banco
      const substancia = nutraceuticos.find(n => 
        n.name.toLowerCase().includes(ativo.substancia.toLowerCase())
      );
      
      if (substancia) {
        // Se o ativo tem ligante especificado (e não é '-'), usar esse
        // Caso contrário, usar o ligante default da substância
        let liganteToUse = '';
        if (ativo.ligante && ativo.ligante !== '-' && ativo.ligante.trim() !== '') {
          liganteToUse = ativo.ligante;
        } else if (substancia.ligantes?.default) {
          liganteToUse = substancia.ligantes.default;
        }
        
        importedItems.push({
          ...substancia,
          dosage: ativo.dose,
          customDosage: ativo.dose, // Para exibição na prescrição
          timing: ativo.horario,
          selectedLigante: liganteToUse,
          selectedExcipiente: substancia.excipiente?.default || ''
        });
      } else {
        // Se não encontrar, criar como substância customizada
        importedItems.push({
          id: Date.now() + Math.random(),
          name: ativo.substancia,
          category: 'Fórmula Clínica',
          dosage: ativo.dose,
          customDosage: ativo.dose,
          timing: ativo.horario,
          mechanism: '',
          evidence: 'Fórmula Clínica',
          dri: 'Conforme fórmula',
          conditions: [],
          interactions: 'Conforme fórmula',
          contraindications: 'Conforme fórmula',
          notes: 'Importado da biblioteca clínica',
          selectedLigante: ativo.ligante && ativo.ligante !== '-' ? ativo.ligante : '',
          selectedExcipiente: ''
        });
      }
    });
    
    // Atualizar prescrição
    setPrescription(importedItems);
    
    // Atualizar configurações magistrais
    setMagistralConfig({
      ...magistralConfig,
      via: formula.via,
      excipiente: formula.excipiente,
      qsp: formula.qsp || '1_capsula',
      quantidade: formula.quantidade,
      posologia: formula.posologia,
      observacoes: formula.observacoes || ''
    });
    
    setShowClinicalLibrary(false);
    setSelectedClinicalFormula(null);
    
    alert('Fórmula clínica importada com sucesso!\n\nTodos os campos são editáveis. Você pode:\n- Ajustar doses\n- Adicionar ou remover substâncias\n- Modificar ligantes e excipientes\n- Alterar configurações magistrais');
  };


  const generatePrescriptionText = () => {
    const date = new Date().toLocaleDateString('pt-BR');
    let text = `╔═══════════════════════════════════════════════════════╗\n`;
    text += `║   PRESCRIÇÃO DE NUTRACÊUTICOS E MICRONUTRIENTES      ║\n`;
    text += `║          Psiquiatria Nutricional - ILSI Brasil        ║\n`;
    text += `╚═══════════════════════════════════════════════════════╝\n\n`;
    text += `Data: ${date}\n\n`;
    
    if (patientInfo.name) {
      text += `DADOS DO PACIENTE:\n`;
      text += `Nome: ${patientInfo.name}\n`;
      if (patientInfo.age) text += `Idade: ${patientInfo.age} anos\n`;
      if (patientInfo.weight) text += `Peso: ${patientInfo.weight} kg\n`;
      text += `Sexo: ${patientInfo.gender === 'M' ? 'Masculino' : 'Feminino'}\n`;
      text += `\n`;
    }

    text += `═══════════════════════════════════════════════════════\n`;
    text += `PRESCRIÇÃO:\n`;
    text += `═══════════════════════════════════════════════════════\n\n`;

    prescription.forEach((item, index) => {
      text += `${index + 1}. ${item.name}\n`;
      text += `   Categoria: ${item.category}\n`;
      text += `   Dosagem Prescrita: ${item.customDosage}\n`;
      if (showDRI && item.dri) text += `   DRI (Referência): ${item.dri}\n`;
      text += `   Administração: ${item.timing}\n`;
      text += `   Mecanismo: ${item.mechanism}\n`;
      if (item.notes) text += `   Obs: ${item.notes}\n`;
      text += `\n`;
    });

    text += `═══════════════════════════════════════════════════════\n`;
    text += `RECOMENDAÇÕES GERAIS:\n`;
    text += `═══════════════════════════════════════════════════════\n\n`;
    text += `• Iniciar suplementos gradualmente (1-2 por semana)\n`;
    text += `• Tomar com refeições quando indicado para melhor absorção\n`;
    text += `• Manter hidratação adequada (2-3L água/dia)\n`;
    text += `• Monitorar sintomas e efeitos colaterais\n`;
    text += `• Reavaliar após 8-12 semanas\n`;
    text += `• Exames laboratoriais conforme indicado\n\n`;

    text += `INTERAÇÕES E PRECAUÇÕES:\n`;
    prescription.forEach(item => {
      if (item.interactions && item.interactions !== 'Nenhuma significativa') {
        text += `• ${item.name}: ${item.interactions}\n`;
      }
    });

    text += `\n`;
    text += `CONTRAINDICAÇÕES:\n`;
    prescription.forEach(item => {
      if (item.contraindications && item.contraindications !== 'Nenhuma conhecida') {
        text += `• ${item.name}: ${item.contraindications}\n`;
      }
    });

    text += `\n═══════════════════════════════════════════════════════\n`;
    text += `REFERÊNCIAS:\n`;
    text += `• ILSI Brasil - Recomendações de Nutrientes (DRIs)\n`;
    text += `• Institute of Medicine (IOM) - Dietary Reference Intakes\n`;
    text += `• Evidências científicas em Psiquiatria Nutricional\n\n`;
    text += `Esta prescrição não substitui acompanhamento médico.\n\n`;
    
    // Dados do prescritor
    if (selectedPrescritor) {
      text += `═══════════════════════════════════════════════════════\n`;
      text += `PRESCRITOR:\n`;
      text += `═══════════════════════════════════════════════════════\n\n`;
      text += formatPrescritorInfo();
    } else {
      text += `Prescritor: _____________________________________\n`;
      text += `CRM/CRN: _____________________________________\n`;
    }

    return text;
  };
  
  const generateMagistralFormula = () => {
    if (prescription.length === 0) return '';
    
    const date = new Date().toLocaleDateString('pt-BR');
    const viaLabel = viasUso.find(v => v.value === magistralConfig.via)?.label || '';
    const formaLabel = formasFarmaceuticas.find(f => f.value === magistralConfig.formaFarmaceutica)?.label || '';
    const excipienteLabel = excipientes.find(e => e.value === magistralConfig.excipiente)?.label || '';
    const qspLabel = qspOpcoes.find(q => q.value === magistralConfig.qsp)?.label || '';
    
    let formulas = [];
    
    if (magistralConfig.groupFormulas) {
      // FÓRMULA ÚNICA - TODOS OS COMPONENTES JUNTOS
      let formula = `╔═══════════════════════════════════════════════════════╗\n`;
      formula += `║            PRESCRIÇÃO MAGISTRAL - FÓRMULA ÚNICA       ║\n`;
      formula += `╚═══════════════════════════════════════════════════════╝\n\n`;
      
      if (patientInfo.name) {
        formula += `Paciente: ${patientInfo.name}\n`;
        if (patientInfo.age) formula += `Idade: ${patientInfo.age} anos | `;
        if (patientInfo.weight) formula += `Peso: ${patientInfo.weight} kg\n`;
        formula += `\n`;
      }
      
      formula += `Data: ${date}\n`;
      formula += `Via de Administração: ${viaLabel}\n`;
      formula += `Forma Farmacêutica: ${formaLabel}\n\n`;
      
      formula += `─────────────────────────────────────────────────────\n`;
      formula += `FÓRMULA:\n`;
      formula += `─────────────────────────────────────────────────────\n\n`;
      
      prescription.forEach((item, index) => {
        // Exibir nome com ligante (mas NÃO excipiente individual na fórmula única)
        let displayName = item.name;
        if (item.selectedLigante) {
          displayName = `${item.name} (${item.selectedLigante})`;
        }
        formula += `${index + 1}. ${displayName}\n`;
        formula += `   ${item.customDosage}\n`;
        formula += `\n`;
      });
      
      // Na fórmula única, SEMPRE mostrar apenas o excipiente magistral
      if (magistralConfig.excipiente !== 'criterio_farmacia') {
        formula += `Excipiente: ${excipienteLabel}\n`;
      }
      formula += `QSP: ${qspLabel}\n\n`;
      
      formula += `─────────────────────────────────────────────────────\n`;
      formula += `MANIPULAR:\n`;
      formula += `Quantidade: ${magistralConfig.quantidade} unidades\n\n`;
      
      formula += `─────────────────────────────────────────────────────\n`;
      formula += `POSOLOGIA:\n`;
      formula += `${magistralConfig.posologia}\n\n`;
      
      if (magistralConfig.observacoes) {
        formula += `─────────────────────────────────────────────────────\n`;
        formula += `OBSERVAÇÕES:\n`;
        formula += `${magistralConfig.observacoes}\n\n`;
      }
      
      formula += `═══════════════════════════════════════════════════════\n\n`;
      
      // Dados do prescritor
      if (selectedPrescritor) {
        formula += formatPrescritorInfo();
        formula += `\nAssinatura: ______________________________________\n`;
      } else {
        formula += `Prescritor: ______________________________________\n`;
        formula += `CRM/CRN: ________________  Assinatura: __________\n`;
      }
      
      formulas.push({ id: 'unica', formula });
      
    } else {
      // FÓRMULAS SEPARADAS - UMA PARA CADA COMPONENTE
      prescription.forEach((item, index) => {
        let formula = `╔═══════════════════════════════════════════════════════╗\n`;
        formula += `║       PRESCRIÇÃO MAGISTRAL - FÓRMULA ${index + 1} de ${prescription.length}        ║\n`;
        formula += `╚═══════════════════════════════════════════════════════╝\n\n`;
        
        if (patientInfo.name) {
          formula += `Paciente: ${patientInfo.name}\n`;
          if (patientInfo.age) formula += `Idade: ${patientInfo.age} anos | `;
          if (patientInfo.weight) formula += `Peso: ${patientInfo.weight} kg\n`;
          formula += `\n`;
        }
        
        formula += `Data: ${date}\n`;
        formula += `Categoria: ${item.category}\n`;
        formula += `Via de Administração: ${viaLabel}\n`;
        formula += `Forma Farmacêutica: ${formaLabel}\n\n`;
        
        formula += `─────────────────────────────────────────────────────\n`;
        formula += `FÓRMULA:\n`;
        formula += `─────────────────────────────────────────────────────\n\n`;
        
        // Exibir nome com ligante se disponível
        let displayName = item.name;
        if (item.selectedLigante) {
          displayName = `${item.name} (${item.selectedLigante})`;
        }
        formula += `${displayName}\n`;
        formula += `${item.customDosage}\n`;
        
        // Adicionar excipiente se for vitamina lipossolúvel (APÓS a dosagem)
        if (item.selectedExcipiente) {
          formula += `Excipiente: ${item.selectedExcipiente}\n`;
        }
        formula += `\n`;
        
        // Só mostrar excipiente magistral se não for vitamina lipossolúvel
        // e se não for "A critério da farmácia"
        if (!item.selectedExcipiente && magistralConfig.excipiente !== 'criterio_farmacia') {
          formula += `Excipiente: ${excipienteLabel}\n`;
        }
        formula += `QSP: ${qspLabel}\n\n`;
        
        formula += `─────────────────────────────────────────────────────\n`;
        formula += `MANIPULAR:\n`;
        formula += `Quantidade: ${magistralConfig.quantidade} unidades\n\n`;
        
        formula += `─────────────────────────────────────────────────────\n`;
        formula += `POSOLOGIA:\n`;
        formula += `${magistralConfig.posologia}\n\n`;
        
        if (magistralConfig.observacoes) {
          formula += `─────────────────────────────────────────────────────\n`;
          formula += `OBSERVAÇÕES:\n`;
          formula += `${magistralConfig.observacoes}\n\n`;
        }
        
        formula += `═══════════════════════════════════════════════════════\n\n`;
        
        // Dados do prescritor
        if (selectedPrescritor) {
          formula += formatPrescritorInfo();
          formula += `\nAssinatura: ______________________________________\n`;
        } else {
          formula += `Prescritor: ______________________________________\n`;
          formula += `CRM/CRN: ________________  Assinatura: __________\n`;
        }
        
        formulas.push({ id: item.id, name: item.name, formula });
      });
    }
    
    return formulas;
  };
  
  const copyToClipboard = (text, id) => {
    navigator.clipboard.writeText(text).then(() => {
      setCopiedFormula(id);
      setTimeout(() => setCopiedFormula(null), 2000);
    });
  };

  
  // Copiar prescrição ASCII para área de transferência (para colar no Tribe MD / Bipp)
  const copyPrescriptionToClipboard = () => {
    if (prescription.length === 0) {
      alert('Adicione substâncias à prescrição antes de copiar.');
      return;
    }
    
    const date = new Date().toLocaleDateString('pt-BR');
    const viaLabel = viasUso.find(v => v.value === magistralConfig.via)?.label || '';
    const formaLabel = formasFarmaceuticas.find(f => f.value === magistralConfig.formaFarmaceutica)?.label || '';
    const excipienteLabel = excipientes.find(e => e.value === magistralConfig.excipiente)?.label || '';
    const qspLabel = qspOpcoes.find(q => q.value === magistralConfig.qsp)?.label || '';
    
    let text = '';
    
    // Cabeçalho ASCII puro
    text += '========================================================\r\n';
    text += '            PRESCRICAO MAGISTRAL\r\n';
    text += '========================================================\r\n\r\n';
    
    // Dados do paciente
    if (patientInfo.name) {
      text += `Paciente: ${patientInfo.name}\r\n`;
      if (patientInfo.age) text += `Idade: ${patientInfo.age} anos`;
      if (patientInfo.weight) text += ` | Peso: ${patientInfo.weight} kg`;
      if (patientInfo.age || patientInfo.weight) text += '\r\n';
      text += '\r\n';
    }
    
    text += `Data: ${date}\r\n`;
    text += `Via de Administracao: ${viaLabel}\r\n`;
    text += `Forma Farmaceutica: ${formaLabel}\r\n\r\n`;
    
    // Separador
    text += '--------------------------------------------------------\r\n';
    text += 'FORMULA:\r\n';
    text += '--------------------------------------------------------\r\n\r\n';
    
    // Lista de componentes
    prescription.forEach((item, index) => {
      let displayName = item.name;
      if (item.selectedLigante) {
        displayName = `${item.name} (${item.selectedLigante})`;
      }
      text += `${index + 1}. ${displayName}\r\n`;
      text += `   ${item.customDosage}\r\n`;
      text += '\r\n';
    });
    
    // Excipiente e QSP
    if (magistralConfig.excipiente !== 'criterio_farmacia') {
      text += `Excipiente: ${excipienteLabel}\r\n`;
    }
    text += `QSP: ${qspLabel}\r\n\r\n`;
    
    // Manipular
    text += '--------------------------------------------------------\r\n';
    text += 'MANIPULAR:\r\n';
    text += `Quantidade: ${magistralConfig.quantidade} unidades\r\n\r\n`;
    
    // Posologia
    text += '--------------------------------------------------------\r\n';
    text += 'POSOLOGIA:\r\n';
    text += `${magistralConfig.posologia}\r\n\r\n`;
    
    // Observações
    if (magistralConfig.observacoes) {
      text += '--------------------------------------------------------\r\n';
      text += 'OBSERVACOES:\r\n';
      text += `${magistralConfig.observacoes}\r\n\r\n`;
    }
    
    text += '========================================================\r\n\r\n';
    
    // Dados do prescritor
    if (selectedPrescritor) {
      if (selectedPrescritor.titulo && selectedPrescritor.mostrar?.titulo) {
        text += `${selectedPrescritor.titulo} `;
      }
      text += `${selectedPrescritor.nome}\r\n`;
      
      if (selectedPrescritor.especialidade && selectedPrescritor.mostrar?.especialidade) {
        text += `${selectedPrescritor.especialidade}\r\n`;
      }
      
      if (selectedPrescritor.crm && selectedPrescritor.mostrar?.crm) {
        text += `CRM: ${selectedPrescritor.crm}`;
        if (selectedPrescritor.uf_crm) {
          text += `-${selectedPrescritor.uf_crm}`;
        }
        text += '\r\n';
      }
      
      if (selectedPrescritor.crn && selectedPrescritor.mostrar?.crn) {
        text += `CRN: ${selectedPrescritor.crn}\r\n`;
      }
      
      if (selectedPrescritor.telefone && selectedPrescritor.mostrar?.telefone) {
        text += `Telefone: ${selectedPrescritor.telefone}\r\n`;
      }
      
      if (selectedPrescritor.email && selectedPrescritor.mostrar?.email) {
        text += `Email: ${selectedPrescritor.email}\r\n`;
      }
      
      if (selectedPrescritor.endereco && selectedPrescritor.mostrar?.endereco) {
        text += `${selectedPrescritor.endereco}`;
        if (selectedPrescritor.cidade) {
          text += `, ${selectedPrescritor.cidade}`;
        }
        if (selectedPrescritor.uf) {
          text += ` - ${selectedPrescritor.uf}`;
        }
        if (selectedPrescritor.cep) {
          text += ` - CEP: ${selectedPrescritor.cep}`;
        }
        text += '\r\n';
      }
      
      text += '\r\nAssinatura: ______________________________________\r\n';
    } else {
      text += 'Prescritor: ______________________________________\r\n';
      text += 'CRM/CRN: ________________  Assinatura: __________\r\n';
    }
    
    // Copiar para área de transferência
    navigator.clipboard.writeText(text).then(() => {
      alert('✅ Prescrição copiada!\n\nAgora você pode colar (Ctrl+V) no Tribe MD ou Bipp Assistant.');
    }).catch(err => {
      alert('❌ Erro ao copiar. Tente novamente ou use a opção de baixar TXT.');
      console.error('Erro ao copiar:', err);
    });
  };
  
  // Gerar PDF bonito com jsPDF (layout profissional com cores)
  const generateBeautifulPDF = () => {
    if (prescription.length === 0) {
      alert('Adicione substâncias à prescrição antes de gerar PDF.');
      return;
    }
    
    try {
      // Criar novo documento PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const date = new Date().toLocaleDateString('pt-BR');
      const viaLabel = viasUso.find(v => v.value === magistralConfig.via)?.label || '';
      const formaLabel = formasFarmaceuticas.find(f => f.value === magistralConfig.formaFarmaceutica)?.label || '';
      const excipienteLabel = excipientes.find(e => e.value === magistralConfig.excipiente)?.label || '';
      const qspLabel = qspOpcoes.find(q => q.value === magistralConfig.qsp)?.label || '';
      
      let yPos = 20;
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 20;
      const contentWidth = pageWidth - (margin * 2);
      
      // Cabeçalho com fundo colorido
      doc.setFillColor(102, 126, 234); // Azul
      doc.rect(0, 0, pageWidth, 40, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(22);
      doc.setFont(undefined, 'bold');
      doc.text('PRESCRIÇÃO MAGISTRAL', pageWidth / 2, 25, { align: 'center' });
      
      yPos = 50;
      doc.setTextColor(0, 0, 0);
      
      // Dados do paciente (caixa azul claro)
      if (patientInfo.name) {
        doc.setFillColor(230, 240, 255);
        doc.roundedRect(margin, yPos, contentWidth, 25, 3, 3, 'F');
        
        yPos += 8;
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text('Paciente:', margin + 5, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(patientInfo.name, margin + 30, yPos);
        
        yPos += 7;
        if (patientInfo.age || patientInfo.weight) {
          let info = '';
          if (patientInfo.age) info += `Idade: ${patientInfo.age} anos`;
          if (patientInfo.weight) info += `${info ? '  |  ' : ''}Peso: ${patientInfo.weight} kg`;
          doc.setFontSize(10);
          doc.text(info, margin + 5, yPos);
        }
        
        yPos += 15;
      }
      
      // Data e informações básicas
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.text(`Data: ${date}`, margin, yPos);
      yPos += 6;
      doc.text(`Via de Administração: ${viaLabel}`, margin, yPos);
      yPos += 6;
      doc.text(`Forma Farmacêutica: ${formaLabel}`, margin, yPos);
      yPos += 12;
      
      // Seção Fórmula (caixa verde claro)
      doc.setFillColor(200, 230, 200);
      doc.setDrawColor(100, 180, 100);
      doc.setLineWidth(0.5);
      doc.roundedRect(margin, yPos, contentWidth, 8, 2, 2, 'FD');
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(40, 120, 40);
      doc.text('FÓRMULA', margin + 5, yPos + 6);
      
      yPos += 14;
      doc.setTextColor(0, 0, 0);
      
      // Lista de componentes
      doc.setFontSize(10);
      prescription.forEach((item, index) => {
        // Verificar se precisa de nova página
        if (yPos > 250) {
          doc.addPage();
          yPos = 20;
        }
        
        let displayName = item.name;
        if (item.selectedLigante) {
          displayName = `${item.name} (${item.selectedLigante})`;
        }
        
        doc.setFont(undefined, 'bold');
        doc.text(`${index + 1}. ${displayName}`, margin + 5, yPos);
        yPos += 6;
        
        doc.setFont(undefined, 'normal');
        doc.setTextColor(80, 80, 80);
        doc.text(`   ${item.customDosage}`, margin + 5, yPos);
        doc.setTextColor(0, 0, 0);
        yPos += 8;
      });
      
      yPos += 4;
      
      // Excipiente e QSP
      if (magistralConfig.excipiente !== 'criterio_farmacia') {
        doc.setFont(undefined, 'bold');
        doc.text('Excipiente:', margin + 5, yPos);
        doc.setFont(undefined, 'normal');
        doc.text(excipienteLabel, margin + 30, yPos);
        yPos += 6;
      }
      
      doc.setFont(undefined, 'bold');
      doc.text('QSP:', margin + 5, yPos);
      doc.setFont(undefined, 'normal');
      doc.text(qspLabel, margin + 20, yPos);
      yPos += 12;
      
      // Seção Manipular (caixa amarela clara)
      if (yPos > 240) {
        doc.addPage();
        yPos = 20;
      }
      
      doc.setFillColor(255, 250, 205);
      doc.setDrawColor(220, 180, 0);
      doc.roundedRect(margin, yPos, contentWidth, 8, 2, 2, 'FD');
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(150, 100, 0);
      doc.text('MANIPULAR', margin + 5, yPos + 6);
      
      yPos += 14;
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.text(`Quantidade: ${magistralConfig.quantidade} unidades`, margin + 5, yPos);
      yPos += 12;
      
      // Seção Posologia (caixa roxa clara)
      if (yPos > 240) {
        doc.addPage();
        yPos = 20;
      }
      
      doc.setFillColor(240, 230, 255);
      doc.setDrawColor(150, 100, 200);
      doc.roundedRect(margin, yPos, contentWidth, 8, 2, 2, 'FD');
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(100, 50, 150);
      doc.text('POSOLOGIA', margin + 5, yPos + 6);
      
      yPos += 14;
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      
      // Quebrar posologia em múltiplas linhas se necessário
      const posologiaLines = doc.splitTextToSize(magistralConfig.posologia, contentWidth - 10);
      posologiaLines.forEach(line => {
        if (yPos > 270) {
          doc.addPage();
          yPos = 20;
        }
        doc.text(line, margin + 5, yPos);
        yPos += 6;
      });
      
      yPos += 6;
      
      // Observações (se houver)
      if (magistralConfig.observacoes) {
        if (yPos > 240) {
          doc.addPage();
          yPos = 20;
        }
        
        doc.setFillColor(255, 240, 240);
        doc.setDrawColor(200, 100, 100);
        doc.roundedRect(margin, yPos, contentWidth, 8, 2, 2, 'FD');
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(150, 50, 50);
        doc.text('OBSERVAÇÕES', margin + 5, yPos + 6);
        
        yPos += 14;
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        
        const obsLines = doc.splitTextToSize(magistralConfig.observacoes, contentWidth - 10);
        obsLines.forEach(line => {
          if (yPos > 270) {
            doc.addPage();
            yPos = 20;
          }
          doc.text(line, margin + 5, yPos);
          yPos += 6;
        });
        
        yPos += 6;
      }
      
      // Dados do prescritor (rodapé)
      if (yPos > 230) {
        doc.addPage();
        yPos = 20;
      }
      
      yPos += 10;
      doc.setDrawColor(200, 200, 200);
      doc.line(margin, yPos, pageWidth - margin, yPos);
      yPos += 10;
      
      if (selectedPrescritor) {
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        
        let prescritorNome = '';
        if (selectedPrescritor.titulo && selectedPrescritor.mostrar?.titulo) {
          prescritorNome += `${selectedPrescritor.titulo} `;
        }
        prescritorNome += selectedPrescritor.nome;
        
        doc.text(prescritorNome, margin, yPos);
        yPos += 6;
        
        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');
        
        if (selectedPrescritor.especialidade && selectedPrescritor.mostrar?.especialidade) {
          doc.text(selectedPrescritor.especialidade, margin, yPos);
          yPos += 5;
        }
        
        if (selectedPrescritor.crm && selectedPrescritor.mostrar?.crm) {
          let crm = `CRM: ${selectedPrescritor.crm}`;
          if (selectedPrescritor.uf_crm) {
            crm += `-${selectedPrescritor.uf_crm}`;
          }
          doc.text(crm, margin, yPos);
          yPos += 5;
        }
        
        if (selectedPrescritor.crn && selectedPrescritor.mostrar?.crn) {
          doc.text(`CRN: ${selectedPrescritor.crn}`, margin, yPos);
          yPos += 5;
        }
        
        if (selectedPrescritor.telefone && selectedPrescritor.mostrar?.telefone) {
          doc.text(`Tel: ${selectedPrescritor.telefone}`, margin, yPos);
          yPos += 5;
        }
        
        if (selectedPrescritor.email && selectedPrescritor.mostrar?.email) {
          doc.text(`Email: ${selectedPrescritor.email}`, margin, yPos);
          yPos += 5;
        }
        
        if (selectedPrescritor.endereco && selectedPrescritor.mostrar?.endereco) {
          let endereco = selectedPrescritor.endereco;
          if (selectedPrescritor.cidade) endereco += `, ${selectedPrescritor.cidade}`;
          if (selectedPrescritor.uf) endereco += ` - ${selectedPrescritor.uf}`;
          if (selectedPrescritor.cep) endereco += ` - CEP: ${selectedPrescritor.cep}`;
          
          const enderecoLines = doc.splitTextToSize(endereco, contentWidth);
          enderecoLines.forEach(line => {
            doc.text(line, margin, yPos);
            yPos += 5;
          });
        }
        
        yPos += 10;
        doc.setFontSize(9);
        doc.text('Assinatura: ___________________________________________', margin, yPos);
      } else {
        doc.setFontSize(10);
        doc.text('Prescritor: ___________________________________________', margin, yPos);
        yPos += 8;
        doc.text('CRM/CRN: _________________  Assinatura: ______________', margin, yPos);
      }
      
      // Salvar PDF
      doc.save(`prescricao_${new Date().toISOString().split('T')[0]}.pdf`);
      
    } catch (error) {
      alert('❌ Erro ao gerar PDF. Verifique se o jsPDF está carregado.\n\nErro: ' + error.message);
      console.error('Erro ao gerar PDF:', error);
    }
  };
  
  // Gerar TXT ASCII puro (compatível com Tribe MD / Bipp Assistant)
  const generateSafeTxtPrescription = () => {
    if (prescription.length === 0) {
      alert('Adicione substâncias à prescrição antes de exportar.');
      return;
    }
    
    const date = new Date().toLocaleDateString('pt-BR');
    const viaLabel = viasUso.find(v => v.value === magistralConfig.via)?.label || '';
    const formaLabel = formasFarmaceuticas.find(f => f.value === magistralConfig.formaFarmaceutica)?.label || '';
    const excipienteLabel = excipientes.find(e => e.value === magistralConfig.excipiente)?.label || '';
    const qspLabel = qspOpcoes.find(q => q.value === magistralConfig.qsp)?.label || '';
    
    let text = '';
    
    // Cabeçalho ASCII puro
    text += '========================================================\r\n';
    text += '            PRESCRICAO MAGISTRAL\r\n';
    text += '========================================================\r\n\r\n';
    
    // Dados do paciente
    if (patientInfo.name) {
      text += `Paciente: ${patientInfo.name}\r\n`;
      if (patientInfo.age) text += `Idade: ${patientInfo.age} anos`;
      if (patientInfo.weight) text += ` | Peso: ${patientInfo.weight} kg`;
      if (patientInfo.age || patientInfo.weight) text += '\r\n';
      text += '\r\n';
    }
    
    text += `Data: ${date}\r\n`;
    text += `Via de Administracao: ${viaLabel}\r\n`;
    text += `Forma Farmaceutica: ${formaLabel}\r\n\r\n`;
    
    // Separador
    text += '--------------------------------------------------------\r\n';
    text += 'FORMULA:\r\n';
    text += '--------------------------------------------------------\r\n\r\n';
    
    // Lista de componentes
    prescription.forEach((item, index) => {
      let displayName = item.name;
      if (item.selectedLigante) {
        displayName = `${item.name} (${item.selectedLigante})`;
      }
      text += `${index + 1}. ${displayName}\r\n`;
      text += `   ${item.customDosage}\r\n`;
      text += '\r\n';
    });
    
    // Excipiente e QSP
    if (magistralConfig.excipiente !== 'criterio_farmacia') {
      text += `Excipiente: ${excipienteLabel}\r\n`;
    }
    text += `QSP: ${qspLabel}\r\n\r\n`;
    
    // Manipular
    text += '--------------------------------------------------------\r\n';
    text += 'MANIPULAR:\r\n';
    text += `Quantidade: ${magistralConfig.quantidade} unidades\r\n\r\n`;
    
    // Posologia
    text += '--------------------------------------------------------\r\n';
    text += 'POSOLOGIA:\r\n';
    text += `${magistralConfig.posologia}\r\n\r\n`;
    
    // Observações
    if (magistralConfig.observacoes) {
      text += '--------------------------------------------------------\r\n';
      text += 'OBSERVACOES:\r\n';
      text += `${magistralConfig.observacoes}\r\n\r\n`;
    }
    
    text += '========================================================\r\n\r\n';
    
    // Dados do prescritor
    if (selectedPrescritor) {
      if (selectedPrescritor.titulo && selectedPrescritor.mostrar?.titulo) {
        text += `${selectedPrescritor.titulo} `;
      }
      text += `${selectedPrescritor.nome}\r\n`;
      
      if (selectedPrescritor.especialidade && selectedPrescritor.mostrar?.especialidade) {
        text += `${selectedPrescritor.especialidade}\r\n`;
      }
      
      if (selectedPrescritor.crm && selectedPrescritor.mostrar?.crm) {
        text += `CRM: ${selectedPrescritor.crm}`;
        if (selectedPrescritor.uf_crm) {
          text += `-${selectedPrescritor.uf_crm}`;
        }
        text += '\r\n';
      }
      
      if (selectedPrescritor.crn && selectedPrescritor.mostrar?.crn) {
        text += `CRN: ${selectedPrescritor.crn}\r\n`;
      }
      
      if (selectedPrescritor.telefone && selectedPrescritor.mostrar?.telefone) {
        text += `Telefone: ${selectedPrescritor.telefone}\r\n`;
      }
      
      if (selectedPrescritor.email && selectedPrescritor.mostrar?.email) {
        text += `Email: ${selectedPrescritor.email}\r\n`;
      }
      
      if (selectedPrescritor.endereco && selectedPrescritor.mostrar?.endereco) {
        text += `${selectedPrescritor.endereco}`;
        if (selectedPrescritor.cidade) {
          text += `, ${selectedPrescritor.cidade}`;
        }
        if (selectedPrescritor.uf) {
          text += ` - ${selectedPrescritor.uf}`;
        }
        if (selectedPrescritor.cep) {
          text += ` - CEP: ${selectedPrescritor.cep}`;
        }
        text += '\r\n';
      }
      
      text += '\r\nAssinatura: ______________________________________\r\n';
    } else {
      text += 'Prescritor: ______________________________________\r\n';
      text += 'CRM/CRN: ________________  Assinatura: __________\r\n';
    }
    
    // Criar e baixar arquivo TXT
    const blob = new Blob([text], { type: 'text/plain;charset=windows-1252' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prescricao_${new Date().toISOString().split('T')[0]}.txt`;
    
    document.body.appendChild(a);
    a.click();
    
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
  };
  
  // Gerar download - SEMPRE usa formato magistral (com Unicode) - MANTIDO PARA COMPATIBILIDADE
  const generatePrescriptionPDF = () => {
    // Usar SEMPRE a função magistral (mesmo formato da prévia)
    const formulas = generateMagistralFormula();
    
    if (!formulas || formulas.length === 0) {
      alert('Adicione substâncias à prescrição antes de baixar.');
      return;
    }
    
    // Concatenar todas as fórmulas
    let text = '';
    formulas.forEach((formulaObj, index) => {
      text += formulaObj.formula;
      
      // Adicionar separação entre fórmulas (se houver mais de uma)
      if (index < formulas.length - 1) {
        text += '\n\n\n';
        text += '═══════════════════════════════════════════════════════\n';
        text += '═══════════════════════════════════════════════════════\n\n\n';
      }
    });
    
    // Criar e baixar arquivo
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prescricao_magistral_${new Date().toISOString().split('T')[0]}.txt`;
    
    document.body.appendChild(a);
    a.click();
    
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
  };
  
  // Funções de Backup
  const exportarDados = () => {
    try {
      const backup = {};
      let totalItens = 0;
      
      // Coletar todos os dados do localStorage
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        backup[key] = localStorage.getItem(key);
        totalItens++;
      }
      
      if (totalItens === 0) {
        setBackupMessage({
          tipo: 'erro',
          texto: '⚠️ Nenhum dado encontrado para exportar!'
        });
        return;
      }
      
      // Criar arquivo JSON
      const backupCompleto = {
        versao: '1.0',
        data: new Date().toISOString(),
        sistema: 'Sistema de Prescrição Nutracêutica',
        totalItens: totalItens,
        dados: backup
      };
      
      const blob = new Blob([JSON.stringify(backupCompleto, null, 2)], {
        type: 'application/json'
      });
      
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup-nutraceuticos-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      setBackupMessage({
        tipo: 'sucesso',
        texto: `✅ Backup exportado com sucesso!\n${totalItens} itens salvos no arquivo.\n\nGuarde este arquivo em local seguro!`
      });
      
      setTimeout(() => setBackupMessage(null), 5000);
      
    } catch (error) {
      setBackupMessage({
        tipo: 'erro',
        texto: `❌ Erro ao exportar dados: ${error.message}`
      });
    }
  };
  
  const importarDados = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      
      reader.onload = function(event) {
        try {
          const backupCompleto = JSON.parse(event.target.result);
          const backup = backupCompleto.dados || backupCompleto;
          
          const totalItens = Object.keys(backup).length;
          
          if (!confirm(
            `⚠️ ATENÇÃO!\n\n` +
            `Isto irá SUBSTITUIR todos os dados atuais!\n\n` +
            `Backup contém: ${totalItens} itens\n` +
            `Data do backup: ${backupCompleto.data ? new Date(backupCompleto.data).toLocaleString('pt-BR') : 'Desconhecida'}\n\n` +
            `Deseja continuar?`
          )) {
            return;
          }
          
          // Limpar localStorage atual
          localStorage.clear();
          
          // Restaurar dados do backup
          let restaurados = 0;
          for (let key in backup) {
            localStorage.setItem(key, backup[key]);
            restaurados++;
          }
          
          setBackupMessage({
            tipo: 'sucesso',
            texto: `✅ Dados restaurados com sucesso!\n${restaurados} itens importados.\n\nA página será recarregada...`
          });
          
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          
        } catch (error) {
          setBackupMessage({
            tipo: 'erro',
            texto: `❌ Erro ao importar dados: ${error.message}\nVerifique se o arquivo é um backup válido.`
          });
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-teal-50 via-blue-50 to-purple-50 p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-2xl shadow-lg p-8 mb-6">
          <div className="flex justify-between items-start mb-4">
            <div>
              <h1 className="text-4xl font-bold text-gray-800 mb-2">
                Sistema de Prescrição - Vitaminas, Minerais e Nutracêuticos
              </h1>
              <p className="text-gray-600 text-lg mb-2">
                Psiquiatria Nutricional Baseada em Evidências - ILSI Brasil
              </p>
              <p className="text-sm text-gray-500">
                Referências: DRIs (Dietary Reference Intakes) - IOM/NASEM 2023
              </p>
            </div>
            <div className="flex gap-3">
              <button
                onClick={() => setShowClinicalLibrary(!showClinicalLibrary)}
                className={`px-6 py-3 rounded-xl transition-colors shadow-lg flex items-center gap-2 font-semibold ${
                  showClinicalLibrary
                    ? 'bg-purple-700 text-white ring-4 ring-purple-300'
                    : 'bg-purple-600 text-white hover:bg-purple-700'
                }`}
              >
                <FileText size={20} />
                {showClinicalLibrary ? '✓ ' : ''}Fórmulas Clínicas
              </button>
              <button
                onClick={() => setShowCustomFormulas(!showCustomFormulas)}
                className={`px-6 py-3 rounded-xl transition-colors shadow-lg flex items-center gap-2 font-semibold ${
                  showCustomFormulas
                    ? 'bg-blue-700 text-white ring-4 ring-blue-300'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                <Plus size={20} />
                {showCustomFormulas ? '✓ ' : ''}Minhas Fórmulas ({customFormulas.length})
              </button>
              <button
                onClick={() => setShowPrescritorManager(!showPrescritorManager)}
                className={`px-6 py-3 rounded-xl transition-colors shadow-lg flex items-center gap-2 font-semibold ${
                  showPrescritorManager
                    ? 'bg-emerald-700 text-white ring-4 ring-emerald-300'
                    : 'bg-emerald-600 text-white hover:bg-emerald-700'
                }`}
              >
                <Settings size={20} />
                {showPrescritorManager ? '✓ ' : ''}Prescritores ({prescritores.length})
              </button>
              <button
                onClick={() => setShowHistory(!showHistory)}
                className={`px-6 py-3 rounded-xl transition-colors shadow-lg flex items-center gap-2 font-semibold ${
                  showHistory
                    ? 'bg-teal-700 text-white ring-4 ring-teal-300'
                    : 'bg-teal-600 text-white hover:bg-teal-700'
                }`}
              >
                <FileText size={20} />
                {showHistory ? '✓ ' : ''}Histórico ({prescriptionHistory.length})
              </button>
              <button
                onClick={() => setShowBackupMenu(!showBackupMenu)}
                className={`px-6 py-3 rounded-xl transition-colors shadow-lg flex items-center gap-2 font-semibold ${
                  showBackupMenu
                    ? 'bg-amber-700 text-white ring-4 ring-amber-300'
                    : 'bg-amber-600 text-white hover:bg-amber-700'
                }`}
                title="Backup e Restauração"
              >
                <Download size={20} />
                {showBackupMenu ? '✓ ' : ''}Backup
              </button>
            </div>
          </div>
        </div>

        {/* MENU DE BACKUP */}
        {showBackupMenu && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <Download size={24} className="text-amber-600" />
                Backup e Restauração de Dados
              </h2>
              <button
                onClick={() => setShowBackupMenu(false)}
                className="text-gray-500 hover:text-gray-700 text-2xl font-bold"
              >
                ×
              </button>
            </div>
            
            {backupMessage && (
              <div className={`mb-4 p-4 rounded-lg ${
                backupMessage.tipo === 'sucesso' 
                  ? 'bg-green-50 border-2 border-green-200 text-green-800' 
                  : 'bg-red-50 border-2 border-red-200 text-red-800'
              }`}>
                <p className="whitespace-pre-line font-semibold">{backupMessage.texto}</p>
              </div>
            )}
            
            <div className="grid md:grid-cols-2 gap-6">
              {/* Exportar Dados */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border-2 border-blue-200">
                <div className="flex items-center gap-3 mb-4">
                  <div className="bg-blue-600 text-white p-3 rounded-lg">
                    <Download size={28} />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-gray-800">Fazer Backup</h3>
                    <p className="text-sm text-gray-600">Exportar dados</p>
                  </div>
                </div>
                <p className="text-gray-700 mb-4 text-sm leading-relaxed">
                  Salve todos os seus dados em um arquivo .json. Guarde este arquivo em local seguro (Google Drive, Pen Drive, etc).
                </p>
                <button
                  onClick={exportarDados}
                  className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2"
                >
                  <Download size={20} />
                  Exportar Dados Agora
                </button>
                <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                  <p className="text-xs text-yellow-800">
                    <strong>💡 Dica:</strong> Faça backup regularmente! Recomendamos fazer backup ao final de cada dia de trabalho.
                  </p>
                </div>
              </div>
              
              {/* Importar Dados */}
              <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border-2 border-green-200">
                <div className="flex items-center gap-3 mb-4">
                  <div className="bg-green-600 text-white p-3 rounded-lg">
                    <FileText size={28} />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-gray-800">Restaurar Backup</h3>
                    <p className="text-sm text-gray-600">Importar dados</p>
                  </div>
                </div>
                <p className="text-gray-700 mb-4 text-sm leading-relaxed">
                  Restaure seus dados a partir de um arquivo de backup .json anterior. Isso substituirá todos os dados atuais.
                </p>
                <button
                  onClick={importarDados}
                  className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2"
                >
                  <FileText size={20} />
                  Selecionar Arquivo de Backup
                </button>
                <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                  <p className="text-xs text-red-800">
                    <strong>⚠️ Atenção:</strong> Importar dados irá SUBSTITUIR todos os dados atuais. Faça backup antes se necessário!
                  </p>
                </div>
              </div>
            </div>
            
            {/* Informações Adicionais */}
            <div className="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
              <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
                <Info size={18} className="text-blue-600" />
                Sobre o Backup
              </h4>
              <div className="text-sm text-gray-700 space-y-2">
                <p><strong>O que é salvo:</strong> Prescrições, fórmulas favoritas, prescritores, histórico e todas configurações.</p>
                <p><strong>Onde guardar:</strong> Google Drive (recomendado), Pen Drive, HD Externo ou nuvem.</p>
                <p><strong>Frequência:</strong> Diário (fim do dia) ou antes de qualquer mudança importante.</p>
                <p><strong>Formato:</strong> Arquivo .json que pode ser aberto em qualquer editor de texto.</p>
              </div>
            </div>
          </div>
        )}

        {/* GERENCIADOR DE PRESCRITORES */}
        {showPrescritorManager && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <Settings size={28} className="text-emerald-600" />
                Gerenciar Prescritores
              </h2>
              <button
                onClick={() => {
                  setShowPrescritorManager(false);
                  setShowPrescritorForm(false);
                  setEditingPrescritor(null);
                }}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-semibold"
              >
                Fechar
              </button>
            </div>

            {/* Botão novo prescritor */}
            <div className="mb-6">
              <button
                onClick={() => {
                  setShowPrescritorForm(!showPrescritorForm);
                  if (!showPrescritorForm) {
                    setEditingPrescritor(null);
                    setPrescritorForm({
                      nome: '',
                      titulo: '',
                      especialidade: '',
                      crm: '',
                      uf_crm: '',
                      crn: '',
                      cpf: '',
                      telefone: '',
                      email: '',
                      endereco: '',
                      cidade: '',
                      uf: '',
                      cep: '',
                      mostrar: {
                        titulo: true,
                        especialidade: true,
                        crm: true,
                        crn: false,
                        cpf: false,
                        telefone: true,
                        email: true,
                        endereco: true
                      }
                    });
                  }
                }}
                className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2 font-semibold"
              >
                <Plus size={18} />
                {showPrescritorForm ? 'Cancelar' : 'Novo Prescritor'}
              </button>
            </div>

            {/* Formulário de cadastro */}
            {showPrescritorForm && (
              <div className="bg-emerald-50 border-2 border-emerald-300 rounded-xl p-6 mb-6">
                <h3 className="text-xl font-bold text-emerald-900 mb-4">
                  {editingPrescritor ? 'Editar Prescritor' : 'Cadastrar Novo Prescritor'}
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Nome Completo *</label>
                    <input
                      type="text"
                      value={prescritorForm.nome}
                      onChange={(e) => setPrescritorForm({...prescritorForm, nome: e.target.value})}
                      placeholder="Ex: João Silva"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Título</label>
                    <input
                      type="text"
                      value={prescritorForm.titulo}
                      onChange={(e) => setPrescritorForm({...prescritorForm, titulo: e.target.value})}
                      placeholder="Ex: Dr., Dra., Nutricionista"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Especialidade</label>
                    <input
                      type="text"
                      value={prescritorForm.especialidade}
                      onChange={(e) => setPrescritorForm({...prescritorForm, especialidade: e.target.value})}
                      placeholder="Ex: Psiquiatra, Nutricionista Clínica"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">CRM</label>
                    <input
                      type="text"
                      value={prescritorForm.crm}
                      onChange={(e) => setPrescritorForm({...prescritorForm, crm: e.target.value})}
                      placeholder="Ex: 123456"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">UF do CRM</label>
                    <input
                      type="text"
                      value={prescritorForm.uf_crm}
                      onChange={(e) => setPrescritorForm({...prescritorForm, uf_crm: e.target.value})}
                      placeholder="Ex: SP"
                      maxLength="2"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">CRN</label>
                    <input
                      type="text"
                      value={prescritorForm.crn}
                      onChange={(e) => setPrescritorForm({...prescritorForm, crn: e.target.value})}
                      placeholder="Ex: 12345"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">CPF</label>
                    <input
                      type="text"
                      value={prescritorForm.cpf}
                      onChange={(e) => setPrescritorForm({...prescritorForm, cpf: e.target.value})}
                      placeholder="Ex: 000.000.000-00"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Telefone</label>
                    <input
                      type="text"
                      value={prescritorForm.telefone}
                      onChange={(e) => setPrescritorForm({...prescritorForm, telefone: e.target.value})}
                      placeholder="Ex: (11) 99999-9999"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Email</label>
                    <input
                      type="email"
                      value={prescritorForm.email}
                      onChange={(e) => setPrescritorForm({...prescritorForm, email: e.target.value})}
                      placeholder="Ex: joao@email.com"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Endereço</label>
                    <input
                      type="text"
                      value={prescritorForm.endereco}
                      onChange={(e) => setPrescritorForm({...prescritorForm, endereco: e.target.value})}
                      placeholder="Ex: Rua das Flores, 123, Sala 45"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">Cidade</label>
                    <input
                      type="text"
                      value={prescritorForm.cidade}
                      onChange={(e) => setPrescritorForm({...prescritorForm, cidade: e.target.value})}
                      placeholder="Ex: São Paulo"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">UF</label>
                    <input
                      type="text"
                      value={prescritorForm.uf}
                      onChange={(e) => setPrescritorForm({...prescritorForm, uf: e.target.value})}
                      placeholder="Ex: SP"
                      maxLength="2"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-emerald-900 mb-2">CEP</label>
                    <input
                      type="text"
                      value={prescritorForm.cep}
                      onChange={(e) => setPrescritorForm({...prescritorForm, cep: e.target.value})}
                      placeholder="Ex: 01234-567"
                      className="w-full px-4 py-2 border-2 border-emerald-300 rounded-lg focus:ring-2 focus:ring-emerald-500"
                    />
                  </div>
                </div>

                {/* Opções de exibição */}
                <div className="bg-white rounded-lg p-4 border-2 border-emerald-300 mb-4">
                  <h4 className="font-bold text-gray-800 mb-3">Dados a Exibir na Receita:</h4>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.titulo}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, titulo: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">Título</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.especialidade}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, especialidade: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">Especialidade</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.crm}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, crm: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">CRM</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.crn}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, crn: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">CRN</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.cpf}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, cpf: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">CPF</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.telefone}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, telefone: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">Telefone</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.email}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, email: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">Email</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={prescritorForm.mostrar.endereco}
                        onChange={(e) => setPrescritorForm({
                          ...prescritorForm,
                          mostrar: {...prescritorForm.mostrar, endereco: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <span className="text-sm">Endereço</span>
                    </label>
                  </div>
                </div>

                <button
                  onClick={savePrescritor}
                  className="w-full px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white rounded-lg hover:from-emerald-700 hover:to-green-700 transition-all shadow-lg font-bold"
                >
                  {editingPrescritor ? 'Atualizar Prescritor' : 'Salvar Prescritor'}
                </button>
              </div>
            )}

            {/* Lista de prescritores */}
            <div className="space-y-4">
              {prescritores.length === 0 ? (
                <div className="text-center py-12 text-gray-500">
                  <Settings size={48} className="mx-auto mb-4 opacity-50" />
                  <p className="text-lg">Nenhum prescritor cadastrado</p>
                  <p className="text-sm">Clique em "Novo Prescritor" para começar</p>
                </div>
              ) : (
                prescritores.map((prescritor) => (
                  <div key={prescritor.id} className={`rounded-xl p-6 border-2 ${selectedPrescritor && selectedPrescritor.id === prescritor.id ? 'bg-emerald-50 border-emerald-400' : 'bg-gray-50 border-gray-200'}`}>
                    <div className="flex justify-between items-start mb-4">
                      <div className="flex-1">
                        <h4 className="text-xl font-bold text-gray-800 mb-1">
                          {prescritor.titulo && `${prescritor.titulo} `}{prescritor.nome}
                        </h4>
                        {prescritor.especialidade && (
                          <p className="text-sm text-gray-600 mb-2">{prescritor.especialidade}</p>
                        )}
                        <div className="text-sm text-gray-700 space-y-1">
                          {prescritor.crm && <p>CRM: {prescritor.crm}{prescritor.uf_crm && `/${prescritor.uf_crm}`}</p>}
                          {prescritor.crn && <p>CRN: {prescritor.crn}</p>}
                          {prescritor.telefone && <p>Tel: {prescritor.telefone}</p>}
                          {prescritor.email && <p>Email: {prescritor.email}</p>}
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => selectPrescritor(prescritor)}
                          className={`px-4 py-2 rounded-lg transition-colors font-semibold ${selectedPrescritor && selectedPrescritor.id === prescritor.id ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                        >
                          {selectedPrescritor && selectedPrescritor.id === prescritor.id ? '✓ Selecionado' : 'Selecionar'}
                        </button>
                        <button
                          onClick={() => editPrescritor(prescritor)}
                          className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                          title="Editar"
                        >
                          <Settings size={18} />
                        </button>
                        <button
                          onClick={() => deletePrescritor(prescritor.id)}
                          className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                          title="Deletar"
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                    </div>
                    {selectedPrescritor && selectedPrescritor.id === prescritor.id && (
                      <div className="mt-4 pt-4 border-t border-emerald-300">
                        <p className="text-sm font-semibold text-emerald-800 mb-2">Dados que aparecerão na receita:</p>
                        <div className="bg-white rounded p-3 text-sm text-gray-700 whitespace-pre-line border border-emerald-200">
                          {formatPrescritorInfo()}
                        </div>
                      </div>
                    )}
                  </div>
                ))
              )}
            </div>
          </div>
        )}

        {/* MINHAS FÓRMULAS PERSONALIZADAS */}
        {showCustomFormulas && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <Plus size={28} className="text-blue-600" />
                Minhas Fórmulas Personalizadas ({customFormulas.length})
              </h2>
              <button
                onClick={() => {
                  setShowCustomFormulas(false);
                  setShowCustomFormulaForm(false);
                  setEditingCustomFormula(null);
                }}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-semibold"
              >
                Fechar
              </button>
            </div>

            {/* Botões de ação */}
            <div className="flex gap-3 mb-6">
              <button
                onClick={() => {
                  setShowCustomFormulaForm(!showCustomFormulaForm);
                  if (!showCustomFormulaForm) {
                    setEditingCustomFormula(null);
                    setCustomFormulaForm({
                      nome: '',
                      categoria: '',
                      indicacao: '',
                      via: 'oral',
                      ativos: [],
                      excipiente: 'celulose_microcristalina',
                      qsp: '1_capsula',
                      quantidade: 30,
                      posologia: '',
                      observacoes: ''
                    });
                  }
                }}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-semibold"
              >
                <Plus size={18} />
                {showCustomFormulaForm ? 'Cancelar' : 'Nova Fórmula'}
              </button>
              <button
                onClick={exportCustomFormulas}
                disabled={customFormulas.length === 0}
                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"
              >
                <Download size={18} />
                Exportar
              </button>
              <label className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer flex items-center gap-2">
                <FileText size={18} />
                Importar
                <input
                  type="file"
                  accept=".json"
                  onChange={importCustomFormulas}
                  className="hidden"
                />
              </label>
              <button
                onClick={clearCustomFormulas}
                disabled={customFormulas.length === 0}
                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"
              >
                <Trash2 size={18} />
                Limpar Tudo
              </button>
            </div>

            {/* Formulário de cadastro */}
            {showCustomFormulaForm && (
              <div className="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-6">
                <h3 className="text-xl font-bold text-blue-900 mb-4">
                  {editingCustomFormula ? 'Editar Fórmula' : 'Cadastrar Nova Fórmula'}
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Nome da Fórmula *</label>
                    <input
                      type="text"
                      value={customFormulaForm.nome}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, nome: e.target.value})}
                      placeholder="Ex: Protocolo Personalizado Ansiedade"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Categoria</label>
                    <input
                      type="text"
                      value={customFormulaForm.categoria}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, categoria: e.target.value})}
                      placeholder="Ex: Ansiedade, Sono, Foco..."
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Indicação</label>
                    <input
                      type="text"
                      value={customFormulaForm.indicacao}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, indicacao: e.target.value})}
                      placeholder="Ex: TAG, insônia crônica, déficit de atenção..."
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Via de Administração</label>
                    <select
                      value={customFormulaForm.via}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, via: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="oral">Oral</option>
                      <option value="sublingual">Sublingual</option>
                      <option value="topica">Tópica</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Excipiente</label>
                    <select
                      value={customFormulaForm.excipiente}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, excipiente: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      {excipientes.map(exc => (
                        <option key={exc.value} value={exc.value}>{exc.label}</option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">QSP</label>
                    <select
                      value={customFormulaForm.qsp}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, qsp: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="1_capsula">1 cápsula</option>
                      <option value="1_dose">1 dose</option>
                      <option value="1ml">1 ml</option>
                      <option value="1g">1 g</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Quantidade</label>
                    <input
                      type="number"
                      value={customFormulaForm.quantidade}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, quantidade: parseInt(e.target.value)})}
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Posologia</label>
                    <input
                      type="text"
                      value={customFormulaForm.posologia}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, posologia: e.target.value})}
                      placeholder="Ex: Tomar 1 cápsula pela manhã e 1 à noite"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-blue-900 mb-2">Observações Clínicas</label>
                    <textarea
                      value={customFormulaForm.observacoes}
                      onChange={(e) => setCustomFormulaForm({...customFormulaForm, observacoes: e.target.value})}
                      placeholder="Ex: Avaliar resposta em 2-4 semanas..."
                      rows="3"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                </div>

                {/* Ativos */}
                <div className="bg-white rounded-lg p-4 border-2 border-blue-300 mb-4">
                  <h4 className="font-bold text-gray-800 mb-3">Ativos da Fórmula *</h4>
                  
                  {/* Lista de ativos adicionados */}
                  {customFormulaForm.ativos.length > 0 && (
                    <div className="mb-4 space-y-2">
                      {customFormulaForm.ativos.map((ativo, idx) => (
                        <div key={idx} className="flex justify-between items-center bg-blue-50 p-3 rounded-lg">
                          <div className="flex-1">
                            <p className="font-semibold text-gray-800">{ativo.substancia}</p>
                            <p className="text-sm text-gray-600">
                              {ativo.ligante && `${ativo.ligante} • `}{ativo.dose} • {ativo.horario}
                            </p>
                          </div>
                          <button
                            onClick={() => removeAtivoFromCustomFormula(idx)}
                            className="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                  
                  {/* Adicionar novo ativo */}
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input
                      type="text"
                      value={tempAtivo.substancia}
                      onChange={(e) => setTempAtivo({...tempAtivo, substancia: e.target.value})}
                      placeholder="Substância *"
                      className="px-3 py-2 border border-blue-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempAtivo.ligante}
                      onChange={(e) => setTempAtivo({...tempAtivo, ligante: e.target.value})}
                      placeholder="Ligante (opcional)"
                      className="px-3 py-2 border border-blue-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempAtivo.dose}
                      onChange={(e) => setTempAtivo({...tempAtivo, dose: e.target.value})}
                      placeholder="Dose *"
                      className="px-3 py-2 border border-blue-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempAtivo.horario}
                      onChange={(e) => setTempAtivo({...tempAtivo, horario: e.target.value})}
                      placeholder="Horário *"
                      className="px-3 py-2 border border-blue-300 rounded-lg"
                    />
                  </div>
                  <button
                    onClick={addAtivoToCustomFormula}
                    className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
                  >
                    <Plus size={18} />
                    Adicionar Ativo
                  </button>
                </div>

                {/* Botão salvar */}
                <button
                  onClick={saveCustomFormula}
                  className="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg font-bold"
                >
                  {editingCustomFormula ? 'Atualizar Fórmula' : 'Salvar Fórmula'}
                </button>
              </div>
            )}

            {/* Busca */}
            <div className="mb-4">
              <input
                type="text"
                placeholder="Buscar fórmula pelo nome..."
                value={customFormulaSearchTerm}
                onChange={(e) => setCustomFormulaSearchTerm(e.target.value)}
                className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>

            {/* Lista de fórmulas */}
            <div className="space-y-4">
              {customFormulas.length === 0 ? (
                <div className="text-center py-12 text-gray-500">
                  <Plus size={48} className="mx-auto mb-4 opacity-50" />
                  <p className="text-lg">Nenhuma fórmula personalizada ainda</p>
                  <p className="text-sm">Clique em "Nova Fórmula" para começar</p>
                </div>
              ) : (
                customFormulas
                  .filter(formula => 
                    !customFormulaSearchTerm || 
                    formula.nome.toLowerCase().includes(customFormulaSearchTerm.toLowerCase()) ||
                    (formula.categoria && formula.categoria.toLowerCase().includes(customFormulaSearchTerm.toLowerCase()))
                  )
                  .map((formula) => (
                    <div key={formula.id} className="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6">
                      <div className="flex justify-between items-start mb-4">
                        <div className="flex-1">
                          <h4 className="text-xl font-bold text-gray-800 mb-1">{formula.nome}</h4>
                          {formula.categoria && (
                            <span className="inline-block px-3 py-1 bg-blue-200 text-blue-800 rounded-full text-sm font-medium mr-2">
                              {formula.categoria}
                            </span>
                          )}
                          {formula.indicacao && (
                            <p className="text-sm text-gray-600 mt-2">
                              <strong>Indicação:</strong> {formula.indicacao}
                            </p>
                          )}
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => importCustomFormula(formula)}
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2"
                            title="Importar para prescrição"
                          >
                            <Download size={18} />
                            Importar
                          </button>
                          <button
                            onClick={() => editCustomFormula(formula)}
                            className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                            title="Editar"
                          >
                            <Settings size={18} />
                          </button>
                          <button
                            onClick={() => deleteCustomFormula(formula.id)}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                            title="Deletar"
                          >
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </div>

                      {/* Detalhes da fórmula */}
                      <div className="bg-white rounded-lg p-4 border border-blue-200">
                        <h5 className="font-bold text-gray-800 mb-3">Ativos ({formula.ativos.length}):</h5>
                        <div className="space-y-2">
                          {formula.ativos.map((ativo, idx) => (
                            <div key={idx} className="flex justify-between items-start py-2 border-b border-gray-200 last:border-0">
                              <div className="flex-1">
                                <p className="font-semibold text-gray-800">{ativo.substancia}</p>
                                {ativo.ligante && (
                                  <p className="text-sm text-gray-600">Ligante: {ativo.ligante}</p>
                                )}
                              </div>
                              <div className="text-right">
                                <p className="font-medium text-blue-800">{ativo.dose}</p>
                                <p className="text-sm text-gray-600">{ativo.horario}</p>
                              </div>
                            </div>
                          ))}
                        </div>
                        
                        <div className="mt-4 pt-4 border-t border-gray-200 grid grid-cols-2 gap-4 text-sm">
                          <div>
                            <p className="text-gray-600">Via:</p>
                            <p className="font-medium">{formula.via.charAt(0).toUpperCase() + formula.via.slice(1)}</p>
                          </div>
                          <div>
                            <p className="text-gray-600">Excipiente:</p>
                            <p className="font-medium">{excipientes.find(e => e.value === formula.excipiente)?.label}</p>
                          </div>
                          <div>
                            <p className="text-gray-600">Quantidade:</p>
                            <p className="font-medium">{formula.quantidade} unidades</p>
                          </div>
                          <div>
                            <p className="text-gray-600">Posologia:</p>
                            <p className="font-medium">{formula.posologia}</p>
                          </div>
                        </div>
                        
                        {formula.observacoes && (
                          <div className="mt-4 pt-4 border-t border-gray-200">
                            <p className="text-gray-600 text-sm mb-1">Observações:</p>
                            <p className="text-gray-800 text-sm">{formula.observacoes}</p>
                          </div>
                        )}
                      </div>
                    </div>
                  ))
              )}
            </div>
          </div>
        )}

        {/* BIBLIOTECA DE FÓRMULAS CLÍNICAS */}
        {showClinicalLibrary && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <FileText size={28} className="text-purple-600" />
                Biblioteca de Fórmulas Clínicas
              </h2>
              <button
                onClick={() => {
                  setShowClinicalLibrary(false);
                  setSelectedClinicalCategory('');
                  setSelectedClinicalFormula(null);
                  setShowClinicalFormulaForm(false);
                  setEditingClinicalFormula(null);
                }}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-semibold"
              >
                Fechar
              </button>
            </div>

            {/* Botões de ação */}
            <div className="flex gap-3 mb-6">
              <button
                onClick={() => {
                  setShowClinicalFormulaForm(!showClinicalFormulaForm);
                  if (!showClinicalFormulaForm) {
                    setEditingClinicalFormula(null);
                    setSelectedClinicalCategory('');
                    setSelectedClinicalFormula(null);
                    setClinicalFormulaForm({
                      nome: '',
                      categoria: '',
                      subcategoria: '',
                      indicacao: '',
                      via: 'oral',
                      ativos: [],
                      excipiente: 'celulose_microcristalina',
                      qsp: '1_capsula',
                      quantidade: 30,
                      posologia: '',
                      observacoes: ''
                    });
                  }
                }}
                className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2 font-semibold"
              >
                <Plus size={18} />
                {showClinicalFormulaForm ? 'Cancelar' : 'Nova Fórmula'}
              </button>
              <button
                onClick={resetClinicalLibrary}
                className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2"
              >
                <Settings size={18} />
                Resetar ao Padrão
              </button>
            </div>

            {/* Formulário de cadastro/edição */}
            {showClinicalFormulaForm && (
              <div className="bg-purple-50 border-2 border-purple-300 rounded-xl p-6 mb-6">
                <h3 className="text-xl font-bold text-purple-900 mb-4">
                  {editingClinicalFormula ? 'Editar Fórmula' : 'Cadastrar Nova Fórmula'}
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Nome da Fórmula *</label>
                    <input
                      type="text"
                      value={clinicalFormulaForm.nome}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, nome: e.target.value})}
                      placeholder="Ex: Protocolo Ansiedade Avançado"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Categoria *</label>
                    <input
                      type="text"
                      value={clinicalFormulaForm.categoria}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, categoria: e.target.value})}
                      placeholder="Ex: saude-mental"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Subcategoria *</label>
                    <input
                      type="text"
                      value={clinicalFormulaForm.subcategoria}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, subcategoria: e.target.value})}
                      placeholder="Ex: ansiedade-estresse"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Indicação</label>
                    <input
                      type="text"
                      value={clinicalFormulaForm.indicacao}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, indicacao: e.target.value})}
                      placeholder="Ex: TAG, fobia social"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Via</label>
                    <select
                      value={clinicalFormulaForm.via}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, via: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      <option value="oral">Oral</option>
                      <option value="sublingual">Sublingual</option>
                      <option value="topica">Tópica</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Excipiente</label>
                    <select
                      value={clinicalFormulaForm.excipiente}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, excipiente: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      {excipientes.map(exc => (
                        <option key={exc.value} value={exc.value}>{exc.label}</option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">QSP</label>
                    <select
                      value={clinicalFormulaForm.qsp}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, qsp: e.target.value})}
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      <option value="1_capsula">1 cápsula</option>
                      <option value="1_dose">1 dose</option>
                      <option value="1ml">1 ml</option>
                      <option value="1g">1 g</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Quantidade</label>
                    <input
                      type="number"
                      value={clinicalFormulaForm.quantidade}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, quantidade: parseInt(e.target.value)})}
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Posologia</label>
                    <input
                      type="text"
                      value={clinicalFormulaForm.posologia}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, posologia: e.target.value})}
                      placeholder="Ex: Tomar 1 cápsula pela manhã e 1 à noite"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-purple-900 mb-2">Observações</label>
                    <textarea
                      value={clinicalFormulaForm.observacoes}
                      onChange={(e) => setClinicalFormulaForm({...clinicalFormulaForm, observacoes: e.target.value})}
                      placeholder="Ex: Avaliar resposta em 2-4 semanas..."
                      rows="3"
                      className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                </div>

                {/* Ativos */}
                <div className="bg-white rounded-lg p-4 border-2 border-purple-300 mb-4">
                  <h4 className="font-bold text-gray-800 mb-3">Ativos da Fórmula *</h4>
                  
                  {clinicalFormulaForm.ativos.length > 0 && (
                    <div className="mb-4 space-y-2">
                      {clinicalFormulaForm.ativos.map((ativo, idx) => (
                        <div key={idx} className="flex justify-between items-center bg-purple-50 p-3 rounded-lg">
                          <div className="flex-1">
                            <p className="font-semibold text-gray-800">{ativo.substancia}</p>
                            <p className="text-sm text-gray-600">
                              {ativo.ligante && ativo.ligante !== '-' && `${ativo.ligante} • `}{ativo.dose} • {ativo.horario}
                            </p>
                          </div>
                          <button
                            onClick={() => removeAtivoFromClinicalFormula(idx)}
                            className="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                  
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input
                      type="text"
                      value={tempClinicalAtivo.substancia}
                      onChange={(e) => setTempClinicalAtivo({...tempClinicalAtivo, substancia: e.target.value})}
                      placeholder="Substância *"
                      className="px-3 py-2 border border-purple-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempClinicalAtivo.ligante}
                      onChange={(e) => setTempClinicalAtivo({...tempClinicalAtivo, ligante: e.target.value})}
                      placeholder="Ligante"
                      className="px-3 py-2 border border-purple-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempClinicalAtivo.dose}
                      onChange={(e) => setTempClinicalAtivo({...tempClinicalAtivo, dose: e.target.value})}
                      placeholder="Dose *"
                      className="px-3 py-2 border border-purple-300 rounded-lg"
                    />
                    <input
                      type="text"
                      value={tempClinicalAtivo.horario}
                      onChange={(e) => setTempClinicalAtivo({...tempClinicalAtivo, horario: e.target.value})}
                      placeholder="Horário *"
                      className="px-3 py-2 border border-purple-300 rounded-lg"
                    />
                  </div>
                  <button
                    onClick={addAtivoToClinicalFormula}
                    className="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2"
                  >
                    <Plus size={18} />
                    Adicionar Ativo
                  </button>
                </div>

                <button
                  onClick={saveClinicalFormula}
                  className="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg font-bold"
                >
                  {editingClinicalFormula ? 'Atualizar Fórmula' : 'Salvar na Biblioteca'}
                </button>
              </div>
            )}

            {/* Navegação por categorias */}
            <div className="mb-6">
              <h3 className="font-semibold text-gray-800 mb-3">Saúde Mental</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                {Object.entries(clinicalLibrary['saude-mental'].categorias).map(([key, categoria]) => (
                  <button
                    key={key}
                    onClick={() => {
                      setSelectedClinicalCategory(key);
                      setSelectedClinicalFormula(null);
                    }}
                    className={`px-4 py-3 rounded-lg font-semibold transition-all ${
                      selectedClinicalCategory === key
                        ? 'bg-purple-600 text-white shadow-lg'
                        : 'bg-purple-50 text-purple-800 hover:bg-purple-100'
                    }`}
                  >
                    {categoria.nome}
                  </button>
                ))}
              </div>
            </div>

            {/* Lista de fórmulas da categoria selecionada */}
            {selectedClinicalCategory && (
              <div className="space-y-4">
                <h3 className="text-xl font-bold text-gray-800 mb-4">
                  {clinicalLibrary['saude-mental'].categorias[selectedClinicalCategory].nome}
                </h3>
                
                {clinicalLibrary['saude-mental'].categorias[selectedClinicalCategory].formulas.map((formula) => (
                  <div key={formula.id} className="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-xl p-6">
                    <div className="flex justify-between items-start mb-4">
                      <div className="flex-1">
                        <h4 className="text-xl font-bold text-gray-800 mb-1">{formula.nome}</h4>
                        <p className="text-sm text-gray-600 mb-2">
                          <strong>Indicação:</strong> {formula.indicacao}
                        </p>
                        <p className="text-sm text-gray-600 mb-2">
                          <strong>Via:</strong> {formula.via.charAt(0).toUpperCase() + formula.via.slice(1)}
                        </p>
                      </div>
                      <button
                        onClick={() => setSelectedClinicalFormula(selectedClinicalFormula === formula.id ? null : formula.id)}
                        className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold flex items-center gap-2"
                      >
                        <Eye size={18} />
                        {selectedClinicalFormula === formula.id ? 'Ocultar' : 'Ver Detalhes'}
                      </button>
                    </div>

                    {selectedClinicalFormula === formula.id && (
                      <div className="mt-4 space-y-4">
                        {/* Ativos */}
                        <div className="bg-white rounded-lg p-4 border border-purple-200">
                          <h5 className="font-bold text-gray-800 mb-3">Ativos ({formula.ativos.length}):</h5>
                          <div className="space-y-2">
                            {formula.ativos.map((ativo, idx) => (
                              <div key={idx} className="flex justify-between items-start py-2 border-b border-gray-200 last:border-0">
                                <div className="flex-1">
                                  <p className="font-semibold text-gray-800">{ativo.substancia}</p>
                                  {ativo.ligante !== '-' && (
                                    <p className="text-sm text-gray-600">Ligante: {ativo.ligante}</p>
                                  )}
                                </div>
                                <div className="text-right">
                                  <p className="font-medium text-purple-800">{ativo.dose}</p>
                                  <p className="text-sm text-gray-600">{ativo.horario}</p>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Configurações */}
                        <div className="bg-white rounded-lg p-4 border border-purple-200">
                          <h5 className="font-bold text-gray-800 mb-3">Configurações Magistrais:</h5>
                          <div className="grid grid-cols-2 gap-4 text-sm">
                            <div>
                              <p className="text-gray-600">Excipiente:</p>
                              <p className="font-medium text-gray-800">{formula.excipiente}</p>
                            </div>
                            <div>
                              <p className="text-gray-600">Quantidade:</p>
                              <p className="font-medium text-gray-800">{formula.quantidade} unidades</p>
                            </div>
                          </div>
                          <div className="mt-3">
                            <p className="text-gray-600">Posologia:</p>
                            <p className="font-medium text-gray-800">{formula.posologia}</p>
                          </div>
                        </div>

                        {/* Observações */}
                        {formula.observacoes && (
                          <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                            <h5 className="font-bold text-yellow-900 mb-2 flex items-center gap-2">
                              <AlertCircle size={18} />
                              Observações Clínicas:
                            </h5>
                            <p className="text-sm text-yellow-900">{formula.observacoes}</p>
                          </div>
                        )}

                        {/* Botões de ação */}
                        <div className="flex gap-2 mb-3">
                          <button
                            onClick={() => importClinicalFormula(formula)}
                            className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg font-bold flex items-center justify-center gap-2"
                          >
                            <Download size={20} />
                            Importar
                          </button>
                          <button
                            onClick={() => editClinicalFormula(formula, 'saude-mental', selectedClinicalCategory)}
                            className="px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center"
                            title="Editar fórmula"
                          >
                            <Settings size={20} />
                          </button>
                          <button
                            onClick={() => deleteClinicalFormula(formula.id, 'saude-mental', selectedClinicalCategory)}
                            className="px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center"
                            title="Deletar fórmula"
                          >
                            <Trash2 size={20} />
                          </button>
                        </div>
                        <p className="text-center text-sm text-gray-600">
                          ⚠️ Todos os componentes serão editáveis após importação
                        </p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}

            {!selectedClinicalCategory && (
              <div className="text-center py-12 text-gray-500">
                <FileText size={48} className="mx-auto mb-4 opacity-50" />
                <p className="text-lg">Selecione uma categoria acima para ver as fórmulas clínicas</p>
              </div>
            )}
          </div>
        )}

        {/* PAINEL DE HISTÓRICO */}
        {showHistory && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <FileText size={28} className="text-teal-600" />
                Histórico de Prescrições ({prescriptionHistory.length})
              </h2>
              <button
                onClick={() => setShowHistory(false)}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-semibold"
              >
                Fechar
              </button>
            </div>

            {/* Busca no histórico */}
            <div className="mb-4">
              <input
                type="text"
                placeholder="Buscar por nome do paciente..."
                value={historySearchTerm}
                onChange={(e) => setHistorySearchTerm(e.target.value)}
                className="w-full px-4 py-2 border-2 border-teal-300 rounded-lg focus:ring-2 focus:ring-teal-500"
              />
            </div>

            {/* Botões de ação */}
            <div className="flex gap-3 mb-6">
              <button
                onClick={exportHistory}
                disabled={prescriptionHistory.length === 0}
                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"
              >
                <Download size={18} />
                Exportar Histórico
              </button>
              <label className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer flex items-center gap-2">
                <FileText size={18} />
                Importar Histórico
                <input
                  type="file"
                  accept=".json"
                  onChange={importHistory}
                  className="hidden"
                />
              </label>
              <button
                onClick={clearHistory}
                disabled={prescriptionHistory.length === 0}
                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"
              >
                <Trash2 size={18} />
                Limpar Histórico
              </button>
            </div>

            {/* Lista de prescrições */}
            <div className="max-h-[600px] overflow-y-auto space-y-4">
              {prescriptionHistory.length === 0 ? (
                <div className="text-center py-12 text-gray-500">
                  <FileText size={48} className="mx-auto mb-4 opacity-50" />
                  <p className="text-lg">Nenhuma prescrição salva ainda</p>
                  <p className="text-sm">Prescrições salvas aparecerão aqui</p>
                </div>
              ) : (
                prescriptionHistory
                  .filter(entry => 
                    !historySearchTerm || 
                    entry.patientInfo.name.toLowerCase().includes(historySearchTerm.toLowerCase())
                  )
                  .map(entry => (
                    <div key={entry.id} className="bg-gradient-to-r from-teal-50 to-blue-50 border-2 border-teal-200 rounded-xl p-6 hover:shadow-lg transition-shadow">
                      <div className="flex justify-between items-start mb-4">
                        <div>
                          <h3 className="text-xl font-bold text-gray-800 mb-1">
                            {entry.patientInfo.name}
                          </h3>
                          <p className="text-sm text-gray-600">
                            {new Date(entry.date).toLocaleString('pt-BR')} | 
                            Idade: {entry.patientInfo.age || 'N/A'} | 
                            Peso: {entry.patientInfo.weight || 'N/A'}kg
                          </p>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => loadPrescriptionFromHistory(entry)}
                            className="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-semibold"
                            title="Carregar prescrição"
                          >
                            <Eye size={16} />
                          </button>
                          <button
                            onClick={() => deletePrescriptionFromHistory(entry.id)}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm"
                            title="Deletar"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-teal-200">
                        <h4 className="font-semibold text-gray-800 mb-2">Substâncias ({entry.prescription.length}):</h4>
                        <div className="flex flex-wrap gap-2">
                          {entry.prescription.map((item, idx) => (
                            <span key={idx} className="px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium">
                              {item.name}
                            </span>
                          ))}
                        </div>
                      </div>
                    </div>
                  ))
              )}
            </div>
          </div>
        )}

        {/* Patient Info */}
        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
          <h2 className="text-xl font-semibold text-gray-800 mb-4">Dados do Paciente</h2>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input
              type="text"
              placeholder="Nome do paciente"
              value={patientInfo.name}
              onChange={(e) => setPatientInfo({...patientInfo, name: e.target.value})}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
            />
            <input
              type="number"
              placeholder="Idade"
              value={patientInfo.age}
              onChange={(e) => setPatientInfo({...patientInfo, age: e.target.value})}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
            />
            <input
              type="number"
              placeholder="Peso (kg)"
              value={patientInfo.weight}
              onChange={(e) => setPatientInfo({...patientInfo, weight: e.target.value})}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
            />
            <select
              value={patientInfo.gender}
              onChange={(e) => setPatientInfo({...patientInfo, gender: e.target.value})}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
            >
              <option value="M">Masculino</option>
              <option value="F">Feminino</option>
            </select>
          </div>
        </div>

        {/* Filters */}
        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                <Filter size={16} />
                Categoria
              </label>
              <select
                value={selectedCategory}
                onChange={(e) => setSelectedCategory(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
              >
                {categories.map(c => (
                  <option key={c.value} value={c.value}>{c.label}</option>
                ))}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Condição Psiquiátrica
              </label>
              <select
                value={selectedCondition}
                onChange={(e) => setSelectedCondition(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
              >
                <option value="">Todas as condições</option>
                {conditions.map(c => (
                  <option key={c.value} value={c.value}>{c.label}</option>
                ))}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Buscar
              </label>
              <div className="relative">
                <Search className="absolute left-3 top-2.5 text-gray-400" size={20} />
                <input
                  type="text"
                  placeholder="Nome ou mecanismo..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>
          <div className="mt-4 flex items-center gap-2">
            <input
              type="checkbox"
              id="showDRI"
              checked={showDRI}
              onChange={(e) => setShowDRI(e.target.checked)}
              className="w-4 h-4 text-teal-600 rounded"
            />
            <label htmlFor="showDRI" className="text-sm text-gray-700">
              Mostrar valores DRI (Dietary Reference Intakes)
            </label>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Nutraceuticos List */}
          <div className="space-y-4">
            
            {/* BOTÃO DE CADASTRO - AZUL */}
            <div className="mb-4">
              <button
                onClick={() => setShowCustomForm(!showCustomForm)}
                className="w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl flex items-center justify-center gap-2 font-semibold text-lg"
              >
                <Plus size={24} />
                {showCustomForm ? 'Fechar Cadastro' : 'Cadastrar Nova Substância'}
              </button>
            </div>

            {/* FORMULÁRIO DE CADASTRO */}
            {showCustomForm && (
              <div className="mb-4 p-6 bg-blue-50 border-2 border-blue-300 rounded-xl shadow-lg">
                <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center gap-2">
                  <Plus size={20} />
                  Nova Substância Personalizada
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Nome da Substância *
                    </label>
                    <input
                      type="text"
                      value={customForm.name}
                      onChange={(e) => setCustomForm({...customForm, name: e.target.value})}
                      placeholder="Ex: Probiótico Multi-Cepas"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Dosagem *
                    </label>
                    <input
                      type="text"
                      value={customForm.dosage}
                      onChange={(e) => setCustomForm({...customForm, dosage: e.target.value})}
                      placeholder="Ex: 10⁹ UFC/dia"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Categoria
                    </label>
                    <input
                      type="text"
                      value={customForm.category}
                      onChange={(e) => setCustomForm({...customForm, category: e.target.value})}
                      placeholder="Ex: Probiótico, Fitoterápico..."
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Horário de Administração
                    </label>
                    <input
                      type="text"
                      value={customForm.timing}
                      onChange={(e) => setCustomForm({...customForm, timing: e.target.value})}
                      placeholder="Ex: Junto às refeições"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Mecanismo de Ação
                    </label>
                    <textarea
                      value={customForm.mechanism}
                      onChange={(e) => setCustomForm({...customForm, mechanism: e.target.value})}
                      placeholder="Ex: Modulação da microbiota intestinal"
                      rows="2"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-semibold text-blue-900 mb-2">
                      Notas Clínicas
                    </label>
                    <textarea
                      value={customForm.notes}
                      onChange={(e) => setCustomForm({...customForm, notes: e.target.value})}
                      placeholder="Ex: Refrigerar após abrir. Dosar biomarcadores."
                      rows="2"
                      className="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>
                
                <div className="mt-4 flex gap-3">
                  <button
                    onClick={addCustomSubstance}
                    className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-md hover:shadow-lg"
                  >
                    Adicionar à Base
                  </button>
                  <button
                    onClick={() => setShowCustomForm(false)}
                    className="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-semibold"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            )}

            {/* PAINEL DE SUBSTÂNCIAS PERSONALIZADAS */}
            {customSubstances.length > 0 && (
              <div className="mb-4 p-4 bg-blue-50 border-2 border-blue-300 rounded-xl shadow-md">
                <h4 className="font-bold text-blue-900 mb-3 flex items-center gap-2">
                  <span className="text-lg">Minhas Substâncias Personalizadas</span>
                  <span className="px-2 py-1 bg-blue-200 text-blue-800 rounded-full text-sm font-semibold">
                    {customSubstances.length}
                  </span>
                </h4>
                <div className="flex flex-wrap gap-2">
                  {customSubstances.map(sub => (
                    <div key={sub.id} className="flex items-center gap-2 bg-white px-4 py-2 rounded-full border-2 border-blue-300 shadow-sm hover:shadow-md transition-shadow">
                      <span className="text-blue-900 font-medium">{sub.name}</span>
                      <button
                        onClick={() => removeCustomSubstance(sub.id)}
                        className="text-blue-600 hover:text-blue-800 hover:bg-blue-100 rounded-full p-1 transition-colors"
                        title="Remover substância"
                      >
                        <Trash2 size={16} />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* SUBSTÂNCIAS DISPONÍVEIS - COLAPSÁVEL */}
            <div className="bg-gray-50 rounded-xl shadow-md p-4 border-2 border-gray-200">
              <button
                onClick={() => setShowAvailableList(!showAvailableList)}
                className="w-full flex justify-between items-center text-left"
              >
                <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                  <span className={`transform transition-transform ${showAvailableList ? 'rotate-90' : ''}`}>
                    ▶
                  </span>
                  Substâncias Disponíveis ({filteredNutraceuticos.length})
                </h2>
                <span className="text-sm text-gray-600 font-normal">
                  {showAvailableList ? 'Clique para fechar' : 'Clique para abrir'}
                </span>
              </button>

              {showAvailableList && (
                <div className="mt-4">
                  {/* Campo de busca dentro da lista */}
                  <div className="mb-4">
                    <div className="relative">
                      <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500" size={20} />
                      <input
                        type="text"
                        placeholder="Buscar na lista (nome, categoria, condição)..."
                        value={availableSearchTerm}
                        onChange={(e) => setAvailableSearchTerm(e.target.value)}
                        className="w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-gray-400 text-base bg-white"
                      />
                      {availableSearchTerm && (
                        <button
                          onClick={() => setAvailableSearchTerm('')}
                          className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                        >
                          ✕
                        </button>
                      )}
                    </div>
                    <p className="text-sm text-gray-600 mt-2">
                      {(() => {
                        const filtered = filteredNutraceuticos.filter(nutr => {
                          if (!availableSearchTerm) return true;
                          const searchLower = availableSearchTerm.toLowerCase();
                          return (
                            nutr.name.toLowerCase().includes(searchLower) ||
                            nutr.category.toLowerCase().includes(searchLower) ||
                            nutr.conditions.some(cond => 
                              conditions.find(c => c.value === cond)?.label.toLowerCase().includes(searchLower)
                            )
                          );
                        });
                        return `${filtered.length} substância${filtered.length !== 1 ? 's' : ''} encontrada${filtered.length !== 1 ? 's' : ''}`;
                      })()}
                    </p>
                  </div>

                  {/* Lista de substâncias */}
                  <div className="max-h-[600px] overflow-y-auto space-y-4 pr-2">
                    {filteredNutraceuticos
                      .filter(nutr => {
                        if (!availableSearchTerm) return true;
                        const searchLower = availableSearchTerm.toLowerCase();
                        return (
                          nutr.name.toLowerCase().includes(searchLower) ||
                          nutr.category.toLowerCase().includes(searchLower) ||
                          nutr.conditions.some(cond => 
                            conditions.find(c => c.value === cond)?.label.toLowerCase().includes(searchLower)
                          )
                        );
                      })
                      .map(nutr => (
                <div key={nutr.id} className="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-6">
                  <div className="flex justify-between items-start mb-3">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">
                          {nutr.category}
                        </span>
                      </div>
                      <h3 className="text-xl font-semibold text-gray-800 mb-2">
                        {nutr.name}
                      </h3>
                      <div className="flex flex-wrap gap-2 mb-2">
                        {nutr.conditions.map(cond => (
                          <span key={cond} className="px-2 py-1 bg-teal-100 text-teal-800 text-xs rounded-full">
                            {conditions.find(c => c.value === cond)?.label}
                          </span>
                        ))}
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setShowInfo(showInfo === nutr.id ? null : nutr.id)}
                        className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                        title="Ver detalhes"
                      >
                        <Info size={20} />
                      </button>
                      <button
                        onClick={() => addToPrescription(nutr)}
                        disabled={prescription.find(p => p.id === nutr.id)}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all ${
                          prescription.find(p => p.id === nutr.id)
                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            : 'bg-gradient-to-r from-teal-600 to-green-600 text-white hover:from-teal-700 hover:to-green-700 shadow-md hover:shadow-lg'
                        }`}
                        title={prescription.find(p => p.id === nutr.id) ? "Já adicionado" : "Adicionar à prescrição"}
                      >
                        <Plus size={20} />
                        {prescription.find(p => p.id === nutr.id) ? 'Adicionado' : 'Adicionar'}
                      </button>
                    </div>
                  </div>

                  <div className="text-sm text-gray-600 space-y-1">
                    <p><strong>Dosagem:</strong> {nutr.dosage}</p>
                    <p><strong>Administração:</strong> {nutr.timing}</p>
                    {showDRI && nutr.dri && (
                      <p className="text-xs bg-blue-50 p-2 rounded mt-2">
                        <strong>DRI:</strong> {nutr.dri}
                      </p>
                    )}
                  </div>

                  {showInfo === nutr.id && (
                    <div className="mt-4 pt-4 border-t border-gray-200 space-y-2 text-sm">
                      <div className="bg-blue-50 p-3 rounded-lg">
                        <p className="font-semibold text-blue-900 mb-1">Nível de Evidência</p>
                        <p className="text-blue-800">{nutr.evidence}</p>
                      </div>
                      <div>
                        <p className="font-semibold text-gray-700">Mecanismo de Ação:</p>
                        <p className="text-gray-600">{nutr.mechanism}</p>
                      </div>
                      {nutr.interactions && (
                        <div className="bg-yellow-50 p-3 rounded-lg">
                          <p className="font-semibold text-yellow-900 mb-1">Interações:</p>
                          <p className="text-yellow-800">{nutr.interactions}</p>
                        </div>
                      )}
                      {nutr.contraindications && (
                        <div className="bg-red-50 p-3 rounded-lg">
                          <p className="font-semibold text-red-900 mb-1">Contraindicações:</p>
                          <p className="text-red-800">{nutr.contraindications}</p>
                        </div>
                      )}
                      {nutr.notes && (
                        <div className="bg-purple-50 p-3 rounded-lg">
                          <p className="font-semibold text-purple-900 mb-1">Observações Clínicas:</p>
                          <p className="text-purple-800">{nutr.notes}</p>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>

          {/* Prescription Panel */}
          <div className="lg:sticky lg:top-6 h-fit space-y-4">
            {/* Configurações Magistrais */}
            <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl shadow-lg p-6 border-2 border-purple-200">
              <div className="flex items-center gap-2 mb-4">
                <Settings className="text-purple-600" size={24} />
                <h2 className="text-xl font-bold text-gray-800">Configurações Magistrais</h2>
              </div>
              
              <div className="space-y-4">
                {/* Tipo de formulação */}
                <div className="bg-white p-4 rounded-lg border border-purple-200">
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={magistralConfig.groupFormulas}
                      onChange={(e) => setMagistralConfig({...magistralConfig, groupFormulas: e.target.checked})}
                      className="w-4 h-4 text-purple-600 rounded"
                    />
                    <span className="font-semibold text-gray-800">
                      {magistralConfig.groupFormulas ? '✓ Fórmula Única' : 'Fórmulas Separadas'}
                    </span>
                  </label>
                  <p className="text-xs text-gray-600 mt-1 ml-6">
                    {magistralConfig.groupFormulas 
                      ? 'Todos os componentes em uma única fórmula'
                      : 'Cada componente em fórmula individual'}
                  </p>
                </div>
                
                {/* Via de uso */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Via de Uso</label>
                  <select
                    value={magistralConfig.via}
                    onChange={(e) => setMagistralConfig({...magistralConfig, via: e.target.value})}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  >
                    {viasUso.map(v => (
                      <option key={v.value} value={v.value}>{v.label}</option>
                    ))}
                  </select>
                </div>
                
                {/* Forma farmacêutica */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Forma Farmacêutica</label>
                  <select
                    value={magistralConfig.formaFarmaceutica}
                    onChange={(e) => setMagistralConfig({...magistralConfig, formaFarmaceutica: e.target.value})}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                  >
                    {formasFarmaceuticas.map(f => (
                      <option key={f.value} value={f.value}>{f.label}</option>
                    ))}
                  </select>
                </div>
                
                <div className="grid grid-cols-2 gap-3">
                  {/* Excipiente */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Excipiente</label>
                    <select
                      value={magistralConfig.excipiente}
                      onChange={(e) => setMagistralConfig({...magistralConfig, excipiente: e.target.value})}
                      className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      {excipientes.map(e => (
                        <option key={e.value} value={e.value}>{e.label}</option>
                      ))}
                    </select>
                  </div>
                  
                  {/* QSP */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">QSP</label>
                    <select
                      value={magistralConfig.qsp}
                      onChange={(e) => setMagistralConfig({...magistralConfig, qsp: e.target.value})}
                      className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    >
                      {qspOpcoes.map(q => (
                        <option key={q.value} value={q.value}>{q.label}</option>
                      ))}
                    </select>
                  </div>
                </div>
                
                {/* Quantidade */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Quantidade (unidades a aviar)</label>
                  <input
                    type="number"
                    value={magistralConfig.quantidade}
                    onChange={(e) => setMagistralConfig({...magistralConfig, quantidade: e.target.value})}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    min="1"
                  />
                </div>
                
                {/* Posologia */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Posologia</label>
                  <textarea
                    value={magistralConfig.posologia}
                    onChange={(e) => setMagistralConfig({...magistralConfig, posologia: e.target.value})}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    rows="2"
                    placeholder="Ex: Tomar 1 cápsula 2x ao dia, após café e jantar"
                  />
                </div>
                
                {/* Observações */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Observações (opcional)</label>
                  <textarea
                    value={magistralConfig.observacoes}
                    onChange={(e) => setMagistralConfig({...magistralConfig, observacoes: e.target.value})}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    rows="2"
                    placeholder="Ex: Utilizar cápsula vegetal. Conservar em geladeira."
                  />
                </div>
                
                {/* Botão Preview */}
                {prescription.length > 0 && (
                  <div className="space-y-3">
                    <button
                      onClick={() => setShowPreview(!showPreview)}
                      className={`w-full flex items-center justify-center gap-2 px-4 py-3 font-semibold rounded-lg transition-all shadow-md ${
                        showPreview 
                          ? 'bg-gradient-to-r from-green-600 to-teal-600 text-white hover:from-green-700 hover:to-teal-700' 
                          : 'bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700'
                      }`}
                    >
                      <Eye size={20} />
                      {showPreview ? '✓ Prévia Visível' : 'Ver Prévia das Fórmulas'}
                    </button>
                    
                    <button
                      onClick={savePrescriptionToHistory}
                      className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition-all shadow-md"
                    >
                      <FileText size={20} />
                      Salvar no Histórico
                    </button>
                  </div>
                )}
              </div>
            </div>
            
            {/* Preview das Fórmulas */}
            {showPreview && prescription.length > 0 && (
              <div className="bg-white rounded-xl shadow-lg p-6 max-h-[600px] overflow-y-auto">
                <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <Eye size={20} />
                  Prévia das Fórmulas Magistrais
                </h3>
                
                {generateMagistralFormula().map((formula, index) => (
                  <div key={formula.id} className="mb-6 last:mb-0">
                    <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                      <div className="flex justify-between items-start mb-3">
                        <h4 className="font-semibold text-gray-800">
                          {magistralConfig.groupFormulas 
                            ? 'Fórmula Única' 
                            : `Fórmula ${index + 1}: ${formula.name}`}
                        </h4>
                        <button
                          onClick={() => copyToClipboard(formula.formula, formula.id)}
                          className="flex items-center gap-1 px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          {copiedFormula === formula.id ? (
                            <>✓ Copiado</>
                          ) : (
                            <><Copy size={14} /> Copiar</>
                          )}
                        </button>
                      </div>
                      <pre className="text-xs font-mono whitespace-pre-wrap bg-white p-4 rounded border border-gray-300 max-h-96 overflow-y-auto">
                        {formula.formula}
                      </pre>
                    </div>
                  </div>
                ))}
              </div>
            )}
            
            {/* Lista de Prescrição */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-2xl font-bold text-gray-800">
                  Prescrição ({prescription.length})
                </h2>
                {prescription.length > 0 && (
                  <div className="relative">
                    <button
                      onClick={() => setShowExportMenu(!showExportMenu)}
                      className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                      title="Opções de exportação"
                    >
                      <Download size={18} />
                      Exportar
                      <span className="text-xs">▼</span>
                    </button>
                    
                    {showExportMenu && (
                      <div className="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl border-2 border-gray-200 z-50">
                        <div className="p-2">
                          {/* Opção 1: Copiar (PRINCIPAL - mais usado) */}
                          <button
                            onClick={() => {
                              copyPrescriptionToClipboard();
                              setShowExportMenu(false);
                            }}
                            className="w-full text-left px-4 py-3 rounded-lg hover:bg-green-50 transition-colors group border-b-2 border-green-100"
                          >
                            <div className="flex items-center gap-2">
                              <span className="text-2xl">📋</span>
                              <div className="flex-1">
                                <div className="font-bold text-gray-800 group-hover:text-green-700">
                                  Copiar para Área de Transferência
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                  ⭐ Recomendado para Tribe MD / Bipp
                                </div>
                                <div className="text-xs text-green-600 font-semibold mt-1">
                                  Clique e cole direto no sistema (Ctrl+V)
                                </div>
                              </div>
                            </div>
                          </button>
                          
                          {/* Opção 2: PDF bonito */}
                          <button
                            onClick={() => {
                              generateBeautifulPDF();
                              setShowExportMenu(false);
                            }}
                            className="w-full text-left px-4 py-3 rounded-lg hover:bg-blue-50 transition-colors group mt-1"
                          >
                            <div className="flex items-center gap-2">
                              <span className="text-2xl">📄</span>
                              <div className="flex-1">
                                <div className="font-semibold text-gray-800 group-hover:text-blue-700">
                                  Baixar PDF
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                  Layout profissional com cores
                                </div>
                              </div>
                            </div>
                          </button>
                          
                          {/* Opção 3: TXT compatível */}
                          <button
                            onClick={() => {
                              generateSafeTxtPrescription();
                              setShowExportMenu(false);
                            }}
                            className="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors group"
                          >
                            <div className="flex items-center gap-2">
                              <span className="text-2xl">📝</span>
                              <div className="flex-1">
                                <div className="font-semibold text-gray-600 group-hover:text-gray-800">
                                  Baixar TXT
                                </div>
                                <div className="text-xs text-gray-400 mt-1">
                                  Formato texto simples (backup)
                                </div>
                              </div>
                            </div>
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>

              {prescription.length === 0 ? (
                <div className="text-center py-12 text-gray-400">
                  <FileText size={48} className="mx-auto mb-3 opacity-50" />
                  <p>Nenhum item adicionado</p>
                  <p className="text-sm mt-2">Clique no botão + para adicionar</p>
                </div>
              ) : (
                <div className="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                  {prescription.map((item, index) => (
                    <div key={item.id} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex justify-between items-start mb-2">
                        <div className="flex-1">
                          <div className="flex items-center gap-2">
                            <span className="bg-teal-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">
                              {index + 1}
                            </span>
                            <h4 className="font-semibold text-gray-800">{item.name}</h4>
                          </div>
                          <p className="text-xs text-purple-600 mt-1">{item.category}</p>
                        </div>
                        <button
                          onClick={() => removeFromPrescription(item.id)}
                          className="text-red-600 hover:bg-red-50 p-1 rounded transition-colors"
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                      
                      <div className="mt-3">
                        <label className="block text-xs font-medium text-gray-600 mb-1">
                          Dosagem personalizada:
                        </label>
                        <textarea
                          value={item.customDosage}
                          onChange={(e) => updateCustomDosage(item.id, e.target.value)}
                          className="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                          rows="2"
                        />
                      </div>
                      
                      {/* SELETOR DE LIGANTES */}
                      {item.ligantes && (
                        <div className="mt-3">
                          <label className="block text-xs font-medium text-gray-600 mb-1">
                            ⚗️ Forma / Ligante químico:
                          </label>
                          <select
                            value={item.selectedLigante || item.ligantes.default}
                            onChange={(e) => updateSelectedLigante(item.id, e.target.value)}
                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          >
                            <option value={item.ligantes.default}>
                              ⭐ {item.ligantes.default} (Recomendado)
                            </option>
                            {item.ligantes.alternatives.map(alt => (
                              <option key={alt} value={alt}>
                                {alt}
                              </option>
                            ))}
                          </select>
                          {item.ligantes.justificativa && (
                            <p className="text-xs text-gray-500 mt-1 italic">
                              💡 {item.ligantes.justificativa}
                            </p>
                          )}
                          {item.selectedLigante && item.selectedLigante !== item.ligantes.default && (
                            <div className="mt-1 flex items-start gap-1 bg-amber-50 p-2 rounded">
                              <AlertCircle size={12} className="text-amber-700 mt-0.5 flex-shrink-0" />
                              <p className="text-xs text-amber-800">Forma alternativa selecionada</p>
                            </div>
                          )}
                        </div>
                      )}

                      {/* SELETOR DE EXCIPIENTE (apenas vitaminas lipossolúveis) */}
                      {item.excipiente && (
                        <div className="mt-3">
                          <label className="block text-xs font-medium text-gray-600 mb-1">
                            🧪 Excipiente (vitamina lipossolúvel):
                          </label>
                          <select
                            value={item.selectedExcipiente || item.excipiente.default}
                            onChange={(e) => updateSelectedExcipiente(item.id, e.target.value)}
                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                          >
                            <option value={item.excipiente.default}>
                              ⭐ {item.excipiente.default} (Padrão)
                            </option>
                            {item.excipiente.alternatives.map(alt => (
                              <option key={alt} value={alt}>
                                {alt}
                              </option>
                            ))}
                          </select>
                          {item.excipiente.justificativa && (
                            <p className="text-xs text-gray-500 mt-1 italic">
                              💡 {item.excipiente.justificativa}
                            </p>
                          )}
                          {item.selectedExcipiente && item.selectedExcipiente !== item.excipiente.default && (
                            <div className="mt-1 flex items-start gap-1 bg-amber-50 p-2 rounded">
                              <AlertCircle size={12} className="text-amber-700 mt-0.5 flex-shrink-0" />
                              <p className="text-xs text-amber-800">Excipiente alternativo selecionado</p>
                            </div>
                          )}
                        </div>
                      )}
                      
                      <div className="mt-2 text-xs text-gray-600">
                        <p><strong>Horário:</strong> {item.timing}</p>
                      </div>

                      {item.interactions && item.interactions !== 'Nenhuma significativa' && (
                        <div className="mt-2 flex items-start gap-2 bg-yellow-50 p-2 rounded">
                          <AlertCircle size={14} className="text-yellow-700 mt-0.5 flex-shrink-0" />
                          <p className="text-xs text-yellow-800">{item.interactions}</p>
                        </div>
                      )}
                    </div>
                  ))}

                  <div className="mt-6 pt-4 border-t border-gray-200">
                    <h3 className="font-semibold text-gray-800 mb-2 text-sm">Orientações Gerais:</h3>
                    <ul className="text-xs text-gray-600 space-y-1">
                      <li>• Iniciar gradualmente (1-2 suplementos/semana)</li>
                      <li>• Tomar com refeições quando indicado</li>
                      <li>• Manter hidratação adequada (2-3L/dia)</li>
                      <li>• Reavaliar em 8-12 semanas</li>
                      <li>• Monitorar sintomas e efeitos colaterais</li>
                      <li>• Exames laboratoriais conforme indicado</li>
                    </ul>
                  </div>
                </div>
              )}
            </div>

            {/* DRI Info */}
            <div className="mt-4 bg-blue-50 border-l-4 border-blue-600 p-4 rounded-r-lg">
              <div className="flex items-start gap-2">
                <Info className="text-blue-600 flex-shrink-0 mt-0.5" size={20} />
                <div className="text-sm text-blue-900">
                  <p className="font-semibold mb-1">DRIs - Dietary Reference Intakes:</p>
                  <p className="text-xs">EAR = Necessidade Média | RDA = Recomendação | AI = Ingestão Adequada | UL = Limite Superior | CDRR = Redução Risco Doenças Crônicas</p>
                </div>
              </div>
            </div>

            {/* Clinical Alert */}
            <div className="mt-4 bg-purple-50 border-l-4 border-purple-600 p-4 rounded-r-lg">
              <div className="flex items-start gap-2">
                <AlertCircle className="text-purple-600 flex-shrink-0 mt-0.5" size={20} />
                <div className="text-sm text-purple-900">
                  <p className="font-semibold mb-1">Importante:</p>
                  <p>Esta prescrição é baseada em evidências científicas (ILSI Brasil, IOM/NASEM). Sempre considerar história clínica, exames laboratoriais e medicações em uso.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="mt-8 text-center text-sm text-gray-600 bg-white rounded-lg p-6">
          <p className="font-semibold mb-2">Referências Científicas</p>
          <p className="text-xs">
            • ILSI Brasil - Recomendações de Nutrientes (Volume 1, 2023)
          </p>
          <p className="text-xs">
            • Institute of Medicine / National Academies - DRIs (1997-2023)
          </p>
          <p className="text-xs">
            • Evidências: Am J Psychiatry, J Clin Psychiatry, Nutritional Neuroscience
          </p>
          <p className="text-xs mt-3 text-gray-500 italic">
            Sistema desenvolvido para apoio à prática clínica em Psiquiatria Nutricional Baseada em Evidências
          </p>
        </div>

      {/* PAINEL DE INFORMAÇÕES TÉCNICAS - PARA CONSULTA DO PRESCRITOR */}
      {prescription.length > 0 && (
        <div className="mt-6 bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
          <h3 className="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2">
            <Info className="text-blue-600" size={20} />
            📚 Informações Técnicas (Consulta do Prescritor)
          </h3>
          <p className="text-sm text-blue-700 mb-4 italic">
            ℹ️ Estas informações NÃO aparecem na prescrição final. São apenas para sua consulta clínica.
          </p>
          
          <div className="space-y-4">
            {prescription.map((item, index) => (
              <div key={item.id} className="bg-white rounded-lg p-4 border border-blue-200">
                <h4 className="font-bold text-blue-900 mb-2 flex items-center gap-2">
                  {index + 1}. {item.name}
                  {item.selectedLigante && (
                    <span className="text-sm text-blue-600">({item.selectedLigante})</span>
                  )}
                </h4>
                
                <div className="space-y-2 text-sm">
                  {/* DRI */}
                  {item.dri && (
                    <div className="bg-green-50 p-2 rounded">
                      <span className="font-semibold text-green-800">📊 DRI:</span>
                      <span className="text-green-700 ml-2">{item.dri}</span>
                    </div>
                  )}
                  
                  {/* Mecanismo */}
                  <div className="bg-purple-50 p-2 rounded">
                    <span className="font-semibold text-purple-800">⚙️ Mecanismo:</span>
                    <span className="text-purple-700 ml-2">{item.mechanism}</span>
                  </div>
                  
                  {/* Administração */}
                  <div className="bg-teal-50 p-2 rounded">
                    <span className="font-semibold text-teal-800">⏰ Administração:</span>
                    <span className="text-teal-700 ml-2">{item.timing}</span>
                  </div>
                  
                  {/* Evidência */}
                  {item.evidence && (
                    <div className="bg-indigo-50 p-2 rounded">
                      <span className="font-semibold text-indigo-800">🔬 Evidência:</span>
                      <span className="text-indigo-700 ml-2">{item.evidence}</span>
                    </div>
                  )}
                  
                  {/* Interações */}
                  {item.interactions && item.interactions !== 'Nenhuma significativa' && (
                    <div className="bg-amber-50 p-2 rounded border-l-4 border-amber-400">
                      <span className="font-semibold text-amber-800">⚠️ Interações:</span>
                      <span className="text-amber-700 ml-2">{item.interactions}</span>
                    </div>
                  )}
                  
                  {/* Contraindicações */}
                  {item.contraindications && item.contraindications !== 'Nenhuma conhecida' && (
                    <div className="bg-red-50 p-2 rounded border-l-4 border-red-400">
                      <span className="font-semibold text-red-800">🚫 Contraindicações:</span>
                      <span className="text-red-700 ml-2">{item.contraindications}</span>
                    </div>
                  )}
                  
                  {/* Notas Clínicas */}
                  {item.notes && (
                    <div className="bg-blue-50 p-2 rounded">
                      <span className="font-semibold text-blue-800">📝 Notas:</span>
                      <span className="text-blue-700 ml-2">{item.notes}</span>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      </div>
    </div>
  );
};


    
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
      setTimeout(() => {
        const loader = document.getElementById('loading');
        if (loader) loader.remove();
        console.log('✅ Sistema carregado! v2.0 - Copiar + PDF Bonito');
      }, 500);
    } catch (error) {
      console.error('Erro:', error);
    }
  </script>
</body>
</html>